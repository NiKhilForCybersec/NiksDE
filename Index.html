<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Detection Engineering Mastery | Zero to Hero Complete Guide</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Rajdhani:wght@500;600;700&family=Exo+2:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #0f0f18;
            --bg-tertiary: #151520;
            --bg-card: #1a1a25;
            --bg-code: #12121a;
            --text-primary: #e8e6e3;
            --text-secondary: #a0a0a0;
            --text-muted: #6a6a7a;
            --accent-cyan: #00d4ff;
            --accent-magenta: #ff00aa;
            --accent-purple: #a855f7;
            --accent-green: #00ff88;
            --accent-orange: #ff8800;
            --accent-yellow: #ffdd00;
            --accent-blue: #0088ff;
            --accent-red: #ff4757;
            --border-color: #2a2a3a;
            --glow-cyan: 0 0 20px rgba(0, 212, 255, 0.3);
            --glow-magenta: 0 0 20px rgba(255, 0, 170, 0.3);
            --gradient-1: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            --gradient-2: linear-gradient(135deg, var(--accent-magenta), var(--accent-orange));
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Exo 2', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.8;
            overflow-x: hidden;
        }

        /* Progress Bar */
        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--bg-secondary);
            z-index: 1001;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-1);
            width: 0%;
            transition: width 0.1s;
        }

        /* Header */
        header {
            position: fixed;
            top: 3px;
            left: 0;
            right: 0;
            height: 65px;
            background: rgba(10, 10, 15, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            z-index: 1000;
            display: flex;
            align-items: center;
            padding: 0 20px;
        }

        .logo {
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.4rem;
            font-weight: 700;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo span {
            color: var(--accent-magenta);
            -webkit-text-fill-color: var(--accent-magenta);
        }

        .header-center {
            flex: 1;
            display: flex;
            justify-content: center;
        }

        .search-box {
            position: relative;
            width: 400px;
        }

        .search-box input {
            width: 100%;
            padding: 10px 20px 10px 45px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 25px;
            color: var(--text-primary);
            font-family: 'Exo 2', sans-serif;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--accent-cyan);
            box-shadow: var(--glow-cyan);
        }

        .search-box::before {
            content: "üîç";
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
        }

        .sidebar-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
            margin-right: 15px;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 68px;
            left: 0;
            width: 320px;
            height: calc(100vh - 68px);
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            z-index: 999;
            padding: 20px 0;
            transition: transform 0.3s;
        }

        .sidebar-section {
            margin-bottom: 10px;
        }

        .sidebar-section-header {
            padding: 12px 20px;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s;
        }

        .sidebar-section-header:hover {
            color: var(--accent-cyan);
            background: rgba(0, 212, 255, 0.05);
        }

        .sidebar-section-header::after {
            content: "‚ñ∂";
            font-size: 0.7rem;
            transition: transform 0.3s;
        }

        .sidebar-section.active .sidebar-section-header::after {
            transform: rotate(90deg);
        }

        .sidebar-links {
            display: none;
            padding: 5px 0;
        }

        .sidebar-section.active .sidebar-links {
            display: block;
        }

        .sidebar-link {
            display: block;
            padding: 8px 20px 8px 35px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.2s;
            border-left: 2px solid transparent;
        }

        .sidebar-link:hover {
            color: var(--accent-cyan);
            background: rgba(0, 212, 255, 0.05);
            border-left-color: var(--accent-cyan);
        }

        .sidebar-link.active {
            color: var(--accent-cyan);
            border-left-color: var(--accent-cyan);
            background: rgba(0, 212, 255, 0.1);
        }

        /* Main Content */
        main {
            margin-left: 320px;
            margin-top: 68px;
            padding: 40px 50px;
            max-width: 1400px;
        }

        /* Module Styling */
        .module {
            margin-bottom: 80px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .module-header {
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 1px solid var(--border-color);
        }

        .module-number {
            display: inline-block;
            font-family: 'Rajdhani', sans-serif;
            font-size: 0.85rem;
            font-weight: 600;
            letter-spacing: 2px;
            color: var(--accent-cyan);
            margin-bottom: 10px;
        }

        .module-header h1 {
            font-family: 'Rajdhani', sans-serif;
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 15px;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .lead {
            font-size: 1.15rem;
            color: var(--text-secondary);
            max-width: 800px;
        }

        h2 {
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 50px 0 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--accent-purple);
            display: inline-block;
        }

        h3 {
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--accent-cyan);
            margin: 35px 0 20px;
        }

        h4 {
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.15rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 25px 0 15px;
        }

        p {
            margin-bottom: 15px;
            color: var(--text-secondary);
        }

        ul, ol {
            margin: 15px 0 15px 25px;
            color: var(--text-secondary);
        }

        li {
            margin-bottom: 8px;
        }

        strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        /* Code Blocks */
        .code-block {
            margin: 25px 0;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            background: var(--bg-code);
        }

        .code-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 20px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-color);
        }

        .code-lang {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--accent-cyan);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .code-title {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .copy-btn {
            padding: 5px 12px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 5px;
            color: var(--text-secondary);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            background: var(--accent-cyan);
            color: var(--bg-primary);
            border-color: var(--accent-cyan);
        }

        .code-block pre {
            padding: 20px;
            overflow-x: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.6;
            color: var(--text-primary);
        }

        /* Syntax Highlighting */
        .kw { color: var(--accent-purple); font-weight: 500; }
        .fn { color: var(--accent-cyan); }
        .str { color: var(--accent-green); }
        .cmt { color: var(--text-muted); font-style: italic; }
        .num { color: var(--accent-orange); }
        .op { color: var(--accent-magenta); }
        .var { color: var(--accent-yellow); }
        .prop { color: var(--accent-blue); }
        .tag { color: var(--accent-red); }

        code.inline-code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85em;
            padding: 2px 8px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--accent-cyan);
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            margin: 15px 0;
            transition: all 0.3s;
        }

        .card:hover {
            border-color: var(--accent-cyan);
            box-shadow: var(--glow-cyan);
        }

        .card h4 {
            margin-top: 0;
            color: var(--accent-cyan);
        }

        /* Grids */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 20px 0;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }

        .grid-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        /* Tables */
        .table-wrapper {
            overflow-x: auto;
            margin: 20px 0;
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        th {
            background: var(--bg-tertiary);
            padding: 15px;
            text-align: left;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
            color: var(--accent-cyan);
            border-bottom: 2px solid var(--accent-purple);
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        tr:hover {
            background: rgba(0, 212, 255, 0.03);
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-cyan { background: rgba(0, 212, 255, 0.2); color: var(--accent-cyan); }
        .badge-magenta { background: rgba(255, 0, 170, 0.2); color: var(--accent-magenta); }
        .badge-purple { background: rgba(168, 85, 247, 0.2); color: var(--accent-purple); }
        .badge-green { background: rgba(0, 255, 136, 0.2); color: var(--accent-green); }
        .badge-orange { background: rgba(255, 136, 0, 0.2); color: var(--accent-orange); }
        .badge-yellow { background: rgba(255, 221, 0, 0.2); color: var(--accent-yellow); }
        .badge-blue { background: rgba(0, 136, 255, 0.2); color: var(--accent-blue); }
        .badge-red { background: rgba(255, 71, 87, 0.2); color: var(--accent-red); }

        /* Info Boxes */
        .info-box {
            padding: 20px 25px;
            border-radius: 12px;
            margin: 25px 0;
            border-left: 4px solid;
        }

        .info-box.note {
            background: rgba(0, 136, 255, 0.1);
            border-color: var(--accent-blue);
        }

        .info-box.warning {
            background: rgba(255, 136, 0, 0.1);
            border-color: var(--accent-orange);
        }

        .info-box.tip {
            background: rgba(0, 255, 136, 0.1);
            border-color: var(--accent-green);
        }

        .info-box.important {
            background: rgba(255, 0, 170, 0.1);
            border-color: var(--accent-magenta);
        }

        .info-box.critical {
            background: rgba(255, 71, 87, 0.1);
            border-color: var(--accent-red);
        }

        .info-box.beginner {
            background: rgba(0, 212, 255, 0.1);
            border-color: var(--accent-cyan);
        }

        .info-box-title {
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        /* Concept Explainer - New component for beginners */
        .concept-box {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.05), rgba(168, 85, 247, 0.05));
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
        }

        .concept-box .concept-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--accent-cyan);
            margin-bottom: 15px;
        }

        .concept-box .concept-title::before {
            content: "üí°";
            font-size: 1.5rem;
        }

        .concept-box .simple-explanation {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 15px 20px;
            margin: 15px 0;
            border-left: 3px solid var(--accent-green);
        }

        .concept-box .simple-explanation::before {
            content: "In Simple Terms: ";
            color: var(--accent-green);
            font-weight: 600;
        }

        .concept-box .real-world {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 15px 20px;
            margin: 15px 0;
            border-left: 3px solid var(--accent-orange);
        }

        .concept-box .real-world::before {
            content: "Real World Example: ";
            color: var(--accent-orange);
            font-weight: 600;
        }

        /* Step by Step */
        .step {
            display: flex;
            gap: 20px;
            margin: 30px 0;
            padding: 25px;
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        .step-number {
            flex-shrink: 0;
            width: 50px;
            height: 50px;
            background: var(--gradient-1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--bg-primary);
        }

        .step-content {
            flex: 1;
        }

        .step-content h4 {
            margin-top: 0;
            color: var(--accent-cyan);
        }

        /* Navigation Path */
        .nav-path {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px 20px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin: 15px 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-secondary);
            overflow-x: auto;
            flex-wrap: wrap;
        }

        .nav-path span {
            color: var(--accent-cyan);
        }

        .nav-path .separator {
            color: var(--accent-purple);
        }

        /* Flow Diagrams */
        .diagram {
            margin: 30px 0;
            padding: 30px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        .flow-vertical {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .flow-item {
            padding: 15px 30px;
            background: var(--bg-card);
            border: 2px solid var(--accent-cyan);
            border-radius: 8px;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
            color: var(--accent-cyan);
            text-align: center;
            min-width: 200px;
        }

        .flow-item.source { border-color: var(--accent-green); color: var(--accent-green); }
        .flow-item.transport { border-color: var(--accent-orange); color: var(--accent-orange); }
        .flow-item.collect { border-color: var(--accent-purple); color: var(--accent-purple); }
        .flow-item.transform { border-color: var(--accent-magenta); color: var(--accent-magenta); }
        .flow-item.store { border-color: var(--accent-blue); color: var(--accent-blue); }
        .flow-item.detect { border-color: var(--accent-red); color: var(--accent-red); }

        .flow-arrow {
            color: var(--accent-purple);
            font-size: 1.5rem;
            font-weight: bold;
        }

        .flow-description {
            font-size: 0.85rem;
            color: var(--text-muted);
            text-align: center;
            max-width: 300px;
        }

        /* Architecture Box */
        .architecture-box {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 30px;
            margin: 25px 0;
        }

        .arch-layer {
            background: var(--bg-card);
            border: 2px solid var(--accent-cyan);
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            position: relative;
        }

        .arch-layer-title {
            position: absolute;
            top: -12px;
            left: 20px;
            background: var(--bg-tertiary);
            padding: 0 10px;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
            color: var(--accent-cyan);
            font-size: 0.9rem;
        }

        .arch-components {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .arch-component {
            padding: 10px 20px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Tabs */
        .tabs {
            margin: 25px 0;
        }

        .tab-buttons {
            display: flex;
            gap: 5px;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 0;
        }

        .tab-btn {
            padding: 12px 25px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-family: 'Rajdhani', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .tab-btn:hover {
            color: var(--accent-cyan);
        }

        .tab-btn.active {
            color: var(--accent-cyan);
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--accent-cyan);
        }

        .tab-content {
            display: none;
            padding: 25px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-top: none;
            border-radius: 0 0 12px 12px;
        }

        .tab-content.active {
            display: block;
        }

        /* Skill Level Indicator */
        .skill-level {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .skill-level.beginner {
            background: rgba(0, 255, 136, 0.2);
            color: var(--accent-green);
        }

        .skill-level.intermediate {
            background: rgba(255, 136, 0, 0.2);
            color: var(--accent-orange);
        }

        .skill-level.advanced {
            background: rgba(255, 0, 170, 0.2);
            color: var(--accent-magenta);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .grid-4 { grid-template-columns: repeat(2, 1fr); }
            .grid-3 { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 992px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); }
            .sidebar-toggle { display: block; }
            main { margin-left: 0; padding: 30px 20px; }
            .search-box { width: 200px; }
        }

        @media (max-width: 768px) {
            .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
            .module-header h1 { font-size: 2rem; }
            .step { flex-direction: column; text-align: center; }
            .search-box { display: none; }
        }
    </style>
</head>
<body>
    <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
    </div>

    <header>
        <button class="sidebar-toggle" id="sidebarToggle">‚ò∞</button>
        <div class="logo">DETECTION<span>_</span>ENGINEERING<span>_</span>MASTERY</div>
        <div class="header-center">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search documentation...">
            </div>
        </div>
    </header>

    <nav class="sidebar" id="sidebar">
        <div class="sidebar-section active">
            <div class="sidebar-section-header">üéØ START HERE - Complete Workflow</div>
            <div class="sidebar-links">
                <a href="#workflow-intro" class="sidebar-link">What You'll Learn</a>
                <a href="#workflow-overview" class="sidebar-link">Architecture Overview</a>
                <a href="#step1-source" class="sidebar-link">Step 1: Log Source (SAP)</a>
                <a href="#step2-syslog" class="sidebar-link">Step 2: Syslog Forwarding</a>
                <a href="#step3-ama" class="sidebar-link">Step 3: AMA Installation</a>
                <a href="#step4-dcr" class="sidebar-link">Step 4: DCR Configuration</a>
                <a href="#step5-table" class="sidebar-link">Step 5: Log Analytics Tables</a>
                <a href="#step6-parser" class="sidebar-link">Step 6: Parser Functions</a>
                <a href="#step7-detection" class="sidebar-link">Step 7: Detection Rules</a>
                <a href="#step8-hunting" class="sidebar-link">Step 8: Hunting Queries</a>
            </div>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-section-header">üìö Module 01: Detection Fundamentals</div>
            <div class="sidebar-links">
                <a href="#det-what" class="sidebar-link">What is Detection Engineering?</a>
                <a href="#det-types" class="sidebar-link">Types of Detections</a>
                <a href="#det-lifecycle" class="sidebar-link">Detection Lifecycle</a>
                <a href="#det-pyramid" class="sidebar-link">Pyramid of Pain</a>
                <a href="#det-metrics" class="sidebar-link">Metrics & KPIs</a>
            </div>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-section-header">üìä Module 02: Log Analysis Mastery</div>
            <div class="sidebar-links">
                <a href="#log-what" class="sidebar-link">Understanding Logs</a>
                <a href="#log-formats" class="sidebar-link">Log Formats (Syslog/CEF/JSON)</a>
                <a href="#log-windows" class="sidebar-link">Windows Event Logs</a>
                <a href="#log-linux" class="sidebar-link">Linux Logs</a>
                <a href="#log-parsing" class="sidebar-link">Parsing Techniques</a>
            </div>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-section-header">üîç Module 03: KQL Deep Dive</div>
            <div class="sidebar-links">
                <a href="#kql-intro" class="sidebar-link">KQL Introduction</a>
                <a href="#kql-basics" class="sidebar-link">Basic Operations</a>
                <a href="#kql-filtering" class="sidebar-link">Filtering & Searching</a>
                <a href="#kql-aggregation" class="sidebar-link">Aggregation</a>
                <a href="#kql-joins" class="sidebar-link">Joins & Unions</a>
                <a href="#kql-parsing" class="sidebar-link">Parsing Functions</a>
                <a href="#kql-advanced" class="sidebar-link">Advanced Patterns</a>
            </div>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-section-header">üõ°Ô∏è Module 04: Microsoft Sentinel</div>
            <div class="sidebar-links">
                <a href="#sentinel-what" class="sidebar-link">What is Sentinel?</a>
                <a href="#sentinel-architecture" class="sidebar-link">Architecture</a>
                <a href="#sentinel-connectors" class="sidebar-link">Data Connectors</a>
                <a href="#sentinel-analytics" class="sidebar-link">Analytics Rules</a>
                <a href="#sentinel-workbooks" class="sidebar-link">Workbooks</a>
            </div>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-section-header">üîê Module 05: SAP Security</div>
            <div class="sidebar-links">
                <a href="#sap-intro" class="sidebar-link">SAP Security Basics</a>
                <a href="#sap-logs" class="sidebar-link">SAP Log Types</a>
                <a href="#sap-tcodes" class="sidebar-link">Critical T-Codes</a>
                <a href="#sap-detections" class="sidebar-link">SAP Detections</a>
            </div>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-section-header">üïµÔ∏è Module 06: Threat Intelligence</div>
            <div class="sidebar-links">
                <a href="#ti-intro" class="sidebar-link">TI Fundamentals</a>
                <a href="#ti-mitre" class="sidebar-link">MITRE ATT&CK</a>
                <a href="#ti-hunting" class="sidebar-link">Threat Hunting</a>
            </div>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-section-header">‚òÅÔ∏è Module 07: Cloud Security</div>
            <div class="sidebar-links">
                <a href="#cloud-fundamentals" class="sidebar-link">Cloud Security Basics</a>
                <a href="#cloud-aws" class="sidebar-link">AWS Security</a>
                <a href="#cloud-azure" class="sidebar-link">Azure Security</a>
            </div>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-section-header">ü§ñ Module 08: Automation</div>
            <div class="sidebar-links">
                <a href="#auto-python" class="sidebar-link">Python for Security</a>
                <a href="#auto-powershell" class="sidebar-link">PowerShell</a>
                <a href="#auto-soar" class="sidebar-link">SOAR Playbooks</a>
            </div>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-section-header">üìã Quick Reference</div>
            <div class="sidebar-links">
                <a href="#ref-kql" class="sidebar-link">KQL Cheat Sheet</a>
                <a href="#ref-regex" class="sidebar-link">Regex Patterns</a>
                <a href="#ref-eventids" class="sidebar-link">Windows Event IDs</a>
                <a href="#ref-ports" class="sidebar-link">Common Ports</a>
            </div>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-section-header">üéì Interview Prep</div>
            <div class="sidebar-links">
                <a href="#interview-technical" class="sidebar-link">Technical Questions</a>
                <a href="#interview-scenarios" class="sidebar-link">Scenarios</a>
                <a href="#interview-behavioral" class="sidebar-link">Behavioral (STAR)</a>
            </div>
        </div>
    </nav>

    <main>
        <!-- ============================================== -->
        <!-- WELCOME & INTRODUCTION -->
        <!-- ============================================== -->
        <div class="module" id="workflow-intro">
            <div class="module-header">
                <span class="module-number">WELCOME</span>
                <h1>Your Journey: Zero to Detection Engineer</h1>
                <p class="lead">This comprehensive guide will take you from absolute beginner to advanced practitioner. Every concept is explained in simple terms first, then builds to production-ready implementations.</p>
            </div>

            <div class="info-box beginner">
                <div class="info-box-title">üéØ What Makes This Guide Different</div>
                <p>Unlike other resources that assume prior knowledge, this guide:</p>
                <ul>
                    <li><strong>Explains the "WHY"</strong> before the "HOW"</li>
                    <li><strong>Uses real-world analogies</strong> to make complex concepts click</li>
                    <li><strong>Shows complete workflows</strong> - not just isolated snippets</li>
                    <li><strong>Includes portal navigation</strong> - exactly where to click in Azure/Sentinel</li>
                    <li><strong>Production-ready code</strong> - copy, paste, and customize</li>
                </ul>
            </div>

            <h2>What You'll Master</h2>

            <div class="grid-3">
                <div class="card">
                    <span class="skill-level beginner">üå± Beginner</span>
                    <h4>Foundation Knowledge</h4>
                    <ul>
                        <li>What logs are and why they matter</li>
                        <li>How data flows from source to SIEM</li>
                        <li>Basic KQL query writing</li>
                        <li>Understanding security events</li>
                    </ul>
                </div>
                <div class="card">
                    <span class="skill-level intermediate">üåø Intermediate</span>
                    <h4>Practical Skills</h4>
                    <ul>
                        <li>Configure log collection end-to-end</li>
                        <li>Write effective detection rules</li>
                        <li>Create parsers and workbooks</li>
                        <li>Tune alerts to reduce noise</li>
                    </ul>
                </div>
                <div class="card">
                    <span class="skill-level advanced">üå≥ Advanced</span>
                    <h4>Expert Techniques</h4>
                    <ul>
                        <li>Complex correlation rules</li>
                        <li>Threat hunting methodologies</li>
                        <li>Automation with Python/PowerShell</li>
                        <li>MITRE ATT&CK mapping</li>
                    </ul>
                </div>
            </div>

            <h2>The Big Picture: How Everything Connects</h2>

            <div class="concept-box">
                <div class="concept-title">Understanding the Detection Pipeline</div>
                <p>Before diving into details, let's understand the complete journey of a security event - from when it happens to when an analyst gets alerted.</p>
                
                <div class="simple-explanation">
                    Think of it like a postal system: Something happens (letter written) ‚Üí Gets packaged (log created) ‚Üí Transported (syslog) ‚Üí Sorted at distribution center (AMA/DCR) ‚Üí Stored in warehouse (Log Analytics) ‚Üí Analyzed by workers (Detection Rules) ‚Üí Important items flagged (Alerts)
                </div>
            </div>

            <div class="diagram">
                <div class="flow-vertical">
                    <div class="flow-item source">üì± LOG SOURCE</div>
                    <div class="flow-description">SAP, Windows, Linux, Firewalls, Applications<br><em>Where security events originate</em></div>
                    <div class="flow-arrow">‚Üì</div>
                    
                    <div class="flow-item transport">üì° LOG FORWARDING</div>
                    <div class="flow-description">Syslog (UDP/TCP 514), CEF, JSON<br><em>How logs travel across the network</em></div>
                    <div class="flow-arrow">‚Üì</div>
                    
                    <div class="flow-item collect">üñ•Ô∏è COLLECTION SERVER</div>
                    <div class="flow-description">Linux VM + Azure Monitor Agent (AMA)<br><em>Receives and prepares logs for Azure</em></div>
                    <div class="flow-arrow">‚Üì</div>
                    
                    <div class="flow-item transform">‚öôÔ∏è DATA COLLECTION RULE (DCR)</div>
                    <div class="flow-description">Parsing, Filtering, Transformation<br><em>Structures raw logs into usable data</em></div>
                    <div class="flow-arrow">‚Üì</div>
                    
                    <div class="flow-item store">üíæ LOG ANALYTICS WORKSPACE</div>
                    <div class="flow-description">Tables, Retention, Indexing<br><em>Where your data lives and is queryable</em></div>
                    <div class="flow-arrow">‚Üì</div>
                    
                    <div class="flow-item detect">üö® MICROSOFT SENTINEL</div>
                    <div class="flow-description">Analytics Rules, Hunting, Incidents<br><em>Where threats are detected and investigated</em></div>
                </div>
            </div>
        </div>

        <!-- ============================================== -->
        <!-- COMPLETE WORKFLOW - STEP BY STEP -->
        <!-- ============================================== -->
        <div class="module" id="workflow-overview">
            <div class="module-header">
                <span class="module-number">COMPLETE WORKFLOW</span>
                <h1>End-to-End: SAP Logs to Sentinel Detections</h1>
                <p class="lead">Follow this complete walkthrough to understand every step of collecting custom logs (using SAP as our example) and building detections in Microsoft Sentinel.</p>
            </div>

            <div class="info-box important">
                <div class="info-box-title">Why SAP as Our Example?</div>
                <p>SAP is one of the most complex enterprise applications, handling critical business data. If you can secure SAP logs, you can secure anything. The same workflow applies to:</p>
                <ul>
                    <li>Custom applications</li>
                    <li>Network devices (firewalls, switches)</li>
                    <li>IoT devices</li>
                    <li>Any system that generates syslog</li>
                </ul>
            </div>

            <h2>Architecture Deep Dive</h2>

            <div class="architecture-box">
                <h3 style="color: var(--accent-cyan); margin-top: 0;">Complete Infrastructure Diagram</h3>
                
                <div class="arch-layer" style="border-color: var(--accent-green);">
                    <span class="arch-layer-title" style="color: var(--accent-green);">üì± LAYER 1: Log Sources (Your Environment)</span>
                    <p style="color: var(--text-secondary); margin-top: 15px;">These are the systems that generate security events. They need to be configured to forward logs.</p>
                    <div class="arch-components">
                        <div class="arch-component">SAP ERP (PRD/QAS/DEV)</div>
                        <div class="arch-component">SAP S/4HANA</div>
                        <div class="arch-component">Custom Java Apps</div>
                        <div class="arch-component">Linux Servers</div>
                        <div class="arch-component">Network Firewalls</div>
                    </div>
                </div>
                
                <div style="text-align: center; color: var(--accent-purple); font-size: 2rem; margin: 10px 0;">‚Üì <span style="font-size: 0.9rem;">Syslog Protocol (UDP/TCP 514)</span> ‚Üì</div>
                
                <div class="arch-layer" style="border-color: var(--accent-orange);">
                    <span class="arch-layer-title" style="color: var(--accent-orange);">üì° LAYER 2: Syslog Collector (Your Datacenter/Azure)</span>
                    <p style="color: var(--text-secondary); margin-top: 15px;">A Linux VM that receives logs from all sources. Acts as a central collection point.</p>
                    <div class="arch-components">
                        <div class="arch-component">Ubuntu 22.04 LTS VM</div>
                        <div class="arch-component">rsyslog service</div>
                        <div class="arch-component">Log files: /var/log/sap-audit.log</div>
                        <div class="arch-component">Azure Monitor Agent (AMA)</div>
                    </div>
                </div>
                
                <div style="text-align: center; color: var(--accent-purple); font-size: 2rem; margin: 10px 0;">‚Üì <span style="font-size: 0.9rem;">HTTPS (443) via DCE</span> ‚Üì</div>
                
                <div class="arch-layer" style="border-color: var(--accent-purple);">
                    <span class="arch-layer-title" style="color: var(--accent-purple);">‚öôÔ∏è LAYER 3: Azure Data Pipeline</span>
                    <p style="color: var(--text-secondary); margin-top: 15px;">Azure services that process, transform, and route your data.</p>
                    <div class="arch-components">
                        <div class="arch-component">Data Collection Endpoint (DCE)</div>
                        <div class="arch-component">Data Collection Rule (DCR)</div>
                        <div class="arch-component">transformKql (parsing)</div>
                    </div>
                </div>
                
                <div style="text-align: center; color: var(--accent-purple); font-size: 2rem; margin: 10px 0;">‚Üì <span style="font-size: 0.9rem;">Ingestion Pipeline</span> ‚Üì</div>
                
                <div class="arch-layer" style="border-color: var(--accent-blue);">
                    <span class="arch-layer-title" style="color: var(--accent-blue);">üíæ LAYER 4: Log Analytics Workspace</span>
                    <p style="color: var(--text-secondary); margin-top: 15px;">Where all your data is stored and indexed for fast querying.</p>
                    <div class="arch-components">
                        <div class="arch-component">Custom Tables (SAPAuditLog_CL)</div>
                        <div class="arch-component">Parser Functions</div>
                        <div class="arch-component">Retention Policies</div>
                        <div class="arch-component">KQL Query Engine</div>
                    </div>
                </div>
                
                <div style="text-align: center; color: var(--accent-purple); font-size: 2rem; margin: 10px 0;">‚Üì <span style="font-size: 0.9rem;">Sentinel Connection</span> ‚Üì</div>
                
                <div class="arch-layer" style="border-color: var(--accent-red);">
                    <span class="arch-layer-title" style="color: var(--accent-red);">üö® LAYER 5: Microsoft Sentinel</span>
                    <p style="color: var(--text-secondary); margin-top: 15px;">Your SIEM - where detection, investigation, and response happens.</p>
                    <div class="arch-components">
                        <div class="arch-component">Analytics Rules</div>
                        <div class="arch-component">Hunting Queries</div>
                        <div class="arch-component">Incidents</div>
                        <div class="arch-component">Workbooks</div>
                        <div class="arch-component">Automation (Playbooks)</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================== -->
        <!-- STEP 1: LOG SOURCE CONFIGURATION -->
        <!-- ============================================== -->
        <div class="module" id="step1-source">
            <div class="module-header">
                <span class="module-number">STEP 1 OF 8</span>
                <h1>Log Source Configuration</h1>
                <p class="lead">Configure your application (SAP in this example) to generate and forward security logs. This is where everything begins.</p>
            </div>

            <span class="skill-level beginner">üå± Beginner Friendly</span>

            <div class="concept-box">
                <div class="concept-title">What is a Security Audit Log?</div>
                <p>A Security Audit Log is a record of security-relevant events that happen in a system. It answers questions like:</p>
                <ul>
                    <li>Who logged in and when?</li>
                    <li>Who accessed sensitive data?</li>
                    <li>What administrative changes were made?</li>
                    <li>Were there any failed access attempts?</li>
                </ul>
                
                <div class="simple-explanation">
                    Think of it like a security camera system for your software. Instead of video, it records text descriptions of every important action.
                </div>
                
                <div class="real-world">
                    When someone tries to login to your bank account 10 times with wrong passwords, the bank's audit log records each attempt. This is how they detect and block suspicious activity.
                </div>
            </div>

            <h2>SAP Security Audit Log (SAL)</h2>

            <h3>What Events Does SAP Log?</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Message Class</th>
                            <th>Category</th>
                            <th>What It Tracks</th>
                            <th>Security Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="badge badge-magenta">AU1</span></td>
                            <td>Dialog Logon</td>
                            <td>User logins via SAP GUI - success and failures</td>
                            <td>üî¥ Critical - Detect brute force, compromised accounts</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-orange">AU2</span></td>
                            <td>RFC/CPIC Logon</td>
                            <td>System-to-system authentication</td>
                            <td>üî¥ Critical - Detect lateral movement between SAP systems</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-cyan">AU3</span></td>
                            <td>Transaction Start</td>
                            <td>Every T-code (transaction) a user executes</td>
                            <td>üü° High - Monitor for sensitive transaction usage</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-green">AU4</span></td>
                            <td>Report Start</td>
                            <td>ABAP programs/reports executed</td>
                            <td>üü° High - Detect unauthorized code execution</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-purple">AU5</span></td>
                            <td>RFC Function Call</td>
                            <td>Remote function module calls</td>
                            <td>üü° High - Detect API abuse</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-red">AUW</span></td>
                            <td>User Master Change</td>
                            <td>User creation, deletion, role changes</td>
                            <td>üî¥ Critical - Detect privilege escalation</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>Step 1.1: Enable Security Audit Log in SAP</h3>

            <div class="step">
                <div class="step-number">A</div>
                <div class="step-content">
                    <h4>Access SAP Profile Parameters</h4>
                    <p>First, we need to enable the audit log at the system level. This requires changing SAP profile parameters.</p>
                    
                    <div class="nav-path">
                        <span>SAP GUI</span>
                        <span class="separator">‚Üí</span>
                        <span>Transaction: RZ10</span>
                        <span class="separator">‚Üí</span>
                        <span>Select Profile</span>
                        <span class="separator">‚Üí</span>
                        <span>Extended Maintenance</span>
                    </div>

                    <div class="info-box note">
                        <div class="info-box-title">üí° What is RZ10?</div>
                        <p>RZ10 is the SAP transaction for managing profile parameters - the configuration settings that control how SAP behaves. Think of it like the "Settings" app for SAP.</p>
                    </div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">B</div>
                <div class="step-content">
                    <h4>Add Required Parameters</h4>
                    <p>Add these parameters to enable and configure the Security Audit Log:</p>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">SAP Profile</span>
                            <span class="code-title">Security Audit Log Parameters (RZ10)</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre><span class="cmt"># ============================================</span>
<span class="cmt"># SECURITY AUDIT LOG CONFIGURATION</span>
<span class="cmt"># Add these to your DEFAULT or Instance profile</span>
<span class="cmt"># ============================================</span>

<span class="cmt"># STEP 1: Enable the Security Audit Log</span>
<span class="prop">rsau/enable</span> = <span class="num">1</span>
<span class="cmt"># Values: 0 = disabled, 1 = enabled</span>
<span class="cmt"># This is the master switch - nothing works without this!</span>

<span class="cmt"># STEP 2: Configure storage limits</span>
<span class="prop">rsau/max_diskspace/local</span> = <span class="num">2000M</span>
<span class="cmt"># Maximum total disk space for ALL audit files</span>
<span class="cmt"># Recommendation: At least 2GB for production systems</span>

<span class="prop">rsau/max_diskspace/per_file</span> = <span class="num">200M</span>
<span class="cmt"># Maximum size of each individual audit file</span>
<span class="cmt"># When reached, SAP creates a new file</span>

<span class="prop">rsau/max_diskspace/per_day</span> = <span class="num">1000M</span>
<span class="cmt"># Maximum logs generated per day</span>
<span class="cmt"># Prevents runaway logging from filling disk</span>

<span class="cmt"># STEP 3: Configure filter slots (optional but recommended)</span>
<span class="prop">rsau/selection_slots</span> = <span class="num">10</span>
<span class="cmt"># Number of filter configurations you can define</span>
<span class="cmt"># More slots = more granular control over what's logged</span>

<span class="cmt"># STEP 4: Enable integrity protection (recommended)</span>
<span class="prop">rsau/integrity</span> = <span class="num">1</span>
<span class="cmt"># Adds checksums to detect log tampering</span>
<span class="cmt"># Critical for forensic investigations</span>

<span class="cmt"># STEP 5: Configure log file location (optional)</span>
<span class="prop">rsau/local/file</span> = <span class="str">/usr/sap/$(SAPSYSTEMNAME)/$(INSTANCE_NAME)/log/audit_++++++++</span>
<span class="cmt"># Default location is fine for most cases</span>
<span class="cmt"># The + symbols are replaced with date/sequence numbers</span></pre>
                    </div>

                    <div class="info-box warning">
                        <div class="info-box-title">‚ö†Ô∏è Important: Restart Required</div>
                        <p>After changing profile parameters, you must <strong>restart the SAP instance</strong> for changes to take effect. Plan this during a maintenance window.</p>
                    </div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">C</div>
                <div class="step-content">
                    <h4>Configure Audit Filters (SM19)</h4>
                    <p>Now define WHAT events to log. This is done in transaction SM19.</p>
                    
                    <div class="nav-path">
                        <span>SAP GUI</span>
                        <span class="separator">‚Üí</span>
                        <span>Transaction: SM19</span>
                        <span class="separator">‚Üí</span>
                        <span>Configuration of Security Audit</span>
                    </div>

                    <div class="concept-box">
                        <div class="concept-title">Understanding SM19 Filters</div>
                        <p>SM19 lets you create "filters" that specify:</p>
                        <ul>
                            <li><strong>Client:</strong> Which SAP client (100, 200, etc.) or * for all</li>
                            <li><strong>User:</strong> Which users to audit (* for all, or specific names)</li>
                            <li><strong>Event Class:</strong> What types of events (AU1, AU2, etc.)</li>
                            <li><strong>Status:</strong> Success, Failure, or Both</li>
                        </ul>
                        
                        <div class="simple-explanation">
                            Filters are like rules saying "Record [this type of event] for [these users] in [this client]"
                        </div>
                    </div>

                    <h4>Recommended Filter Configuration</h4>
                    
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Filter #</th>
                                    <th>Client</th>
                                    <th>User</th>
                                    <th>Event Classes</th>
                                    <th>Status</th>
                                    <th>Purpose</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>01</td>
                                    <td>*</td>
                                    <td>*</td>
                                    <td>AU1</td>
                                    <td>Both</td>
                                    <td>All dialog logons (success + failure)</td>
                                </tr>
                                <tr>
                                    <td>02</td>
                                    <td>*</td>
                                    <td>*</td>
                                    <td>AU2</td>
                                    <td>Both</td>
                                    <td>All RFC logons</td>
                                </tr>
                                <tr>
                                    <td>03</td>
                                    <td>*</td>
                                    <td>*</td>
                                    <td>AUW</td>
                                    <td>Both</td>
                                    <td>All user master changes</td>
                                </tr>
                                <tr>
                                    <td>04</td>
                                    <td>*</td>
                                    <td>*</td>
                                    <td>AU3</td>
                                    <td>Success</td>
                                    <td>Transaction execution (success only to reduce volume)</td>
                                </tr>
                                <tr>
                                    <td>05</td>
                                    <td>*</td>
                                    <td>DDIC,SAP*</td>
                                    <td>AU3,AU4,AU5</td>
                                    <td>Both</td>
                                    <td>All activity by system/admin accounts</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">D</div>
                <div class="step-content">
                    <h4>Configure Syslog Output</h4>
                    <p>Now we need SAP to SEND these logs somewhere. We'll configure it to forward to a syslog server.</p>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">SAP Profile</span>
                            <span class="code-title">Syslog Forwarding Parameters</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre><span class="cmt"># ============================================</span>
<span class="cmt"># SYSLOG FORWARDING CONFIGURATION</span>
<span class="cmt"># Add these to forward audit logs to your collector</span>
<span class="cmt"># ============================================</span>

<span class="cmt"># Enable syslog forwarding</span>
<span class="prop">rsau/syslog</span> = <span class="num">1</span>

<span class="cmt"># Syslog server IP address</span>
<span class="cmt"># Replace with YOUR syslog collector IP!</span>
<span class="prop">rsau/syslog/host</span> = <span class="str">10.0.1.50</span>

<span class="cmt"># Syslog port (514 is standard)</span>
<span class="prop">rsau/syslog/port</span> = <span class="num">514</span>

<span class="cmt"># Protocol: UDP is common, TCP is more reliable</span>
<span class="prop">rsau/syslog/protocol</span> = <span class="str">TCP</span>

<span class="cmt"># Syslog facility (local0-local7 for custom apps)</span>
<span class="prop">rsau/syslog/facility</span> = <span class="num">16</span>
<span class="cmt"># 16 = local0, 17 = local1, etc.</span>
<span class="cmt"># Using local0 helps us filter SAP logs on the collector</span>

<span class="cmt"># Message format - CEF is recommended for SIEM</span>
<span class="prop">rsau/syslog/format</span> = <span class="str">CEF</span>
<span class="cmt"># Options: CEF, LEEF, or leave blank for raw</span>
<span class="cmt"># CEF = Common Event Format (industry standard)</span></pre>
                    </div>

                    <div class="info-box tip">
                        <div class="info-box-title">üí° CEF Format Explained</div>
                        <p><strong>CEF (Common Event Format)</strong> is an industry-standard log format that structures data into consistent fields. It makes parsing much easier.</p>
                        <p>A CEF message looks like:</p>
                        <code class="inline-code">CEF:0|Vendor|Product|Version|EventID|Name|Severity|Extension</code>
                    </div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">E</div>
                <div class="step-content">
                    <h4>Verify SAP Audit Logging</h4>
                    <p>After configuration, verify that logging is working:</p>
                    
                    <div class="nav-path">
                        <span>SAP GUI</span>
                        <span class="separator">‚Üí</span>
                        <span>Transaction: SM21</span>
                        <span class="separator">‚Üí</span>
                        <span>System Log</span>
                    </div>

                    <div class="nav-path">
                        <span>SAP GUI</span>
                        <span class="separator">‚Üí</span>
                        <span>Transaction: SM20</span>
                        <span class="separator">‚Üí</span>
                        <span>Security Audit Log Analysis</span>
                    </div>

                    <p>In SM20, you should see recent audit events. If empty, check your filter configuration in SM19.</p>
                </div>
            </div>

            <h3>Sample SAP Audit Log Output</h3>
            <p>Here's what SAP audit logs look like when forwarded via syslog in CEF format:</p>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Syslog/CEF</span>
                    <span class="code-title">SAP Audit Log Examples</span>
                </div>
                <pre><span class="cmt"># Example 1: Successful Login (AU1/AUB)</span>
<span class="str">&lt;134&gt;</span>Dec 17 09:23:45 sapserver01 CEF:0|SAP|SecurityAuditLog|7.50|AUB|Logon successful|3|
    <span class="prop">src</span>=<span class="str">10.0.1.100</span>
    <span class="prop">suser</span>=<span class="str">JSMITH</span>
    <span class="prop">dhost</span>=<span class="str">PRD</span>
    <span class="prop">cs1</span>=<span class="str">100</span> <span class="prop">cs1Label</span>=<span class="str">Client</span>
    <span class="prop">cs2</span>=<span class="str">SAPGUI</span> <span class="prop">cs2Label</span>=<span class="str">TerminalType</span>
    <span class="prop">cs3</span>=<span class="str">AU1</span> <span class="prop">cs3Label</span>=<span class="str">MessageClass</span>
    <span class="prop">outcome</span>=<span class="str">Success</span>

<span class="cmt"># Example 2: Failed Login (AU1/AUF) - 5+ of these = brute force!</span>
<span class="str">&lt;131&gt;</span>Dec 17 09:24:12 sapserver01 CEF:0|SAP|SecurityAuditLog|7.50|AUF|Logon failed|7|
    <span class="prop">src</span>=<span class="str">192.168.50.99</span>
    <span class="prop">suser</span>=<span class="str">ADMIN</span>
    <span class="prop">dhost</span>=<span class="str">PRD</span>
    <span class="prop">cs1</span>=<span class="str">100</span> <span class="prop">cs1Label</span>=<span class="str">Client</span>
    <span class="prop">cs4</span>=<span class="str">Invalid password</span> <span class="prop">cs4Label</span>=<span class="str">Reason</span>
    <span class="prop">outcome</span>=<span class="str">Failure</span>

<span class="cmt"># Example 3: Critical Transaction Executed (AU3/AUL)</span>
<span class="str">&lt;134&gt;</span>Dec 17 09:30:00 sapserver01 CEF:0|SAP|SecurityAuditLog|7.50|AUL|Transaction started|5|
    <span class="prop">src</span>=<span class="str">10.0.1.100</span>
    <span class="prop">suser</span>=<span class="str">BPADMIN</span>
    <span class="prop">dhost</span>=<span class="str">PRD</span>
    <span class="prop">cs1</span>=<span class="str">100</span> <span class="prop">cs1Label</span>=<span class="str">Client</span>
    <span class="prop">cs5</span>=<span class="str">SE16</span> <span class="prop">cs5Label</span>=<span class="str">TransactionCode</span>
    <span class="cmt"># SE16 = Data Browser - can access ANY table! High risk!</span>

<span class="cmt"># Example 4: User Created (AUW/AUY) - watch for unauthorized creation</span>
<span class="str">&lt;134&gt;</span>Dec 17 14:15:30 sapserver01 CEF:0|SAP|SecurityAuditLog|7.50|AUY|User master record created|7|
    <span class="prop">src</span>=<span class="str">10.0.1.200</span>
    <span class="prop">suser</span>=<span class="str">SECADMIN</span>
    <span class="prop">dhost</span>=<span class="str">PRD</span>
    <span class="prop">duser</span>=<span class="str">NEWUSER01</span>
    <span class="prop">cs1</span>=<span class="str">100</span> <span class="prop">cs1Label</span>=<span class="str">Client</span>
    <span class="prop">cs3</span>=<span class="str">AUW</span> <span class="prop">cs3Label</span>=<span class="str">MessageClass</span></pre>
            </div>

            <div class="info-box tip">
                <div class="info-box-title">üîç Understanding the CEF Fields</div>
                <div class="grid-2">
                    <div>
                        <p><strong>Standard CEF Fields:</strong></p>
                        <ul>
                            <li><code class="inline-code">src</code> - Source IP address</li>
                            <li><code class="inline-code">suser</code> - Source user (who did it)</li>
                            <li><code class="inline-code">dhost</code> - Destination host (SAP SID)</li>
                            <li><code class="inline-code">duser</code> - Destination user (affected user)</li>
                            <li><code class="inline-code">outcome</code> - Success or Failure</li>
                        </ul>
                    </div>
                    <div>
                        <p><strong>Custom String Fields (cs1-cs6):</strong></p>
                        <ul>
                            <li><code class="inline-code">cs1</code> - SAP Client number</li>
                            <li><code class="inline-code">cs2</code> - Terminal type</li>
                            <li><code class="inline-code">cs3</code> - Message class (AU1, AU3, etc.)</li>
                            <li><code class="inline-code">cs4</code> - Failure reason</li>
                            <li><code class="inline-code">cs5</code> - Transaction code</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================== -->
        <!-- STEP 2: SYSLOG FORWARDING -->
        <!-- ============================================== -->
        <div class="module" id="step2-syslog">
            <div class="module-header">
                <span class="module-number">STEP 2 OF 8</span>
                <h1>Syslog Server Configuration</h1>
                <p class="lead">Set up a Linux server to receive logs from SAP (and other sources) and prepare them for Azure Monitor Agent collection.</p>
            </div>

            <span class="skill-level beginner">üå± Beginner Friendly</span>

            <div class="concept-box">
                <div class="concept-title">What is Syslog?</div>
                <p><strong>Syslog</strong> is a standard protocol for sending log messages across a network. It's been around since the 1980s and is supported by virtually every device and application.</p>
                
                <div class="simple-explanation">
                    Think of syslog like a postal service for logs. Devices put their logs in an "envelope" (syslog format) and send them to a central "post office" (syslog server) which sorts and stores them.
                </div>
                
                <div class="real-world">
                    Your home router, corporate firewalls, Linux servers, SAP systems, network switches - they ALL can send logs via syslog. It's the universal language of logging.
                </div>
            </div>

            <h2>Syslog Fundamentals</h2>

            <h3>Syslog Message Structure</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Syslog</span>
                    <span class="code-title">Anatomy of a Syslog Message</span>
                </div>
                <pre><span class="cmt"># Basic syslog format (RFC 3164)</span>
<span class="str">&lt;PRI&gt;</span>TIMESTAMP HOSTNAME TAG: MESSAGE

<span class="cmt"># Breaking it down:</span>
<span class="str">&lt;134&gt;</span>Dec 17 09:23:45 sapserver01 SAP: User JSMITH logged in

<span class="cmt"># &lt;134&gt; = Priority (Facility * 8 + Severity)</span>
<span class="cmt">#   Facility 16 (local0) * 8 + Severity 6 (info) = 134</span>
<span class="cmt"># Dec 17 09:23:45 = Timestamp</span>
<span class="cmt"># sapserver01 = Hostname of the sender</span>
<span class="cmt"># SAP: = Tag (application name)</span>
<span class="cmt"># User JSMITH logged in = The actual message</span></pre>
            </div>

            <h3>Syslog Severity Levels</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Level</th>
                            <th>Name</th>
                            <th>Description</th>
                            <th>Example</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>0</td>
                            <td><span class="badge badge-red">Emergency</span></td>
                            <td>System is unusable</td>
                            <td>Kernel panic, hardware failure</td>
                        </tr>
                        <tr>
                            <td>1</td>
                            <td><span class="badge badge-red">Alert</span></td>
                            <td>Immediate action needed</td>
                            <td>Database corruption detected</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td><span class="badge badge-magenta">Critical</span></td>
                            <td>Critical conditions</td>
                            <td>Application crash</td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td><span class="badge badge-orange">Error</span></td>
                            <td>Error conditions</td>
                            <td>Failed to write file</td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td><span class="badge badge-yellow">Warning</span></td>
                            <td>Warning conditions</td>
                            <td>Disk space low</td>
                        </tr>
                        <tr>
                            <td>5</td>
                            <td><span class="badge badge-cyan">Notice</span></td>
                            <td>Normal but significant</td>
                            <td>Service started</td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td><span class="badge badge-blue">Info</span></td>
                            <td>Informational</td>
                            <td>User logged in</td>
                        </tr>
                        <tr>
                            <td>7</td>
                            <td><span class="badge badge-green">Debug</span></td>
                            <td>Debug-level messages</td>
                            <td>Variable value = X</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h2>Deploy the Syslog Collector</h2>

            <div class="step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h4>Create Linux VM in Azure</h4>
                    <p>We need a Linux VM to act as our syslog collector. This can be in Azure or on-premises.</p>
                    
                    <div class="tabs">
                        <div class="tab-buttons">
                            <button class="tab-btn active" data-tab="vm-portal">Azure Portal</button>
                            <button class="tab-btn" data-tab="vm-cli">Azure CLI</button>
                        </div>
                        
                        <div class="tab-content active" id="vm-portal">
                            <h4>Create VM via Azure Portal</h4>
                            <div class="nav-path">
                                <span>Azure Portal</span>
                                <span class="separator">‚Üí</span>
                                <span>Virtual Machines</span>
                                <span class="separator">‚Üí</span>
                                <span>+ Create</span>
                                <span class="separator">‚Üí</span>
                                <span>Azure virtual machine</span>
                            </div>
                            
                            <p><strong>Recommended Settings:</strong></p>
                            <ul>
                                <li><strong>Image:</strong> Ubuntu Server 22.04 LTS</li>
                                <li><strong>Size:</strong> Standard_D2s_v3 (2 vCPU, 8 GB RAM)</li>
                                <li><strong>Authentication:</strong> SSH public key (more secure than password)</li>
                                <li><strong>Inbound ports:</strong> SSH (22) only initially</li>
                            </ul>
                        </div>
                        
                        <div class="tab-content" id="vm-cli">
                            <div class="code-block">
                                <div class="code-header">
                                    <span class="code-lang">Azure CLI</span>
                                    <span class="code-title">Create Syslog Collector VM</span>
                                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                                </div>
                                <pre><span class="cmt"># Login to Azure</span>
<span class="fn">az</span> login

<span class="cmt"># Create resource group</span>
<span class="fn">az</span> group create \
    --name <span class="str">"rg-syslog-collector"</span> \
    --location <span class="str">"eastus"</span>

<span class="cmt"># Create the VM</span>
<span class="fn">az</span> vm create \
    --resource-group <span class="str">"rg-syslog-collector"</span> \
    --name <span class="str">"vm-syslog-01"</span> \
    --image <span class="str">"Ubuntu2204"</span> \
    --size <span class="str">"Standard_D2s_v3"</span> \
    --admin-username <span class="str">"azureadmin"</span> \
    --generate-ssh-keys \
    --public-ip-sku <span class="str">"Standard"</span>

<span class="cmt"># Output will show the public IP address - save this!</span></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h4>Configure Network Security Group (NSG)</h4>
                    <p>Open the syslog ports so devices can send logs to this VM.</p>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Azure CLI</span>
                            <span class="code-title">Open Syslog Ports</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre><span class="cmt"># Allow syslog traffic (UDP and TCP port 514)</span>
<span class="fn">az</span> network nsg rule create \
    --resource-group <span class="str">"rg-syslog-collector"</span> \
    --nsg-name <span class="str">"vm-syslog-01NSG"</span> \
    --name <span class="str">"Allow-Syslog-514"</span> \
    --priority <span class="num">100</span> \
    --destination-port-ranges <span class="num">514</span> \
    --protocol <span class="str">"*"</span> \
    --access <span class="str">"Allow"</span> \
    --direction <span class="str">"Inbound"</span> \
    --source-address-prefixes <span class="str">"10.0.0.0/8"</span>  <span class="cmt"># Restrict to your network!</span>

<span class="cmt"># Allow secure syslog (TLS on port 6514) - optional but recommended</span>
<span class="fn">az</span> network nsg rule create \
    --resource-group <span class="str">"rg-syslog-collector"</span> \
    --nsg-name <span class="str">"vm-syslog-01NSG"</span> \
    --name <span class="str">"Allow-Syslog-TLS-6514"</span> \
    --priority <span class="num">110</span> \
    --destination-port-ranges <span class="num">6514</span> \
    --protocol <span class="str">"TCP"</span> \
    --access <span class="str">"Allow"</span> \
    --direction <span class="str">"Inbound"</span> \
    --source-address-prefixes <span class="str">"10.0.0.0/8"</span></pre>
                    </div>

                    <div class="info-box warning">
                        <div class="info-box-title">üîí Security Best Practice</div>
                        <p>Never open syslog ports to the entire internet! Always restrict <code class="inline-code">--source-address-prefixes</code> to your internal network ranges.</p>
                    </div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h4>SSH into the VM and Configure rsyslog</h4>
                    <p>Now we'll configure the syslog service to receive and organize logs.</p>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Bash</span>
                            <span class="code-title">Connect and Update</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre><span class="cmt"># Connect to your VM (replace with your VM's public IP)</span>
<span class="fn">ssh</span> azureadmin@<span class="str">&lt;your-vm-public-ip&gt;</span>

<span class="cmt"># Update the system</span>
<span class="fn">sudo</span> apt update && <span class="fn">sudo</span> apt upgrade -y

<span class="cmt"># rsyslog is usually pre-installed, but ensure it's there</span>
<span class="fn">sudo</span> apt install -y rsyslog

<span class="cmt"># Check rsyslog status</span>
<span class="fn">sudo</span> systemctl status rsyslog</pre>
                    </div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <h4>Configure rsyslog to Receive Remote Logs</h4>
                    <p>Edit the main rsyslog configuration file:</p>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Bash</span>
                            <span class="code-title">Edit rsyslog.conf</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre><span class="cmt"># Open the config file with your preferred editor</span>
<span class="fn">sudo</span> nano /etc/rsyslog.conf</pre>
                    </div>

                    <p>Add or uncomment these sections:</p>

                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Config</span>
                            <span class="code-title">/etc/rsyslog.conf - Complete Configuration</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre><span class="cmt">#####################################################</span>
<span class="cmt"># /etc/rsyslog.conf - Syslog Collector Configuration</span>
<span class="cmt">#####################################################</span>

<span class="cmt"># ============================================</span>
<span class="cmt"># MODULES - Load the components we need</span>
<span class="cmt"># ============================================</span>

<span class="cmt"># Provides UDP syslog reception</span>
<span class="cmt"># UNCOMMENT these two lines:</span>
<span class="kw">module</span>(load=<span class="str">"imudp"</span>)
<span class="kw">input</span>(type=<span class="str">"imudp"</span> port=<span class="str">"514"</span>)

<span class="cmt"># Provides TCP syslog reception</span>
<span class="cmt"># UNCOMMENT these two lines:</span>
<span class="kw">module</span>(load=<span class="str">"imtcp"</span>)
<span class="kw">input</span>(type=<span class="str">"imtcp"</span> port=<span class="str">"514"</span>)

<span class="cmt"># ============================================</span>
<span class="cmt"># TEMPLATES - Define log file formats</span>
<span class="cmt"># ============================================</span>

<span class="cmt"># Template that preserves the complete original message</span>
<span class="cmt"># This is important for parsing in Azure</span>
<span class="kw">template</span>(name=<span class="str">"RemoteLogFormat"</span> type=<span class="str">"string"</span>
    string=<span class="str">"%TIMESTAMP% %HOSTNAME% %syslogtag%%msg%\n"</span>)

<span class="cmt"># Template for organizing logs by source</span>
<span class="kw">template</span>(name=<span class="str">"RemoteHost"</span> type=<span class="str">"string"</span>
    string=<span class="str">"/var/log/remote/%HOSTNAME%/%PROGRAMNAME%.log"</span>)

<span class="cmt"># ============================================</span>
<span class="cmt"># RULES - Route logs to appropriate files</span>
<span class="cmt"># ============================================</span>

<span class="cmt"># Rule 1: SAP Audit Logs</span>
<span class="cmt"># Match logs containing SAP CEF format</span>
<span class="kw">if</span> $msg <span class="kw">contains</span> <span class="str">'SAP|SecurityAuditLog'</span> <span class="kw">then</span> {
    <span class="kw">action</span>(type=<span class="str">"omfile"</span> 
           file=<span class="str">"/var/log/sap-audit.log"</span>
           template=<span class="str">"RemoteLogFormat"</span>)
    <span class="kw">stop</span>  <span class="cmt"># Don't process this message further</span>
}

<span class="cmt"># Rule 2: All CEF format logs (firewalls, etc.)</span>
<span class="kw">if</span> $msg <span class="kw">contains</span> <span class="str">'CEF:'</span> <span class="kw">then</span> {
    <span class="kw">action</span>(type=<span class="str">"omfile"</span>
           file=<span class="str">"/var/log/cef-security.log"</span>
           template=<span class="str">"RemoteLogFormat"</span>)
    <span class="kw">stop</span>
}

<span class="cmt"># Rule 3: Local facility logs (local0 = facility 16)</span>
<span class="cmt"># SAP is configured to use local0</span>
<span class="kw">local0</span>.* /var/log/sap-local0.log

<span class="cmt"># Rule 4: Catch-all for other remote logs</span>
<span class="cmt"># Organizes by hostname and program name</span>
<span class="kw">if</span> $fromhost-ip != <span class="str">'127.0.0.1'</span> <span class="kw">then</span> {
    <span class="kw">action</span>(type=<span class="str">"omfile"</span>
           dynaFile=<span class="str">"RemoteHost"</span>)
}

<span class="cmt"># ============================================</span>
<span class="cmt"># DEFAULT RULES (keep these at the bottom)</span>
<span class="cmt"># ============================================</span>

<span class="cmt"># Standard local logging</span>
*.info;mail.none;authpriv.none;cron.none    /var/log/messages
authpriv.*                                   /var/log/secure
mail.*                                       /var/log/maillog
cron.*                                       /var/log/cron
*.emerg                                      :omusrmsg:*</pre>
                    </div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">5</div>
                <div class="step-content">
                    <h4>Create Log Directories and Set Permissions</h4>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Bash</span>
                            <span class="code-title">Setup Directories and Permissions</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre><span class="cmt"># Create directory for remote logs</span>
<span class="fn">sudo</span> mkdir -p /var/log/remote

<span class="cmt"># Create the SAP audit log file</span>
<span class="fn">sudo</span> touch /var/log/sap-audit.log
<span class="fn">sudo</span> touch /var/log/cef-security.log

<span class="cmt"># Set proper ownership (syslog user)</span>
<span class="fn">sudo</span> chown syslog:adm /var/log/sap-audit.log
<span class="fn">sudo</span> chown syslog:adm /var/log/cef-security.log
<span class="fn">sudo</span> chown -R syslog:adm /var/log/remote

<span class="cmt"># Set permissions (readable by adm group - AMA needs this)</span>
<span class="fn">sudo</span> chmod 644 /var/log/sap-audit.log
<span class="fn">sudo</span> chmod 644 /var/log/cef-security.log

<span class="cmt"># Validate rsyslog configuration</span>
<span class="fn">sudo</span> rsyslogd -N1
<span class="cmt"># Should show: "rsyslogd: End of config validation run"</span>

<span class="cmt"># Restart rsyslog to apply changes</span>
<span class="fn">sudo</span> systemctl restart rsyslog

<span class="cmt"># Verify it's running</span>
<span class="fn">sudo</span> systemctl status rsyslog</pre>
                    </div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">6</div>
                <div class="step-content">
                    <h4>Verify Syslog Reception</h4>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Bash</span>
                            <span class="code-title">Test and Monitor</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre><span class="cmt"># Check that ports are listening</span>
<span class="fn">sudo</span> ss -tulnp | grep <span class="num">514</span>
<span class="cmt"># Expected output:</span>
<span class="cmt"># udp  UNCONN 0  0  0.0.0.0:514  0.0.0.0:*  users:(("rsyslogd",pid=XXXX,fd=3))</span>
<span class="cmt"># tcp  LISTEN 0  25 0.0.0.0:514  0.0.0.0:*  users:(("rsyslogd",pid=XXXX,fd=4))</span>

<span class="cmt"># Send a test message from the local machine</span>
<span class="fn">logger</span> -p local0.info <span class="str">"TEST: This is a test syslog message"</span>

<span class="cmt"># Check if it appeared</span>
<span class="fn">sudo</span> tail /var/log/sap-local0.log

<span class="cmt"># Send a test CEF message</span>
<span class="fn">logger</span> <span class="str">"CEF:0|Test|TestProduct|1.0|100|Test Event|5|src=10.0.0.1"</span>

<span class="cmt"># Check if it appeared in the CEF log</span>
<span class="fn">sudo</span> tail /var/log/cef-security.log

<span class="cmt"># Monitor the SAP log file in real-time</span>
<span class="cmt"># (Keep this running while testing from SAP)</span>
<span class="fn">sudo</span> tail -f /var/log/sap-audit.log</pre>
                    </div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">7</div>
                <div class="step-content">
                    <h4>Configure Log Rotation</h4>
                    <p>Prevent log files from filling up the disk:</p>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Bash</span>
                            <span class="code-title">Create Logrotate Configuration</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre><span class="cmt"># Create logrotate config for SAP audit logs</span>
<span class="fn">sudo</span> nano /etc/logrotate.d/sap-audit</pre>
                    </div>

                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Config</span>
                            <span class="code-title">/etc/logrotate.d/sap-audit</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre>/var/log/sap-audit.log
/var/log/cef-security.log
{
    daily                   <span class="cmt"># Rotate daily</span>
    rotate 14               <span class="cmt"># Keep 14 days of logs</span>
    compress               <span class="cmt"># Compress old logs</span>
    delaycompress          <span class="cmt"># Don't compress yesterday's log yet</span>
    missingok              <span class="cmt"># Don't error if file is missing</span>
    notifempty             <span class="cmt"># Don't rotate if empty</span>
    create 644 syslog adm  <span class="cmt"># Create new file with these permissions</span>
    postrotate
        <span class="cmt"># Tell rsyslog to reopen log files after rotation</span>
        /usr/lib/rsyslog/rsyslog-rotate
    endscript
}</pre>
                    </div>
                </div>
            </div>

            <div class="info-box tip">
                <div class="info-box-title">‚úÖ Step 2 Complete!</div>
                <p>Your syslog collector is now ready to receive logs from SAP and other sources. The logs are being written to:</p>
                <ul>
                    <li><code class="inline-code">/var/log/sap-audit.log</code> - SAP Security Audit Logs</li>
                    <li><code class="inline-code">/var/log/cef-security.log</code> - All CEF format logs</li>
                    <li><code class="inline-code">/var/log/remote/</code> - Other logs organized by hostname</li>
                </ul>
                <p>Next, we'll install the Azure Monitor Agent to send these logs to Azure.</p>
            </div>
        </div>

        <!-- ============================================== -->
        <!-- STEP 3: AMA INSTALLATION -->
        <!-- ============================================== -->
        <div class="module" id="step3-ama">
            <div class="module-header">
                <span class="module-number">STEP 3 OF 8</span>
                <h1>Azure Monitor Agent (AMA) Installation</h1>
                <p class="lead">Install the Azure Monitor Agent on your syslog collector to send logs to Azure. AMA is the bridge between your on-premises/cloud VMs and Azure Log Analytics.</p>
            </div>

            <span class="skill-level beginner">üå± Beginner Friendly</span>

            <div class="concept-box">
                <div class="concept-title">What is Azure Monitor Agent (AMA)?</div>
                <p>The Azure Monitor Agent is software that runs on your VMs and sends monitoring data to Azure. It's the successor to the older Log Analytics Agent (MMA/OMS).</p>
                
                <div class="simple-explanation">
                    Think of AMA as a "courier service" installed on your server. It picks up logs from specified locations (like /var/log/sap-audit.log) and delivers them to Azure on a regular schedule.
                </div>
                
                <div class="real-world">
                    Without AMA, your logs just sit on the syslog server. AMA reads them and sends them securely (HTTPS) to Azure where Sentinel can analyze them.
                </div>
            </div>

            <h2>Prerequisites Checklist</h2>
            <ul class="checklist" style="list-style: none; margin-left: 0;">
                <li>‚òê Syslog collector VM is running (from Step 2)</li>
                <li>‚òê VM has outbound internet access (HTTPS/443)</li>
                <li>‚òê You have an Azure subscription</li>
                <li>‚òê Log Analytics workspace exists (or we'll create one)</li>
                <li>‚òê You have Contributor permissions on the VM</li>
            </ul>

            <h2>Create Log Analytics Workspace</h2>

            <div class="step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h4>Create Workspace (if you don't have one)</h4>
                    
                    <div class="nav-path">
                        <span>Azure Portal</span>
                        <span class="separator">‚Üí</span>
                        <span>Log Analytics workspaces</span>
                        <span class="separator">‚Üí</span>
                        <span>+ Create</span>
                    </div>

                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Azure CLI</span>
                            <span class="code-title">Create Log Analytics Workspace</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre><span class="cmt"># Create workspace</span>
<span class="fn">az</span> monitor log-analytics workspace create \
    --resource-group <span class="str">"rg-syslog-collector"</span> \
    --workspace-name <span class="str">"law-sentinel-prod"</span> \
    --location <span class="str">"eastus"</span> \
    --retention-time <span class="num">90</span>  <span class="cmt"># 90 days retention</span>

<span class="cmt"># Get the workspace ID (you'll need this later)</span>
<span class="fn">az</span> monitor log-analytics workspace show \
    --resource-group <span class="str">"rg-syslog-collector"</span> \
    --workspace-name <span class="str">"law-sentinel-prod"</span> \
    --query <span class="str">"customerId"</span> -o tsv</pre>
                    </div>
                </div>
            </div>

            <h2>Create Data Collection Endpoint (DCE)</h2>

            <div class="concept-box">
                <div class="concept-title">What is a Data Collection Endpoint?</div>
                <p>A DCE is the "address" where AMA sends your custom logs. Think of it as a PO Box in Azure that receives your log deliveries.</p>
                
                <div class="simple-explanation">
                    Standard Azure logs go through built-in channels, but custom logs (like SAP) need a specific endpoint (DCE) to receive them.
                </div>
            </div>

            <div class="step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h4>Create DCE via Portal</h4>
                    
                    <div class="nav-path">
                        <span>Azure Portal</span>
                        <span class="separator">‚Üí</span>
                        <span>Monitor</span>
                        <span class="separator">‚Üí</span>
                        <span>Data Collection Endpoints</span>
                        <span class="separator">‚Üí</span>
                        <span>+ Create</span>
                    </div>

                    <p><strong>Fill in:</strong></p>
                    <ul>
                        <li><strong>Name:</strong> dce-syslog-collector</li>
                        <li><strong>Subscription:</strong> Your subscription</li>
                        <li><strong>Resource Group:</strong> rg-syslog-collector</li>
                        <li><strong>Region:</strong> Same as your VM (eastus)</li>
                    </ul>

                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Azure CLI</span>
                            <span class="code-title">Create DCE via CLI</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre><span class="cmt"># Create Data Collection Endpoint</span>
<span class="fn">az</span> monitor data-collection endpoint create \
    --name <span class="str">"dce-syslog-collector"</span> \
    --resource-group <span class="str">"rg-syslog-collector"</span> \
    --location <span class="str">"eastus"</span> \
    --public-network-access <span class="str">"Enabled"</span>

<span class="cmt"># Get the DCE resource ID (save this!)</span>
<span class="fn">az</span> monitor data-collection endpoint show \
    --name <span class="str">"dce-syslog-collector"</span> \
    --resource-group <span class="str">"rg-syslog-collector"</span> \
    --query <span class="str">"id"</span> -o tsv</pre>
                    </div>
                </div>
            </div>

            <h2>Install Azure Monitor Agent</h2>

            <div class="step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h4>Enable Managed Identity on VM</h4>
                    <p>AMA uses managed identity to authenticate with Azure (no passwords/keys needed!).</p>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Azure CLI</span>
                            <span class="code-title">Enable Managed Identity</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre><span class="cmt"># Enable system-assigned managed identity</span>
<span class="fn">az</span> vm identity assign \
    --resource-group <span class="str">"rg-syslog-collector"</span> \
    --name <span class="str">"vm-syslog-01"</span>

<span class="cmt"># Verify it's enabled</span>
<span class="fn">az</span> vm identity show \
    --resource-group <span class="str">"rg-syslog-collector"</span> \
    --name <span class="str">"vm-syslog-01"</span></pre>
                    </div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <h4>Install AMA Extension</h4>
                    
                    <div class="tabs">
                        <div class="tab-buttons">
                            <button class="tab-btn active" data-tab="ama-cli">Azure CLI</button>
                            <button class="tab-btn" data-tab="ama-portal">Portal</button>
                        </div>
                        
                        <div class="tab-content active" id="ama-cli">
                            <div class="code-block">
                                <div class="code-header">
                                    <span class="code-lang">Azure CLI</span>
                                    <span class="code-title">Install AMA on Linux VM</span>
                                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                                </div>
                                <pre><span class="cmt"># Install Azure Monitor Agent extension</span>
<span class="fn">az</span> vm extension set \
    --resource-group <span class="str">"rg-syslog-collector"</span> \
    --vm-name <span class="str">"vm-syslog-01"</span> \
    --name <span class="str">"AzureMonitorLinuxAgent"</span> \
    --publisher <span class="str">"Microsoft.Azure.Monitor"</span> \
    --enable-auto-upgrade <span class="str">"true"</span>

<span class="cmt"># Verify installation</span>
<span class="fn">az</span> vm extension list \
    --resource-group <span class="str">"rg-syslog-collector"</span> \
    --vm-name <span class="str">"vm-syslog-01"</span> \
    --query <span class="str">"[?name=='AzureMonitorLinuxAgent']"</span> -o table</pre>
                            </div>
                        </div>
                        
                        <div class="tab-content" id="ama-portal">
                            <div class="nav-path">
                                <span>Azure Portal</span>
                                <span class="separator">‚Üí</span>
                                <span>Virtual Machines</span>
                                <span class="separator">‚Üí</span>
                                <span>vm-syslog-01</span>
                                <span class="separator">‚Üí</span>
                                <span>Extensions + applications</span>
                                <span class="separator">‚Üí</span>
                                <span>+ Add</span>
                            </div>
                            <p>Select <strong>"Azure Monitor Linux Agent"</strong> and click Install.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">5</div>
                <div class="step-content">
                    <h4>Verify AMA on the VM</h4>
                    <p>SSH into the VM and check the agent status:</p>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Bash</span>
                            <span class="code-title">Check AMA Status</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre><span class="cmt"># SSH into the VM</span>
<span class="fn">ssh</span> azureadmin@<span class="str">&lt;vm-public-ip&gt;</span>

<span class="cmt"># Check if AMA service is running</span>
<span class="fn">sudo</span> systemctl status azuremonitoragent

<span class="cmt"># Expected output:</span>
<span class="cmt"># ‚óè azuremonitoragent.service - Azure Monitor Agent</span>
<span class="cmt">#      Loaded: loaded (...; enabled; vendor preset: enabled)</span>
<span class="cmt">#      Active: active (running) since ...</span>

<span class="cmt"># Check AMA version</span>
<span class="fn">sudo</span> /opt/microsoft/azuremonitoragent/bin/mdsd --version

<span class="cmt"># Check AMA logs for any errors</span>
<span class="fn">sudo</span> tail -50 /var/opt/microsoft/azuremonitoragent/log/mdsd.err
<span class="fn">sudo</span> tail -50 /var/opt/microsoft/azuremonitoragent/log/mdsd.info</pre>
                    </div>
                </div>
            </div>

            <div class="info-box tip">
                <div class="info-box-title">‚úÖ Step 3 Complete!</div>
                <p>AMA is now installed and running on your VM. However, it's not collecting anything yet - we need to tell it WHAT to collect. That's what the Data Collection Rule (DCR) does in the next step.</p>
            </div>
        </div>

        <!-- ============================================== -->
        <!-- STEP 4: DCR CONFIGURATION -->
        <!-- ============================================== -->
        <div class="module" id="step4-dcr">
            <div class="module-header">
                <span class="module-number">STEP 4 OF 8</span>
                <h1>Data Collection Rule (DCR) Configuration</h1>
                <p class="lead">The DCR is the heart of log collection. It tells AMA what logs to collect, how to parse them, and where to send them. This is where the magic happens!</p>
            </div>

            <span class="skill-level intermediate">üåø Intermediate</span>

            <div class="concept-box">
                <div class="concept-title">Understanding Data Collection Rules</div>
                <p>A DCR has four main components:</p>
                <ol>
                    <li><strong>Data Sources:</strong> WHERE to collect logs from (files, syslog facilities)</li>
                    <li><strong>Stream Declarations:</strong> The SCHEMA of incoming data</li>
                    <li><strong>Transformations:</strong> HOW to parse/modify the data (KQL)</li>
                    <li><strong>Destinations:</strong> WHERE to send the processed data</li>
                </ol>
                
                <div class="simple-explanation">
                    Think of DCR like a mail sorting machine: It picks up mail (data sources), reads the addresses (stream declarations), sorts and stamps them (transformations), and puts them in the right bins (destinations).
                </div>
            </div>

            <h2>Create Custom Table First</h2>
            <p>Before creating the DCR, we need a table in Log Analytics to receive our SAP logs.</p>

            <div class="step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h4>Create Custom Table</h4>
                    
                    <div class="nav-path">
                        <span>Azure Portal</span>
                        <span class="separator">‚Üí</span>
                        <span>Log Analytics workspaces</span>
                        <span class="separator">‚Üí</span>
                        <span>law-sentinel-prod</span>
                        <span class="separator">‚Üí</span>
                        <span>Tables</span>
                        <span class="separator">‚Üí</span>
                        <span>Create</span>
                        <span class="separator">‚Üí</span>
                        <span>New custom log (DCR-based)</span>
                    </div>

                    <p><strong>Table settings:</strong></p>
                    <ul>
                        <li><strong>Table name:</strong> SAPAuditLog (will become SAPAuditLog_CL)</li>
                        <li><strong>Data collection endpoint:</strong> dce-syslog-collector</li>
                    </ul>

                    <div class="info-box note">
                        <div class="info-box-title">üí° About the _CL Suffix</div>
                        <p>Azure automatically adds <code class="inline-code">_CL</code> (Custom Log) to your table name. So "SAPAuditLog" becomes "SAPAuditLog_CL".</p>
                    </div>
                </div>
            </div>

            <h2>Complete DCR JSON Configuration</h2>

            <div class="step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h4>Full Production DCR</h4>
                    <p>Here's the complete DCR configuration. I'll explain each section:</p>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">JSON</span>
                            <span class="code-title">dcr-sap-audit-complete.json</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre>{
    <span class="str">"$schema"</span>: <span class="str">"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#"</span>,
    <span class="str">"contentVersion"</span>: <span class="str">"1.0.0.0"</span>,
    <span class="str">"parameters"</span>: {
        <span class="str">"workspaceResourceId"</span>: {
            <span class="str">"type"</span>: <span class="str">"string"</span>,
            <span class="str">"metadata"</span>: { <span class="str">"description"</span>: <span class="str">"Full resource ID of Log Analytics workspace"</span> }
        },
        <span class="str">"dceResourceId"</span>: {
            <span class="str">"type"</span>: <span class="str">"string"</span>,
            <span class="str">"metadata"</span>: { <span class="str">"description"</span>: <span class="str">"Full resource ID of Data Collection Endpoint"</span> }
        }
    },
    <span class="str">"resources"</span>: [
        {
            <span class="str">"type"</span>: <span class="str">"Microsoft.Insights/dataCollectionRules"</span>,
            <span class="str">"apiVersion"</span>: <span class="str">"2022-06-01"</span>,
            <span class="str">"name"</span>: <span class="str">"dcr-sap-audit-logs"</span>,
            <span class="str">"location"</span>: <span class="str">"eastus"</span>,
            <span class="str">"properties"</span>: {
                <span class="str">"description"</span>: <span class="str">"Collect and parse SAP Security Audit Logs"</span>,
                <span class="str">"dataCollectionEndpointId"</span>: <span class="str">"[parameters('dceResourceId')]"</span>,
                
                <span class="cmt">// ========================================</span>
                <span class="cmt">// STREAM DECLARATIONS</span>
                <span class="cmt">// Define the schema of INCOMING raw data</span>
                <span class="cmt">// ========================================</span>
                <span class="str">"streamDeclarations"</span>: {
                    <span class="str">"Custom-SAPAuditRaw"</span>: {
                        <span class="str">"columns"</span>: [
                            {
                                <span class="str">"name"</span>: <span class="str">"TimeGenerated"</span>,
                                <span class="str">"type"</span>: <span class="str">"datetime"</span>
                            },
                            {
                                <span class="str">"name"</span>: <span class="str">"RawData"</span>,
                                <span class="str">"type"</span>: <span class="str">"string"</span>
                            },
                            {
                                <span class="str">"name"</span>: <span class="str">"Computer"</span>,
                                <span class="str">"type"</span>: <span class="str">"string"</span>
                            }
                        ]
                    }
                },
                
                <span class="cmt">// ========================================</span>
                <span class="cmt">// DATA SOURCES</span>
                <span class="cmt">// Tell AMA WHERE to collect logs from</span>
                <span class="cmt">// ========================================</span>
                <span class="str">"dataSources"</span>: {
                    <span class="cmt">// Option 1: Collect from log files</span>
                    <span class="str">"logFiles"</span>: [
                        {
                            <span class="str">"streams"</span>: [<span class="str">"Custom-SAPAuditRaw"</span>],
                            <span class="str">"filePatterns"</span>: [<span class="str">"/var/log/sap-audit.log"</span>],
                            <span class="str">"format"</span>: <span class="str">"text"</span>,
                            <span class="str">"settings"</span>: {
                                <span class="str">"text"</span>: {
                                    <span class="str">"recordStartTimestampFormat"</span>: <span class="str">"ISO 8601"</span>
                                }
                            },
                            <span class="str">"name"</span>: <span class="str">"SAPAuditLogFile"</span>
                        }
                    ],
                    <span class="cmt">// Option 2: Also collect from syslog facility</span>
                    <span class="str">"syslog"</span>: [
                        {
                            <span class="str">"streams"</span>: [<span class="str">"Microsoft-Syslog"</span>],
                            <span class="str">"facilityNames"</span>: [<span class="str">"local0"</span>],
                            <span class="str">"logLevels"</span>: [
                                <span class="str">"Debug"</span>, <span class="str">"Info"</span>, <span class="str">"Notice"</span>, 
                                <span class="str">"Warning"</span>, <span class="str">"Error"</span>, <span class="str">"Critical"</span>, 
                                <span class="str">"Alert"</span>, <span class="str">"Emergency"</span>
                            ],
                            <span class="str">"name"</span>: <span class="str">"SAPSyslogFacility"</span>
                        }
                    ]
                },
                
                <span class="cmt">// ========================================</span>
                <span class="cmt">// DESTINATIONS</span>
                <span class="cmt">// Tell AMA WHERE to send processed logs</span>
                <span class="cmt">// ========================================</span>
                <span class="str">"destinations"</span>: {
                    <span class="str">"logAnalytics"</span>: [
                        {
                            <span class="str">"workspaceResourceId"</span>: <span class="str">"[parameters('workspaceResourceId')]"</span>,
                            <span class="str">"name"</span>: <span class="str">"SentinelWorkspace"</span>
                        }
                    ]
                },
                
                <span class="cmt">// ========================================</span>
                <span class="cmt">// DATA FLOWS</span>
                <span class="cmt">// Connect sources to destinations with transforms</span>
                <span class="cmt">// ========================================</span>
                <span class="str">"dataFlows"</span>: [
                    {
                        <span class="str">"streams"</span>: [<span class="str">"Custom-SAPAuditRaw"</span>],
                        <span class="str">"destinations"</span>: [<span class="str">"SentinelWorkspace"</span>],
                        <span class="str">"transformKql"</span>: <span class="str">"source | extend TimeGenerated = now() | extend CEF = parse_cef(RawData) | extend SourceIP = tostring(CEF.SourceIP), User = tostring(CEF.SourceUserName), SystemID = tostring(CEF.DeviceCustomString1), Client = tostring(CEF.DeviceCustomString2), MessageClass = tostring(CEF.DeviceCustomString3), TransactionCode = tostring(CEF.DeviceCustomString5), Severity = toint(CEF.LogSeverity), EventType = tostring(CEF.DeviceEventClassID), EventDescription = tostring(CEF.Name) | project TimeGenerated, SourceIP, User, SystemID, Client, MessageClass, TransactionCode, EventType, EventDescription, Severity, RawMessage=RawData"</span>,
                        <span class="str">"outputStream"</span>: <span class="str">"Custom-SAPAuditLog_CL"</span>
                    },
                    {
                        <span class="str">"streams"</span>: [<span class="str">"Microsoft-Syslog"</span>],
                        <span class="str">"destinations"</span>: [<span class="str">"SentinelWorkspace"</span>]
                    }
                ]
            }
        }
    ]
}</pre>
                    </div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h4>Understanding the transformKql</h4>
                    <p>The <code class="inline-code">transformKql</code> is a KQL query that runs on each log line during ingestion. Let's break it down:</p>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">KQL</span>
                            <span class="code-title">DCR Transform Query Explained</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre><span class="cmt">// The transform starts with 'source' - this is the incoming raw data</span>
<span class="var">source</span>

<span class="cmt">// Add the ingestion timestamp</span>
<span class="op">|</span> <span class="kw">extend</span> <span class="prop">TimeGenerated</span> = <span class="fn">now</span>()

<span class="cmt">// Parse the CEF format into a structured object</span>
<span class="cmt">// parse_cef() is a built-in function that understands CEF format</span>
<span class="op">|</span> <span class="kw">extend</span> <span class="prop">CEF</span> = <span class="fn">parse_cef</span>(<span class="prop">RawData</span>)

<span class="cmt">// Extract individual fields from the parsed CEF object</span>
<span class="op">|</span> <span class="kw">extend</span> 
    <span class="prop">SourceIP</span> = <span class="fn">tostring</span>(<span class="prop">CEF</span>.<span class="prop">SourceIP</span>),
    <span class="prop">User</span> = <span class="fn">tostring</span>(<span class="prop">CEF</span>.<span class="prop">SourceUserName</span>),
    <span class="prop">SystemID</span> = <span class="fn">tostring</span>(<span class="prop">CEF</span>.<span class="prop">DeviceCustomString1</span>),      <span class="cmt">// SAP SID (PRD/QAS/DEV)</span>
    <span class="prop">Client</span> = <span class="fn">tostring</span>(<span class="prop">CEF</span>.<span class="prop">DeviceCustomString2</span>),        <span class="cmt">// SAP Client (100, 200)</span>
    <span class="prop">MessageClass</span> = <span class="fn">tostring</span>(<span class="prop">CEF</span>.<span class="prop">DeviceCustomString3</span>),  <span class="cmt">// AU1, AU3, AUW</span>
    <span class="prop">TransactionCode</span> = <span class="fn">tostring</span>(<span class="prop">CEF</span>.<span class="prop">DeviceCustomString5</span>), <span class="cmt">// SE16, SU01, etc.</span>
    <span class="prop">Severity</span> = <span class="fn">toint</span>(<span class="prop">CEF</span>.<span class="prop">LogSeverity</span>),                 <span class="cmt">// 1-10</span>
    <span class="prop">EventType</span> = <span class="fn">tostring</span>(<span class="prop">CEF</span>.<span class="prop">DeviceEventClassID</span>),       <span class="cmt">// AUB, AUF, AUL</span>
    <span class="prop">EventDescription</span> = <span class="fn">tostring</span>(<span class="prop">CEF</span>.<span class="prop">Name</span>)               <span class="cmt">// Human-readable</span>

<span class="cmt">// Select only the columns we want in the final table</span>
<span class="op">|</span> <span class="kw">project</span>
    <span class="prop">TimeGenerated</span>,
    <span class="prop">SourceIP</span>,
    <span class="prop">User</span>,
    <span class="prop">SystemID</span>,
    <span class="prop">Client</span>,
    <span class="prop">MessageClass</span>,
    <span class="prop">TransactionCode</span>,
    <span class="prop">EventType</span>,
    <span class="prop">EventDescription</span>,
    <span class="prop">Severity</span>,
    <span class="prop">RawMessage</span> = <span class="prop">RawData</span>  <span class="cmt">// Keep original for troubleshooting</span></pre>
                    </div>

                    <div class="info-box warning">
                        <div class="info-box-title">‚ö†Ô∏è DCR Transform Limitations</div>
                        <ul>
                            <li>Max query size: 10 KB</li>
                            <li>Must start with <code class="inline-code">source</code></li>
                            <li>No external data lookups (join, externaldata)</li>
                            <li>No user-defined functions</li>
                            <li>No multi-table operations</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <h4>Deploy the DCR</h4>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Azure CLI</span>
                            <span class="code-title">Deploy DCR from JSON</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre><span class="cmt"># Get the resource IDs needed</span>
<span class="var">WORKSPACE_ID</span>=$(<span class="fn">az</span> monitor log-analytics workspace show \
    --resource-group <span class="str">"rg-syslog-collector"</span> \
    --workspace-name <span class="str">"law-sentinel-prod"</span> \
    --query <span class="str">"id"</span> -o tsv)

<span class="var">DCE_ID</span>=$(<span class="fn">az</span> monitor data-collection endpoint show \
    --name <span class="str">"dce-syslog-collector"</span> \
    --resource-group <span class="str">"rg-syslog-collector"</span> \
    --query <span class="str">"id"</span> -o tsv)

<span class="cmt"># Deploy the DCR template</span>
<span class="fn">az</span> deployment group create \
    --resource-group <span class="str">"rg-syslog-collector"</span> \
    --template-file <span class="str">"dcr-sap-audit-complete.json"</span> \
    --parameters \
        workspaceResourceId=<span class="str">"$WORKSPACE_ID"</span> \
        dceResourceId=<span class="str">"$DCE_ID"</span></pre>
                    </div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">5</div>
                <div class="step-content">
                    <h4>Associate DCR with VM</h4>
                    <p>The final step - connect the DCR to your syslog collector VM:</p>
                    
                    <div class="nav-path">
                        <span>Azure Portal</span>
                        <span class="separator">‚Üí</span>
                        <span>Monitor</span>
                        <span class="separator">‚Üí</span>
                        <span>Data Collection Rules</span>
                        <span class="separator">‚Üí</span>
                        <span>dcr-sap-audit-logs</span>
                        <span class="separator">‚Üí</span>
                        <span>Resources</span>
                        <span class="separator">‚Üí</span>
                        <span>+ Add</span>
                    </div>

                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Azure CLI</span>
                            <span class="code-title">Associate DCR with VM</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre><span class="cmt"># Get VM resource ID</span>
<span class="var">VM_ID</span>=$(<span class="fn">az</span> vm show \
    --resource-group <span class="str">"rg-syslog-collector"</span> \
    --name <span class="str">"vm-syslog-01"</span> \
    --query <span class="str">"id"</span> -o tsv)

<span class="cmt"># Get DCR resource ID</span>
<span class="var">DCR_ID</span>=$(<span class="fn">az</span> monitor data-collection rule show \
    --name <span class="str">"dcr-sap-audit-logs"</span> \
    --resource-group <span class="str">"rg-syslog-collector"</span> \
    --query <span class="str">"id"</span> -o tsv)

<span class="cmt"># Create association</span>
<span class="fn">az</span> monitor data-collection rule association create \
    --name <span class="str">"dcr-association-syslog"</span> \
    --resource <span class="str">"$VM_ID"</span> \
    --rule-id <span class="str">"$DCR_ID"</span></pre>
                    </div>
                </div>
            </div>

            <div class="info-box tip">
                <div class="info-box-title">‚úÖ Step 4 Complete!</div>
                <p>Your DCR is now configured and associated with the VM. Within minutes, logs should start flowing from <code class="inline-code">/var/log/sap-audit.log</code> to your <code class="inline-code">SAPAuditLog_CL</code> table in Log Analytics.</p>
            </div>
        </div>

        <!-- ============================================== -->
        <!-- STEP 5: LOG ANALYTICS TABLES -->
        <!-- ============================================== -->
        <div class="module" id="step5-table">
            <div class="module-header">
                <span class="module-number">STEP 5 OF 8</span>
                <h1>Log Analytics Tables & Data Storage</h1>
                <p class="lead">Understand how your data is stored, how to query it, and how to manage retention.</p>
            </div>

            <span class="skill-level beginner">üå± Beginner Friendly</span>

            <h2>Verify Data is Flowing</h2>

            <div class="step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h4>Query Your Custom Table</h4>
                    
                    <div class="nav-path">
                        <span>Azure Portal</span>
                        <span class="separator">‚Üí</span>
                        <span>Log Analytics workspaces</span>
                        <span class="separator">‚Üí</span>
                        <span>law-sentinel-prod</span>
                        <span class="separator">‚Üí</span>
                        <span>Logs</span>
                    </div>

                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">KQL</span>
                            <span class="code-title">Verify SAP Logs are Arriving</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre><span class="cmt">// Check if data exists in your custom table</span>
<span class="var">SAPAuditLog_CL</span>
<span class="op">|</span> <span class="kw">take</span> <span class="num">10</span>

<span class="cmt">// Check ingestion over time</span>
<span class="var">SAPAuditLog_CL</span>
<span class="op">|</span> <span class="kw">summarize</span> <span class="fn">count</span>() <span class="kw">by</span> <span class="fn">bin</span>(<span class="prop">TimeGenerated</span>, <span class="num">1h</span>)
<span class="op">|</span> <span class="kw">render</span> timechart

<span class="cmt">// See the table schema</span>
<span class="var">SAPAuditLog_CL</span>
<span class="op">|</span> <span class="kw">getschema</span></pre>
                    </div>
                </div>
            </div>

            <h2>Understanding Table Structure</h2>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Column</th>
                            <th>Type</th>
                            <th>Description</th>
                            <th>Example</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code class="inline-code">TimeGenerated</code></td>
                            <td>datetime</td>
                            <td>When the log was ingested (required)</td>
                            <td>2024-12-17T09:23:45Z</td>
                        </tr>
                        <tr>
                            <td><code class="inline-code">SourceIP</code></td>
                            <td>string</td>
                            <td>Client IP address</td>
                            <td>10.0.1.100</td>
                        </tr>
                        <tr>
                            <td><code class="inline-code">User</code></td>
                            <td>string</td>
                            <td>SAP username</td>
                            <td>JSMITH</td>
                        </tr>
                        <tr>
                            <td><code class="inline-code">SystemID</code></td>
                            <td>string</td>
                            <td>SAP System ID</td>
                            <td>PRD, QAS, DEV</td>
                        </tr>
                        <tr>
                            <td><code class="inline-code">Client</code></td>
                            <td>string</td>
                            <td>SAP Client number</td>
                            <td>100, 200</td>
                        </tr>
                        <tr>
                            <td><code class="inline-code">MessageClass</code></td>
                            <td>string</td>
                            <td>Event category</td>
                            <td>AU1, AU3, AUW</td>
                        </tr>
                        <tr>
                            <td><code class="inline-code">TransactionCode</code></td>
                            <td>string</td>
                            <td>T-code executed</td>
                            <td>SE16, SU01</td>
                        </tr>
                        <tr>
                            <td><code class="inline-code">EventType</code></td>
                            <td>string</td>
                            <td>Specific event ID</td>
                            <td>AUB, AUF, AUL</td>
                        </tr>
                        <tr>
                            <td><code class="inline-code">Severity</code></td>
                            <td>int</td>
                            <td>CEF severity (0-10)</td>
                            <td>3, 7</td>
                        </tr>
                        <tr>
                            <td><code class="inline-code">RawMessage</code></td>
                            <td>string</td>
                            <td>Original log line</td>
                            <td>Full CEF string</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h2>Data Retention</h2>

            <div class="grid-2">
                <div class="card">
                    <h4>Interactive Retention</h4>
                    <ul>
                        <li><strong>Default:</strong> 30 days</li>
                        <li><strong>Maximum:</strong> 730 days (2 years)</li>
                        <li><strong>Queryable:</strong> Immediately with KQL</li>
                        <li><strong>Cost:</strong> Higher per GB</li>
                    </ul>
                </div>
                <div class="card">
                    <h4>Archive Tier</h4>
                    <ul>
                        <li><strong>Total retention:</strong> Up to 7 years</li>
                        <li><strong>Access:</strong> Search jobs (async)</li>
                        <li><strong>Use case:</strong> Compliance, forensics</li>
                        <li><strong>Cost:</strong> Lower per GB</li>
                    </ul>
                </div>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Azure CLI</span>
                    <span class="code-title">Set Table Retention</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre><span class="cmt"># Set 90 days interactive, 365 days total (with archive)</span>
<span class="fn">az</span> monitor log-analytics workspace table update \
    --resource-group <span class="str">"rg-syslog-collector"</span> \
    --workspace-name <span class="str">"law-sentinel-prod"</span> \
    --name <span class="str">"SAPAuditLog_CL"</span> \
    --retention-time <span class="num">90</span> \
    --total-retention-time <span class="num">365</span></pre>
            </div>
        </div>

        <!-- ============================================== -->
        <!-- STEP 6: PARSER FUNCTIONS -->
        <!-- ============================================== -->
        <div class="module" id="step6-parser">
            <div class="module-header">
                <span class="module-number">STEP 6 OF 8</span>
                <h1>Parser Functions</h1>
                <p class="lead">Create reusable KQL functions that normalize data and add enrichment. Parsers make your detection rules cleaner and more maintainable.</p>
            </div>

            <span class="skill-level intermediate">üåø Intermediate</span>

            <div class="concept-box">
                <div class="concept-title">Why Use Parser Functions?</div>
                <ul>
                    <li><strong>Normalization:</strong> Consistent field names across log sources</li>
                    <li><strong>Enrichment:</strong> Add categorization, MITRE mapping, risk scores</li>
                    <li><strong>Simplification:</strong> Hide complex parsing from analysts</li>
                    <li><strong>Reusability:</strong> Use same parser in rules, hunting, workbooks</li>
                </ul>
                
                <div class="simple-explanation">
                    Instead of writing complex parsing logic in every detection rule, you write it once in a parser function and call <code class="inline-code">SAPSecurityEvents</code> everywhere.
                </div>
            </div>

            <h2>Create the Parser</h2>

            <div class="nav-path">
                <span>Microsoft Sentinel</span>
                <span class="separator">‚Üí</span>
                <span>Logs</span>
                <span class="separator">‚Üí</span>
                <span>(paste query)</span>
                <span class="separator">‚Üí</span>
                <span>Save</span>
                <span class="separator">‚Üí</span>
                <span>Save as function</span>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL</span>
                    <span class="code-title">SAPSecurityEvents Parser Function</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre><span class="cmt">// =============================================</span>
<span class="cmt">// PARSER: SAPSecurityEvents</span>
<span class="cmt">// Normalizes and enriches SAP audit logs</span>
<span class="cmt">// Save as function: SAPSecurityEvents</span>
<span class="cmt">// Category: Custom Parsers</span>
<span class="cmt">// =============================================</span>

<span class="var">SAPAuditLog_CL</span>
<span class="cmt">// Normalize field names for consistency</span>
<span class="op">|</span> <span class="kw">extend</span>
    <span class="prop">EventTime</span> = <span class="prop">TimeGenerated</span>,
    <span class="prop">SrcIpAddr</span> = <span class="prop">SourceIP</span>,
    <span class="prop">ActorUsername</span> = <span class="prop">User</span>,
    <span class="prop">TargetSystem</span> = <span class="prop">SystemID</span>,
    <span class="prop">SAPClient</span> = <span class="prop">Client</span>

<span class="cmt">// Add event categorization</span>
<span class="op">|</span> <span class="kw">extend</span> <span class="prop">EventCategory</span> = <span class="fn">case</span>(
    <span class="prop">MessageClass</span> == <span class="str">"AU1"</span>, <span class="str">"Authentication"</span>,
    <span class="prop">MessageClass</span> == <span class="str">"AU2"</span>, <span class="str">"RFC_Authentication"</span>,
    <span class="prop">MessageClass</span> == <span class="str">"AU3"</span>, <span class="str">"Transaction_Execution"</span>,
    <span class="prop">MessageClass</span> == <span class="str">"AU4"</span>, <span class="str">"Report_Execution"</span>,
    <span class="prop">MessageClass</span> == <span class="str">"AU5"</span>, <span class="str">"RFC_Function_Call"</span>,
    <span class="prop">MessageClass</span> == <span class="str">"AUW"</span>, <span class="str">"User_Administration"</span>,
    <span class="str">"Other"</span>)

<span class="cmt">// Add event result</span>
<span class="op">|</span> <span class="kw">extend</span> <span class="prop">EventResult</span> = <span class="fn">case</span>(
    <span class="prop">EventType</span> <span class="kw">in</span> (<span class="str">"AUB"</span>, <span class="str">"AUD"</span>, <span class="str">"AUK"</span>, <span class="str">"AUL"</span>, <span class="str">"AUM"</span>), <span class="str">"Success"</span>,
    <span class="prop">EventType</span> <span class="kw">in</span> (<span class="str">"AUF"</span>, <span class="str">"AUN"</span>), <span class="str">"Failure"</span>,
    <span class="str">"Unknown"</span>)

<span class="cmt">// Flag critical transactions</span>
<span class="op">|</span> <span class="kw">extend</span> <span class="prop">IsCriticalTransaction</span> = <span class="prop">TransactionCode</span> <span class="kw">in</span> (
    <span class="str">"SE16"</span>, <span class="str">"SE16N"</span>,  <span class="cmt">// Data browser</span>
    <span class="str">"SU01"</span>, <span class="str">"SU10"</span>,  <span class="cmt">// User maintenance</span>
    <span class="str">"PFCG"</span>,           <span class="cmt">// Role maintenance</span>
    <span class="str">"SM59"</span>,           <span class="cmt">// RFC destinations</span>
    <span class="str">"SE38"</span>, <span class="str">"SE80"</span>,  <span class="cmt">// ABAP development</span>
    <span class="str">"SM49"</span>, <span class="str">"SM69"</span>,  <span class="cmt">// External commands</span>
    <span class="str">"STMS"</span>,           <span class="cmt">// Transport management</span>
    <span class="str">"RZ10"</span>,           <span class="cmt">// Profile parameters</span>
    <span class="str">"SCC4"</span>)           <span class="cmt">// Client admin</span>

<span class="cmt">// Add severity level</span>
<span class="op">|</span> <span class="kw">extend</span> <span class="prop">SeverityLevel</span> = <span class="fn">case</span>(
    <span class="prop">Severity</span> >= <span class="num">9</span>, <span class="str">"Critical"</span>,
    <span class="prop">Severity</span> >= <span class="num">7</span>, <span class="str">"High"</span>,
    <span class="prop">Severity</span> >= <span class="num">4</span>, <span class="str">"Medium"</span>,
    <span class="str">"Low"</span>)

<span class="cmt">// Add MITRE ATT&CK mapping</span>
<span class="op">|</span> <span class="kw">extend</span> <span class="prop">MitreTactic</span> = <span class="fn">case</span>(
    <span class="prop">EventCategory</span> == <span class="str">"Authentication"</span> <span class="kw">and</span> <span class="prop">EventResult</span> == <span class="str">"Failure"</span>, <span class="str">"Credential Access"</span>,
    <span class="prop">EventCategory</span> == <span class="str">"User_Administration"</span>, <span class="str">"Persistence"</span>,
    <span class="prop">IsCriticalTransaction</span> == <span class="kw">true</span> <span class="kw">and</span> <span class="prop">TransactionCode</span> <span class="kw">has_any</span> (<span class="str">"SE16"</span>, <span class="str">"SE16N"</span>), <span class="str">"Collection"</span>,
    <span class="prop">IsCriticalTransaction</span> == <span class="kw">true</span> <span class="kw">and</span> <span class="prop">TransactionCode</span> <span class="kw">has_any</span> (<span class="str">"SM59"</span>), <span class="str">"Lateral Movement"</span>,
    <span class="str">""</span>)

<span class="op">|</span> <span class="kw">extend</span> <span class="prop">MitreTechnique</span> = <span class="fn">case</span>(
    <span class="prop">EventCategory</span> == <span class="str">"Authentication"</span> <span class="kw">and</span> <span class="prop">EventResult</span> == <span class="str">"Failure"</span>, <span class="str">"T1110 - Brute Force"</span>,
    <span class="prop">EventCategory</span> == <span class="str">"User_Administration"</span>, <span class="str">"T1136 - Create Account"</span>,
    <span class="prop">TransactionCode</span> <span class="kw">in</span> (<span class="str">"SE16"</span>, <span class="str">"SE16N"</span>), <span class="str">"T1005 - Data from Local System"</span>,
    <span class="str">""</span>)

<span class="cmt">// Final projection</span>
<span class="op">|</span> <span class="kw">project</span>
    <span class="prop">EventTime</span>,
    <span class="prop">SrcIpAddr</span>,
    <span class="prop">ActorUsername</span>,
    <span class="prop">TargetSystem</span>,
    <span class="prop">SAPClient</span>,
    <span class="prop">EventCategory</span>,
    <span class="prop">EventResult</span>,
    <span class="prop">TransactionCode</span>,
    <span class="prop">IsCriticalTransaction</span>,
    <span class="prop">SeverityLevel</span>,
    <span class="prop">MitreTactic</span>,
    <span class="prop">MitreTechnique</span>,
    <span class="prop">EventDescription</span>,
    <span class="prop">MessageClass</span>,
    <span class="prop">EventType</span>,
    <span class="prop">RawMessage</span></pre>
            </div>

            <h3>Using the Parser</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL</span>
                    <span class="code-title">Query Using Parser</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre><span class="cmt">// Now you can simply call the function!</span>
<span class="fn">SAPSecurityEvents</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">EventCategory</span> == <span class="str">"Authentication"</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">EventResult</span> == <span class="str">"Failure"</span>
<span class="op">|</span> <span class="kw">summarize</span> <span class="prop">FailCount</span> = <span class="fn">count</span>() <span class="kw">by</span> <span class="prop">ActorUsername</span>, <span class="prop">SrcIpAddr</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">FailCount</span> > <span class="num">5</span></pre>
            </div>
        </div>

        <!-- ============================================== -->
        <!-- STEP 7: DETECTION RULES -->
        <!-- ============================================== -->
        <div class="module" id="step7-detection">
            <div class="module-header">
                <span class="module-number">STEP 7 OF 8</span>
                <h1>Detection Rules</h1>
                <p class="lead">Create analytics rules to automatically detect threats in your SAP logs. These rules run continuously and create incidents when suspicious activity is found.</p>
            </div>

            <span class="skill-level intermediate">üåø Intermediate</span>

            <h2>Create Detection Rule</h2>

            <div class="nav-path">
                <span>Microsoft Sentinel</span>
                <span class="separator">‚Üí</span>
                <span>Analytics</span>
                <span class="separator">‚Üí</span>
                <span>+ Create</span>
                <span class="separator">‚Üí</span>
                <span>Scheduled query rule</span>
            </div>

            <h3>Detection 1: Brute Force Attack</h3>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL</span>
                    <span class="code-title">SAP Brute Force Detection</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre><span class="cmt">// RULE: SAP - Brute Force Authentication Attack</span>
<span class="cmt">// Detects multiple failed logins followed by success</span>
<span class="cmt">// Severity: High | MITRE: T1110</span>

<span class="kw">let</span> <span class="var">FailureThreshold</span> = <span class="num">5</span>;
<span class="kw">let</span> <span class="var">TimeWindow</span> = <span class="num">15m</span>;

<span class="cmt">// Get failed logins</span>
<span class="kw">let</span> <span class="var">FailedLogins</span> = 
    <span class="fn">SAPSecurityEvents</span>
    <span class="op">|</span> <span class="kw">where</span> <span class="prop">EventCategory</span> == <span class="str">"Authentication"</span>
    <span class="op">|</span> <span class="kw">where</span> <span class="prop">EventResult</span> == <span class="str">"Failure"</span>
    <span class="op">|</span> <span class="kw">summarize</span> 
        <span class="prop">FailureCount</span> = <span class="fn">count</span>(),
        <span class="prop">FirstFailure</span> = <span class="fn">min</span>(<span class="prop">EventTime</span>),
        <span class="prop">LastFailure</span> = <span class="fn">max</span>(<span class="prop">EventTime</span>)
        <span class="kw">by</span> <span class="prop">ActorUsername</span>, <span class="prop">SrcIpAddr</span>, <span class="prop">TargetSystem</span>;

<span class="cmt">// Get successful logins</span>
<span class="kw">let</span> <span class="var">SuccessLogins</span> = 
    <span class="fn">SAPSecurityEvents</span>
    <span class="op">|</span> <span class="kw">where</span> <span class="prop">EventCategory</span> == <span class="str">"Authentication"</span>
    <span class="op">|</span> <span class="kw">where</span> <span class="prop">EventResult</span> == <span class="str">"Success"</span>
    <span class="op">|</span> <span class="kw">project</span> <span class="prop">ActorUsername</span>, <span class="prop">SrcIpAddr</span>, <span class="prop">TargetSystem</span>, <span class="prop">SuccessTime</span> = <span class="prop">EventTime</span>;

<span class="cmt">// Correlate: failures followed by success</span>
<span class="var">FailedLogins</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">FailureCount</span> >= <span class="var">FailureThreshold</span>
<span class="op">|</span> <span class="kw">join</span> <span class="kw">kind</span>=inner <span class="var">SuccessLogins</span> <span class="kw">on</span> <span class="prop">ActorUsername</span>, <span class="prop">SrcIpAddr</span>, <span class="prop">TargetSystem</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">SuccessTime</span> > <span class="prop">LastFailure</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">SuccessTime</span> - <span class="prop">LastFailure</span> < <span class="var">TimeWindow</span>
<span class="op">|</span> <span class="kw">project</span>
    <span class="prop">TimeGenerated</span> = <span class="prop">SuccessTime</span>,
    <span class="prop">ActorUsername</span>,
    <span class="prop">SrcIpAddr</span>,
    <span class="prop">TargetSystem</span>,
    <span class="prop">FailureCount</span>,
    <span class="prop">AttackDuration</span> = <span class="prop">SuccessTime</span> - <span class="prop">FirstFailure</span></pre>
            </div>

            <h4>Rule Settings</h4>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Setting</th><th>Value</th></tr></thead>
                    <tbody>
                        <tr><td>Name</td><td>SAP - Brute Force Authentication Attack</td></tr>
                        <tr><td>Severity</td><td>High</td></tr>
                        <tr><td>MITRE Tactics</td><td>Credential Access</td></tr>
                        <tr><td>MITRE Techniques</td><td>T1110 - Brute Force</td></tr>
                        <tr><td>Run frequency</td><td>5 minutes</td></tr>
                        <tr><td>Lookup period</td><td>1 hour</td></tr>
                    </tbody>
                </table>
            </div>

            <h3>Detection 2: Critical Transaction on Production</h3>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL</span>
                    <span class="code-title">SAP Critical Transaction Detection</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre><span class="cmt">// RULE: SAP - Critical Transaction on Production System</span>
<span class="cmt">// Severity: Medium-High | MITRE: T1059</span>

<span class="fn">SAPSecurityEvents</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">IsCriticalTransaction</span> == <span class="kw">true</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">TargetSystem</span> == <span class="str">"PRD"</span>  <span class="cmt">// Production only</span>
<span class="op">|</span> <span class="kw">extend</span> <span class="prop">Hour</span> = <span class="fn">datetime_part</span>(<span class="str">"hour"</span>, <span class="prop">EventTime</span>)
<span class="op">|</span> <span class="kw">extend</span> <span class="prop">IsAfterHours</span> = <span class="prop">Hour</span> < <span class="num">7</span> <span class="kw">or</span> <span class="prop">Hour</span> > <span class="num">19</span>
<span class="op">|</span> <span class="kw">project</span>
    <span class="prop">TimeGenerated</span> = <span class="prop">EventTime</span>,
    <span class="prop">ActorUsername</span>,
    <span class="prop">SrcIpAddr</span>,
    <span class="prop">TransactionCode</span>,
    <span class="prop">TargetSystem</span>,
    <span class="prop">IsAfterHours</span>,
    <span class="prop">MitreTactic</span>,
    <span class="prop">MitreTechnique</span></pre>
            </div>

            <h3>Detection 3: User Created in Production</h3>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL</span>
                    <span class="code-title">SAP User Creation Detection</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre><span class="cmt">// RULE: SAP - User Created in Production</span>
<span class="cmt">// Severity: High | MITRE: T1136</span>

<span class="kw">let</span> <span class="var">AuthorizedAdmins</span> = <span class="kw">dynamic</span>([<span class="str">"BASIS_ADMIN"</span>, <span class="str">"SECURITY_ADMIN"</span>]);

<span class="fn">SAPSecurityEvents</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">EventCategory</span> == <span class="str">"User_Administration"</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">EventType</span> == <span class="str">"AUY"</span>  <span class="cmt">// User created</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">TargetSystem</span> == <span class="str">"PRD"</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">ActorUsername</span> !<span class="kw">in</span> (<span class="var">AuthorizedAdmins</span>)
<span class="op">|</span> <span class="kw">project</span>
    <span class="prop">TimeGenerated</span> = <span class="prop">EventTime</span>,
    <span class="prop">CreatedBy</span> = <span class="prop">ActorUsername</span>,
    <span class="prop">TargetSystem</span>,
    <span class="prop">SAPClient</span>,
    <span class="prop">SrcIpAddr</span>,
    <span class="prop">EventDescription</span></pre>
            </div>
        </div>

        <!-- ============================================== -->
        <!-- STEP 8: HUNTING QUERIES -->
        <!-- ============================================== -->
        <div class="module" id="step8-hunting">
            <div class="module-header">
                <span class="module-number">STEP 8 OF 8</span>
                <h1>Hunting Queries</h1>
                <p class="lead">Proactive threat hunting queries for investigating suspicious activity that might not trigger automated alerts.</p>
            </div>

            <span class="skill-level advanced">üå≥ Advanced</span>

            <h2>Create Hunting Query</h2>

            <div class="nav-path">
                <span>Microsoft Sentinel</span>
                <span class="separator">‚Üí</span>
                <span>Hunting</span>
                <span class="separator">‚Üí</span>
                <span>+ New query</span>
            </div>

            <h3>Hunt 1: Excessive Privilege Usage</h3>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL</span>
                    <span class="code-title">SAP Privilege Abuse Hunt</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre><span class="cmt">// HUNT: Users with broad critical transaction access</span>
<span class="cmt">// Hypothesis: Compromised accounts show broader activity</span>

<span class="fn">SAPSecurityEvents</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">EventTime</span> > <span class="fn">ago</span>(<span class="num">30d</span>)
<span class="op">|</span> <span class="kw">where</span> <span class="prop">IsCriticalTransaction</span> == <span class="kw">true</span>
<span class="op">|</span> <span class="kw">summarize</span>
    <span class="prop">UniqueCriticalTCodes</span> = <span class="fn">dcount</span>(<span class="prop">TransactionCode</span>),
    <span class="prop">TCodesUsed</span> = <span class="fn">make_set</span>(<span class="prop">TransactionCode</span>),
    <span class="prop">TotalExecutions</span> = <span class="fn">count</span>(),
    <span class="prop">UniqueIPs</span> = <span class="fn">dcount</span>(<span class="prop">SrcIpAddr</span>)
    <span class="kw">by</span> <span class="prop">ActorUsername</span>, <span class="prop">TargetSystem</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">UniqueCriticalTCodes</span> >= <span class="num">5</span>
<span class="op">|</span> <span class="kw">extend</span> <span class="prop">RiskScore</span> = <span class="prop">UniqueCriticalTCodes</span> * <span class="num">10</span> + <span class="prop">TotalExecutions</span>
<span class="op">|</span> <span class="kw">order by</span> <span class="prop">RiskScore</span> <span class="kw">desc</span></pre>
            </div>

            <h3>Hunt 2: Login from New IP</h3>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL</span>
                    <span class="code-title">SAP New IP Login Hunt</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre><span class="cmt">// HUNT: Users logging in from previously unseen IPs</span>
<span class="cmt">// Hypothesis: Stolen credentials used from attacker infrastructure</span>

<span class="kw">let</span> <span class="var">BaselinePeriod</span> = <span class="num">30d</span>;
<span class="kw">let</span> <span class="var">DetectionPeriod</span> = <span class="num">1d</span>;

<span class="cmt">// Build baseline of known IPs per user</span>
<span class="kw">let</span> <span class="var">Baseline</span> = 
    <span class="fn">SAPSecurityEvents</span>
    <span class="op">|</span> <span class="kw">where</span> <span class="prop">EventTime</span> <span class="kw">between</span> (<span class="fn">ago</span>(<span class="var">BaselinePeriod</span>) .. <span class="fn">ago</span>(<span class="var">DetectionPeriod</span>))
    <span class="op">|</span> <span class="kw">where</span> <span class="prop">EventCategory</span> == <span class="str">"Authentication"</span>
    <span class="op">|</span> <span class="kw">where</span> <span class="prop">EventResult</span> == <span class="str">"Success"</span>
    <span class="op">|</span> <span class="kw">summarize</span> <span class="prop">KnownIPs</span> = <span class="fn">make_set</span>(<span class="prop">SrcIpAddr</span>) <span class="kw">by</span> <span class="prop">ActorUsername</span>;

<span class="cmt">// Find logins from new IPs</span>
<span class="fn">SAPSecurityEvents</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">EventTime</span> > <span class="fn">ago</span>(<span class="var">DetectionPeriod</span>)
<span class="op">|</span> <span class="kw">where</span> <span class="prop">EventCategory</span> == <span class="str">"Authentication"</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">EventResult</span> == <span class="str">"Success"</span>
<span class="op">|</span> <span class="kw">join</span> <span class="kw">kind</span>=leftouter <span class="var">Baseline</span> <span class="kw">on</span> <span class="prop">ActorUsername</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">SrcIpAddr</span> !<span class="kw">in</span> (<span class="prop">KnownIPs</span>)
<span class="op">|</span> <span class="kw">project</span>
    <span class="prop">EventTime</span>,
    <span class="prop">ActorUsername</span>,
    <span class="prop">NewIP</span> = <span class="prop">SrcIpAddr</span>,
    <span class="prop">TargetSystem</span></pre>
            </div>

            <div class="info-box tip">
                <div class="info-box-title">üéâ Workflow Complete!</div>
                <p>You've successfully set up the complete pipeline:</p>
                <ul>
                    <li>‚úÖ SAP configured to generate audit logs</li>
                    <li>‚úÖ Syslog server receiving and storing logs</li>
                    <li>‚úÖ AMA installed and connected to Azure</li>
                    <li>‚úÖ DCR parsing and transforming logs</li>
                    <li>‚úÖ Data stored in Log Analytics</li>
                    <li>‚úÖ Parser function for normalization</li>
                    <li>‚úÖ Detection rules for automated alerting</li>
                    <li>‚úÖ Hunting queries for proactive investigation</li>
                </ul>
            </div>
        </div>

        <!-- Footer -->
        <div style="text-align: center; padding: 50px 0; border-top: 1px solid var(--border-color); margin-top: 50px;">
            <p style="color: var(--text-muted);">Detection Engineering Mastery Guide | Zero to Hero</p>
            <p style="color: var(--text-muted); font-size: 0.9rem;">Built for Security Engineers, by Security Engineers</p>
        </div>
    </main>

    <script>
        // Sidebar toggle
        document.querySelectorAll('.sidebar-section-header').forEach(header => {
            header.addEventListener('click', () => {
                const section = header.parentElement;
                section.classList.toggle('active');
            });
        });

        // Mobile sidebar
        document.getElementById('sidebarToggle').addEventListener('click', () => {
            document.getElementById('sidebar').classList.toggle('open');
        });

        // Progress bar
        window.addEventListener('scroll', () => {
            const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
            const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = (winScroll / height) * 100;
            document.getElementById('progressFill').style.width = scrolled + '%';
        });

        // Copy code
        function copyCode(btn) {
            const pre = btn.closest('.code-block').querySelector('pre');
            navigator.clipboard.writeText(pre.textContent).then(() => {
                btn.textContent = 'Copied!';
                setTimeout(() => btn.textContent = 'Copy', 2000);
            });
        }

        // Tabs
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tabGroup = btn.closest('.tabs');
                tabGroup.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                tabGroup.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                const targetId = btn.getAttribute('data-tab');
                if (targetId) {
                    document.getElementById(targetId).classList.add('active');
                }

        <!-- ============================================== -->
        <!-- MODULE 01: DETECTION ENGINEERING FUNDAMENTALS -->
        <!-- ============================================== -->
        <div class="module" id="det-what">
            <div class="module-header">
                <span class="module-number">MODULE 01</span>
                <h1>Detection Engineering Fundamentals</h1>
                <p class="lead">Master the core concepts, methodologies, and frameworks that form the foundation of modern detection engineering.</p>
            </div>

            <span class="skill-level beginner">üå± Beginner Friendly</span>

            <div class="concept-box">
                <div class="concept-title">What is Detection Engineering?</div>
                <p>Detection Engineering is the discipline of designing, building, testing, and maintaining detection rules that identify malicious activity in your environment.</p>
                
                <div class="simple-explanation">
                    Think of it like building a home security system. You decide what sensors to install (motion detectors, door sensors), where to place them, what should trigger an alarm, and how to avoid false alarms when your cat walks by.
                </div>
                
                <div class="real-world">
                    When a ransomware attack hits a company, detection engineers are the ones who wrote the rules that (hopefully) alerted the SOC team. They're also the ones who tune the rules when too many false alarms distract analysts from real threats.
                </div>
            </div>

            <h2>Detection Engineer vs SOC Analyst</h2>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Aspect</th>
                            <th>SOC Analyst</th>
                            <th>Detection Engineer</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Primary Focus</strong></td>
                            <td>Investigate alerts, respond to incidents</td>
                            <td>Build and tune detection rules</td>
                        </tr>
                        <tr>
                            <td><strong>Daily Work</strong></td>
                            <td>Triage alerts, write reports, escalate issues</td>
                            <td>Write KQL/SPL, analyze false positives, improve coverage</td>
                        </tr>
                        <tr>
                            <td><strong>Key Skills</strong></td>
                            <td>Investigation, communication, documentation</td>
                            <td>Query languages, threat intelligence, testing</td>
                        </tr>
                        <tr>
                            <td><strong>Metrics</strong></td>
                            <td>MTTR (Mean Time to Respond), tickets closed</td>
                            <td>Detection coverage, false positive rate, MITRE coverage</td>
                        </tr>
                        <tr>
                            <td><strong>Interaction</strong></td>
                            <td>Reactive - responds to alerts</td>
                            <td>Proactive - builds detection before attacks</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h2 id="det-types">Types of Detections</h2>

            <div class="grid-2">
                <div class="card">
                    <h4>üéØ Signature-Based Detection</h4>
                    <p><strong>What:</strong> Looks for exact matches - specific file hashes, IP addresses, domain names, or patterns.</p>
                    <p><strong>Pros:</strong> Very precise, low false positives, fast</p>
                    <p><strong>Cons:</strong> Easily evaded by changing one character</p>
                    <div class="code-block" style="margin: 10px 0;">
                        <pre style="padding: 10px; font-size: 0.8rem;"><span class="cmt">// Example: Block known malicious hash</span>
DeviceFileEvents
| where SHA256 == <span class="str">"a1b2c3d4..."</span></pre>
                    </div>
                </div>
                <div class="card">
                    <h4>üîç Behavioral Detection</h4>
                    <p><strong>What:</strong> Looks for patterns of activity - "what does an attacker DO" rather than "what files do they use"</p>
                    <p><strong>Pros:</strong> Catches novel attacks, harder to evade</p>
                    <p><strong>Cons:</strong> More false positives, requires tuning</p>
                    <div class="code-block" style="margin: 10px 0;">
                        <pre style="padding: 10px; font-size: 0.8rem;"><span class="cmt">// Example: Detect credential dumping behavior</span>
DeviceProcessEvents
| where ProcessName == <span class="str">"lsass.exe"</span>
| where InitiatingProcessName != <span class="str">"expected.exe"</span></pre>
                    </div>
                </div>
                <div class="card">
                    <h4>üìä Anomaly Detection</h4>
                    <p><strong>What:</strong> Establishes baseline of "normal" and alerts on deviations</p>
                    <p><strong>Pros:</strong> Can find unknown threats, insider threats</p>
                    <p><strong>Cons:</strong> Needs training period, baseline drift</p>
                    <div class="code-block" style="margin: 10px 0;">
                        <pre style="padding: 10px; font-size: 0.8rem;"><span class="cmt">// Example: User logs in from unusual country</span>
SigninLogs
| where Location != UserBaseline.UsualLocation</pre>
                    </div>
                </div>
                <div class="card">
                    <h4>üîó Correlation Rules</h4>
                    <p><strong>What:</strong> Combines multiple events to detect complex attack chains</p>
                    <p><strong>Pros:</strong> Catches multi-stage attacks, reduces noise</p>
                    <p><strong>Cons:</strong> Complex to build, performance impact</p>
                    <div class="code-block" style="margin: 10px 0;">
                        <pre style="padding: 10px; font-size: 0.8rem;"><span class="cmt">// Example: Failed logins ‚Üí success ‚Üí data access</span>
FailedLogins | join SuccessLogins | join DataAccess
| where timespan &lt; 1h</pre>
                    </div>
                </div>
            </div>

            <h2 id="det-pyramid">The Pyramid of Pain</h2>

            <div class="concept-box">
                <div class="concept-title">Understanding the Pyramid of Pain</div>
                <p>Created by David Bianco, the Pyramid of Pain shows how different types of indicators affect attackers when you detect and block them.</p>
                
                <div class="simple-explanation">
                    The higher up the pyramid you detect, the more painful it is for attackers to change their tactics. Blocking an IP address (bottom) takes them seconds to change. Detecting their attack patterns (top) forces them to completely retool.
                </div>
            </div>

            <div class="diagram">
                <div style="text-align: center;">
                    <div style="display: inline-block; text-align: left;">
                        <div style="background: linear-gradient(135deg, #ff4757, #ff6b81); padding: 15px 30px; border-radius: 8px 8px 0 0; color: white; font-weight: 600; text-align: center;">
                            TTPs (Tactics, Techniques, Procedures)<br>
                            <span style="font-size: 0.8rem; opacity: 0.9;">üíÄ TOUGH! - Forces complete retooling</span>
                        </div>
                        <div style="background: linear-gradient(135deg, #ff8800, #ffa502); padding: 12px 50px; color: white; font-weight: 600; text-align: center;">
                            Tools<br>
                            <span style="font-size: 0.8rem; opacity: 0.9;">üò∞ Challenging - Must find new tools</span>
                        </div>
                        <div style="background: linear-gradient(135deg, #ffdd00, #ffeaa7); padding: 12px 70px; color: #333; font-weight: 600; text-align: center;">
                            Network/Host Artifacts<br>
                            <span style="font-size: 0.8rem; opacity: 0.9;">üòì Annoying - Requires reconfiguration</span>
                        </div>
                        <div style="background: linear-gradient(135deg, #00d4ff, #74b9ff); padding: 12px 90px; color: #333; font-weight: 600; text-align: center;">
                            Domain Names<br>
                            <span style="font-size: 0.8rem; opacity: 0.9;">üòê Simple - Register new domain</span>
                        </div>
                        <div style="background: linear-gradient(135deg, #00ff88, #55efc4); padding: 12px 110px; color: #333; font-weight: 600; text-align: center;">
                            IP Addresses<br>
                            <span style="font-size: 0.8rem; opacity: 0.9;">üò¥ Easy - Use different server</span>
                        </div>
                        <div style="background: linear-gradient(135deg, #a0a0a0, #dfe6e9); padding: 12px 130px; border-radius: 0 0 8px 8px; color: #333; font-weight: 600; text-align: center;">
                            Hash Values<br>
                            <span style="font-size: 0.8rem; opacity: 0.9;">üò¥ Trivial - Recompile with 1 change</span>
                        </div>
                    </div>
                </div>
            </div>

            <h3>Detection Strategy by Level</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Level</th>
                            <th>Example Detection</th>
                            <th>Attacker Effort to Evade</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="badge badge-green">Hash Values</span></td>
                            <td>Block SHA256 of known malware</td>
                            <td>Seconds - add a byte, recompile</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-green">IP Addresses</span></td>
                            <td>Block C2 server IP 192.168.1.100</td>
                            <td>Minutes - spin up new VPS</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-cyan">Domain Names</span></td>
                            <td>Block evil-domain.com</td>
                            <td>Hours - register new domain</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-yellow">Artifacts</span></td>
                            <td>Detect specific registry key created</td>
                            <td>Days - modify tool behavior</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-orange">Tools</span></td>
                            <td>Detect Mimikatz-like memory access</td>
                            <td>Weeks - find/build new tool</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-red">TTPs</span></td>
                            <td>Detect credential dumping behavior</td>
                            <td>Months - completely new approach</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h2 id="det-lifecycle">Detection Development Lifecycle</h2>

            <div class="diagram">
                <div class="flow-vertical">
                    <div class="flow-item" style="background: var(--bg-card);">1Ô∏è‚É£ RESEARCH</div>
                    <div class="flow-description">Study threat intelligence, MITRE ATT&CK, recent incidents</div>
                    <div class="flow-arrow">‚Üì</div>
                    
                    <div class="flow-item" style="background: var(--bg-card);">2Ô∏è‚É£ HYPOTHESIS</div>
                    <div class="flow-description">Define what malicious activity looks like in logs</div>
                    <div class="flow-arrow">‚Üì</div>
                    
                    <div class="flow-item" style="background: var(--bg-card);">3Ô∏è‚É£ DEVELOP</div>
                    <div class="flow-description">Write the detection query (KQL/SPL/Sigma)</div>
                    <div class="flow-arrow">‚Üì</div>
                    
                    <div class="flow-item" style="background: var(--bg-card);">4Ô∏è‚É£ TEST</div>
                    <div class="flow-description">Validate against attack simulations (Atomic Red Team)</div>
                    <div class="flow-arrow">‚Üì</div>
                    
                    <div class="flow-item" style="background: var(--bg-card);">5Ô∏è‚É£ DEPLOY</div>
                    <div class="flow-description">Enable in production with appropriate severity</div>
                    <div class="flow-arrow">‚Üì</div>
                    
                    <div class="flow-item" style="background: var(--bg-card);">6Ô∏è‚É£ TUNE</div>
                    <div class="flow-description">Analyze false positives, add exclusions, optimize</div>
                    <div class="flow-arrow">‚Üì</div>
                    
                    <div class="flow-item" style="background: var(--bg-card);">7Ô∏è‚É£ MEASURE</div>
                    <div class="flow-description">Track metrics, improve, document</div>
                </div>
            </div>

            <h2 id="det-metrics">Detection Metrics & KPIs</h2>

            <div class="grid-2">
                <div class="card">
                    <h4>üìä Coverage Metrics</h4>
                    <ul>
                        <li><strong>MITRE Coverage:</strong> % of ATT&CK techniques with detections</li>
                        <li><strong>Log Source Coverage:</strong> % of critical systems sending logs</li>
                        <li><strong>Use Case Coverage:</strong> Detections per threat category</li>
                    </ul>
                </div>
                <div class="card">
                    <h4>‚ö° Performance Metrics</h4>
                    <ul>
                        <li><strong>True Positive Rate:</strong> Real attacks detected / Total attacks</li>
                        <li><strong>False Positive Rate:</strong> False alerts / Total alerts</li>
                        <li><strong>Mean Time to Detect (MTTD):</strong> Time from attack to alert</li>
                    </ul>
                </div>
                <div class="card">
                    <h4>üîß Operational Metrics</h4>
                    <ul>
                        <li><strong>Rules Enabled:</strong> Active vs. disabled rules</li>
                        <li><strong>Alert Volume:</strong> Alerts per day/week</li>
                        <li><strong>Tuning Requests:</strong> FP reports from SOC</li>
                    </ul>
                </div>
                <div class="card">
                    <h4>üìà Improvement Metrics</h4>
                    <ul>
                        <li><strong>New Detections/Month:</strong> Detection velocity</li>
                        <li><strong>FP Reduction:</strong> % decrease over time</li>
                        <li><strong>Coverage Growth:</strong> New MITRE techniques covered</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- ============================================== -->
        <!-- MODULE 02: LOG ANALYSIS MASTERY -->
        <!-- ============================================== -->
        <div class="module" id="log-what">
            <div class="module-header">
                <span class="module-number">MODULE 02</span>
                <h1>Log Analysis Mastery</h1>
                <p class="lead">Understand log formats, sources, and analysis techniques. Logs are the raw material of detection engineering.</p>
            </div>

            <span class="skill-level beginner">üå± Beginner Friendly</span>

            <div class="concept-box">
                <div class="concept-title">What Are Logs?</div>
                <p>Logs are timestamped records of events that happen in systems, applications, and networks. They're the "black box recorder" of IT.</p>
                
                <div class="simple-explanation">
                    Every time you login, open a file, visit a website, or run a program - somewhere, a log is created. Security monitoring is about collecting these breadcrumbs and finding the ones left by attackers.
                </div>
            </div>

            <h2 id="log-formats">Log Formats</h2>

            <h3>1. Syslog Format (RFC 3164 / RFC 5424)</h3>
            <p>The oldest and most universal log format. Used by Linux, network devices, and many applications.</p>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Syslog</span>
                    <span class="code-title">Syslog Message Structure</span>
                </div>
                <pre><span class="cmt"># RFC 3164 (BSD Syslog) - Traditional format</span>
<span class="str">&lt;134&gt;</span>Dec 17 09:23:45 webserver01 nginx: 192.168.1.100 - - "GET /admin HTTP/1.1" 403 287

<span class="cmt"># Breaking it down:</span>
<span class="str">&lt;134&gt;</span>           <span class="cmt">‚Üí Priority (Facility √ó 8 + Severity)</span>
                  <span class="cmt">  Facility 16 (local0) √ó 8 + Severity 6 (info) = 134</span>
Dec 17 09:23:45  <span class="cmt">‚Üí Timestamp (no year, no timezone!)</span>
webserver01      <span class="cmt">‚Üí Hostname</span>
nginx:           <span class="cmt">‚Üí Application tag</span>
192.168.1.100... <span class="cmt">‚Üí Message content</span>

<span class="cmt"># RFC 5424 (Modern Syslog) - Better format</span>
<span class="str">&lt;134&gt;</span>1 2024-12-17T09:23:45.123Z webserver01 nginx 12345 ID47 - 192.168.1.100 - - "GET /admin"

<span class="cmt"># Improvements: ISO timestamp, version, structured data support</span></pre>
            </div>

            <h3>2. CEF (Common Event Format)</h3>
            <p>Standardized format developed by ArcSight. Widely used by security products.</p>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">CEF</span>
                    <span class="code-title">CEF Message Structure</span>
                </div>
                <pre><span class="cmt"># CEF Format</span>
CEF:Version|Device Vendor|Device Product|Device Version|Signature ID|Name|Severity|Extension

<span class="cmt"># Real example - Firewall blocked connection</span>
CEF:0|Palo Alto|Firewall|10.0|threat|Malware Detected|9|
    <span class="prop">src</span>=192.168.1.50 
    <span class="prop">dst</span>=45.33.32.156 
    <span class="prop">spt</span>=49234 
    <span class="prop">dpt</span>=443
    <span class="prop">act</span>=blocked 
    <span class="prop">cs1</span>=Emotet <span class="prop">cs1Label</span>=MalwareName
    <span class="prop">filePath</span>=/downloads/invoice.doc
    <span class="prop">fileHash</span>=a1b2c3d4e5f6...

<span class="cmt"># Key fields:</span>
<span class="cmt"># src = source IP</span>
<span class="cmt"># dst = destination IP</span>
<span class="cmt"># spt = source port</span>
<span class="cmt"># dpt = destination port</span>
<span class="cmt"># act = action taken</span>
<span class="cmt"># cs1-cs6 = custom strings (vendor-specific)</span></pre>
            </div>

            <h3>3. JSON Format</h3>
            <p>Modern, structured format. Easy to parse, self-describing, widely used in cloud environments.</p>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">JSON</span>
                    <span class="code-title">JSON Log Example</span>
                </div>
                <pre>{
    <span class="str">"timestamp"</span>: <span class="str">"2024-12-17T09:23:45.123Z"</span>,
    <span class="str">"level"</span>: <span class="str">"warning"</span>,
    <span class="str">"source"</span>: <span class="str">"authentication-service"</span>,
    <span class="str">"event_type"</span>: <span class="str">"login_failed"</span>,
    <span class="str">"user"</span>: {
        <span class="str">"username"</span>: <span class="str">"admin"</span>,
        <span class="str">"email"</span>: <span class="str">"admin@company.com"</span>
    },
    <span class="str">"network"</span>: {
        <span class="str">"source_ip"</span>: <span class="str">"192.168.1.100"</span>,
        <span class="str">"user_agent"</span>: <span class="str">"Mozilla/5.0..."</span>,
        <span class="str">"geo"</span>: {
            <span class="str">"country"</span>: <span class="str">"US"</span>,
            <span class="str">"city"</span>: <span class="str">"New York"</span>
        }
    },
    <span class="str">"message"</span>: <span class="str">"Authentication failed: invalid password"</span>
}</pre>
            </div>

            <h2 id="log-windows">Windows Event Logs</h2>

            <div class="concept-box">
                <div class="concept-title">Windows Event Log Architecture</div>
                <p>Windows stores events in .evtx files organized by channels. The most important for security:</p>
                <ul>
                    <li><strong>Security:</strong> Authentication, authorization, audit events</li>
                    <li><strong>System:</strong> OS-level events, service status, drivers</li>
                    <li><strong>Application:</strong> Application-specific events</li>
                    <li><strong>PowerShell:</strong> Script execution, command logging</li>
                    <li><strong>Sysmon:</strong> Advanced process, network, file monitoring</li>
                </ul>
            </div>

            <h3>Critical Windows Event IDs</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Event ID</th>
                            <th>Category</th>
                            <th>Description</th>
                            <th>Security Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="badge badge-cyan">4624</span></td>
                            <td>Logon</td>
                            <td>Successful logon</td>
                            <td>Track who logged in, when, from where</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-orange">4625</span></td>
                            <td>Logon</td>
                            <td>Failed logon</td>
                            <td>üî¥ Brute force detection</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-magenta">4648</span></td>
                            <td>Logon</td>
                            <td>Explicit credential logon</td>
                            <td>üî¥ Credential theft, lateral movement</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-purple">4672</span></td>
                            <td>Privilege</td>
                            <td>Special privileges assigned</td>
                            <td>Admin logon tracking</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-red">4688</span></td>
                            <td>Process</td>
                            <td>Process created</td>
                            <td>üî¥ Command execution, malware</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-yellow">4698</span></td>
                            <td>Task</td>
                            <td>Scheduled task created</td>
                            <td>üî¥ Persistence mechanism</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-green">4720</span></td>
                            <td>Account</td>
                            <td>User account created</td>
                            <td>üî¥ Backdoor accounts</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-blue">7045</span></td>
                            <td>Service</td>
                            <td>Service installed</td>
                            <td>üî¥ Persistence, malware installation</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>Understanding Event 4624 (Logon)</h3>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">XML</span>
                    <span class="code-title">Windows Event 4624 Structure</span>
                </div>
                <pre><span class="cmt">&lt;!-- Event 4624: An account was successfully logged on --&gt;</span>
&lt;Event&gt;
  &lt;System&gt;
    &lt;EventID&gt;<span class="num">4624</span>&lt;/EventID&gt;
    &lt;TimeCreated SystemTime="<span class="str">2024-12-17T09:23:45.123Z</span>"/&gt;
    &lt;Computer&gt;<span class="str">DC01.corp.local</span>&lt;/Computer&gt;
  &lt;/System&gt;
  &lt;EventData&gt;
    &lt;Data Name="SubjectUserName"&gt;<span class="str">-</span>&lt;/Data&gt;
    &lt;Data Name="TargetUserName"&gt;<span class="str">jsmith</span>&lt;/Data&gt;                <span class="cmt">&lt;!-- WHO logged in --&gt;</span>
    &lt;Data Name="TargetDomainName"&gt;<span class="str">CORP</span>&lt;/Data&gt;
    &lt;Data Name="LogonType"&gt;<span class="num">10</span>&lt;/Data&gt;                        <span class="cmt">&lt;!-- HOW they logged in --&gt;</span>
    &lt;Data Name="IpAddress"&gt;<span class="str">192.168.1.100</span>&lt;/Data&gt;            <span class="cmt">&lt;!-- FROM where --&gt;</span>
    &lt;Data Name="WorkstationName"&gt;<span class="str">WORKSTATION01</span>&lt;/Data&gt;
    &lt;Data Name="LogonProcessName"&gt;<span class="str">User32</span>&lt;/Data&gt;
    &lt;Data Name="AuthenticationPackageName"&gt;<span class="str">Negotiate</span>&lt;/Data&gt; <span class="cmt">&lt;!-- Auth method --&gt;</span>
  &lt;/EventData&gt;
&lt;/Event&gt;

<span class="cmt">// LOGON TYPES - Critical for investigation!</span>
<span class="cmt">// 2  = Interactive (keyboard/console)</span>
<span class="cmt">// 3  = Network (SMB, file share, WMI)</span>
<span class="cmt">// 4  = Batch (scheduled task)</span>
<span class="cmt">// 5  = Service (service startup)</span>
<span class="cmt">// 7  = Unlock (workstation unlock)</span>
<span class="cmt">// 8  = NetworkCleartext (IIS basic auth)</span>
<span class="cmt">// 9  = NewCredentials (RunAs /netonly)</span>
<span class="cmt">// 10 = RemoteInteractive (RDP)</span>
<span class="cmt">// 11 = CachedInteractive (cached domain creds)</span></pre>
            </div>

            <h2 id="log-linux">Linux Logs</h2>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Log File</th>
                            <th>Purpose</th>
                            <th>Security Events</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code class="inline-code">/var/log/auth.log</code></td>
                            <td>Authentication events (Debian/Ubuntu)</td>
                            <td>SSH logins, sudo, su, PAM events</td>
                        </tr>
                        <tr>
                            <td><code class="inline-code">/var/log/secure</code></td>
                            <td>Authentication events (RHEL/CentOS)</td>
                            <td>Same as auth.log</td>
                        </tr>
                        <tr>
                            <td><code class="inline-code">/var/log/audit/audit.log</code></td>
                            <td>Linux Audit Framework</td>
                            <td>Detailed syscall auditing, file access</td>
                        </tr>
                        <tr>
                            <td><code class="inline-code">/var/log/syslog</code></td>
                            <td>General system messages</td>
                            <td>Service status, errors, kernel messages</td>
                        </tr>
                        <tr>
                            <td><code class="inline-code">/var/log/cron</code></td>
                            <td>Cron job execution</td>
                            <td>Scheduled task monitoring</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Log</span>
                    <span class="code-title">Linux auth.log Examples</span>
                </div>
                <pre><span class="cmt"># Successful SSH login</span>
Dec 17 09:23:45 server01 sshd[12345]: <span class="str">Accepted publickey</span> for <span class="var">jsmith</span> from <span class="num">192.168.1.100</span> port 49234 ssh2

<span class="cmt"># Failed SSH login (brute force indicator)</span>
Dec 17 09:23:46 server01 sshd[12346]: <span class="str">Failed password</span> for <span class="var">root</span> from <span class="num">45.33.32.156</span> port 22

<span class="cmt"># Sudo command execution</span>
Dec 17 09:24:00 server01 sudo: <span class="var">jsmith</span> : TTY=pts/0 ; PWD=/home/jsmith ; USER=root ; COMMAND=<span class="str">/bin/cat /etc/shadow</span>

<span class="cmt"># User added to sudo group (privilege escalation!)</span>
Dec 17 09:25:00 server01 usermod[12350]: add <span class="var">'attacker'</span> to group <span class="str">'sudo'</span></pre>
            </div>
        </div>

        <!-- ============================================== -->
        <!-- MODULE 03: KQL DEEP DIVE -->
        <!-- ============================================== -->
        <div class="module" id="kql-intro">
            <div class="module-header">
                <span class="module-number">MODULE 03</span>
                <h1>KQL Deep Dive</h1>
                <p class="lead">Master Kusto Query Language (KQL) - the query language for Microsoft Sentinel, Log Analytics, and Microsoft 365 Defender.</p>
            </div>

            <span class="skill-level beginner">üå± Starting Simple ‚Üí üå≥ Building to Advanced</span>

            <div class="concept-box">
                <div class="concept-title">What is KQL?</div>
                <p>KQL (Kusto Query Language) is a read-only query language used to analyze large datasets in Azure. It's designed to be easy to read and write.</p>
                
                <div class="simple-explanation">
                    Think of KQL like a super-powered Excel filter. You start with a table of data, then apply a series of operations to filter, transform, and summarize it. Each operation uses a pipe (|) to pass results to the next.
                </div>
            </div>

            <h2 id="kql-basics">KQL Basics</h2>

            <h3>Query Structure</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL</span>
                    <span class="code-title">Basic Query Pattern</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre><span class="cmt">// KQL queries flow from top to bottom</span>
<span class="cmt">// Start with a table, then apply operations</span>

<span class="var">TableName</span>                           <span class="cmt">// 1. Start with data</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">Column</span> == <span class="str">"value"</span>          <span class="cmt">// 2. Filter rows</span>
<span class="op">|</span> <span class="kw">project</span> <span class="prop">Column1</span>, <span class="prop">Column2</span>         <span class="cmt">// 3. Select columns</span>
<span class="op">|</span> <span class="kw">summarize</span> <span class="fn">count</span>() <span class="kw">by</span> <span class="prop">Column1</span>    <span class="cmt">// 4. Aggregate</span>
<span class="op">|</span> <span class="kw">order by</span> <span class="prop">count_</span> <span class="kw">desc</span>            <span class="cmt">// 5. Sort</span>
<span class="op">|</span> <span class="kw">take</span> <span class="num">10</span>                           <span class="cmt">// 6. Limit results</span></pre>
            </div>

            <h3>Essential Operators</h3>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL</span>
                    <span class="code-title">where - Filter Rows</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre><span class="cmt">// Exact match (case-sensitive)</span>
<span class="var">SecurityEvent</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">EventID</span> == <span class="num">4625</span>

<span class="cmt">// Case-insensitive match</span>
<span class="var">SecurityEvent</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">Account</span> =~ <span class="str">"ADMIN"</span>

<span class="cmt">// Contains (case-insensitive)</span>
<span class="var">SecurityEvent</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">CommandLine</span> <span class="kw">contains</span> <span class="str">"powershell"</span>

<span class="cmt">// Starts with</span>
<span class="var">SecurityEvent</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">Account</span> <span class="kw">startswith</span> <span class="str">"SVC_"</span>

<span class="cmt">// Multiple values</span>
<span class="var">SecurityEvent</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">EventID</span> <span class="kw">in</span> (<span class="num">4624</span>, <span class="num">4625</span>, <span class="num">4648</span>)

<span class="cmt">// Time filter (ALWAYS do this first for performance!)</span>
<span class="var">SecurityEvent</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">TimeGenerated</span> > <span class="fn">ago</span>(<span class="num">24h</span>)

<span class="cmt">// Regex match</span>
<span class="var">SecurityEvent</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">CommandLine</span> <span class="kw">matches regex</span> <span class="str">@"(?i)invoke-mimikatz"</span></pre>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL</span>
                    <span class="code-title">project & extend - Work with Columns</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre><span class="cmt">// project - Select specific columns (like SQL SELECT)</span>
<span class="var">SecurityEvent</span>
<span class="op">|</span> <span class="kw">project</span> <span class="prop">TimeGenerated</span>, <span class="prop">Account</span>, <span class="prop">EventID</span>, <span class="prop">Computer</span>

<span class="cmt">// project-away - Remove specific columns</span>
<span class="var">SecurityEvent</span>
<span class="op">|</span> <span class="kw">project-away</span> <span class="prop">TenantId</span>, <span class="prop">SourceSystem</span>

<span class="cmt">// extend - Add new calculated columns</span>
<span class="var">SecurityEvent</span>
<span class="op">|</span> <span class="kw">extend</span> <span class="prop">DayOfWeek</span> = <span class="fn">dayofweek</span>(<span class="prop">TimeGenerated</span>)
<span class="op">|</span> <span class="kw">extend</span> <span class="prop">IsWeekend</span> = <span class="prop">DayOfWeek</span> <span class="kw">in</span> (<span class="num">0</span>, <span class="num">6</span>)

<span class="cmt">// Rename columns</span>
<span class="var">SecurityEvent</span>
<span class="op">|</span> <span class="kw">project-rename</span> <span class="prop">SourceIP</span> = <span class="prop">IpAddress</span></pre>
            </div>

            <h2 id="kql-aggregation">Aggregation & Summarization</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL</span>
                    <span class="code-title">summarize - Group and Aggregate</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre><span class="cmt">// Count events by type</span>
<span class="var">SecurityEvent</span>
<span class="op">|</span> <span class="kw">summarize</span> <span class="prop">EventCount</span> = <span class="fn">count</span>() <span class="kw">by</span> <span class="prop">EventID</span>

<span class="cmt">// Count distinct values</span>
<span class="var">SecurityEvent</span>
<span class="op">|</span> <span class="kw">summarize</span> <span class="prop">UniqueUsers</span> = <span class="fn">dcount</span>(<span class="prop">Account</span>) <span class="kw">by</span> <span class="prop">Computer</span>

<span class="cmt">// Multiple aggregations</span>
<span class="var">SecurityEvent</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">EventID</span> == <span class="num">4625</span>
<span class="op">|</span> <span class="kw">summarize</span> 
    <span class="prop">FailCount</span> = <span class="fn">count</span>(),
    <span class="prop">FirstAttempt</span> = <span class="fn">min</span>(<span class="prop">TimeGenerated</span>),
    <span class="prop">LastAttempt</span> = <span class="fn">max</span>(<span class="prop">TimeGenerated</span>),
    <span class="prop">SourceIPs</span> = <span class="fn">make_set</span>(<span class="prop">IpAddress</span>)
    <span class="kw">by</span> <span class="prop">Account</span>

<span class="cmt">// Time buckets (histogram)</span>
<span class="var">SecurityEvent</span>
<span class="op">|</span> <span class="kw">summarize</span> <span class="fn">count</span>() <span class="kw">by</span> <span class="fn">bin</span>(<span class="prop">TimeGenerated</span>, <span class="num">1h</span>)
<span class="op">|</span> <span class="kw">render</span> timechart

<span class="cmt">// Get the latest event per group</span>
<span class="var">SecurityEvent</span>
<span class="op">|</span> <span class="kw">summarize</span> <span class="fn">arg_max</span>(<span class="prop">TimeGenerated</span>, *) <span class="kw">by</span> <span class="prop">Account</span></pre>
            </div>

            <h2 id="kql-joins">Joins & Unions</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL</span>
                    <span class="code-title">join - Combine Tables</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre><span class="cmt">// Inner join (default) - only matching rows</span>
<span class="var">SecurityEvent</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">EventID</span> == <span class="num">4625</span>  <span class="cmt">// Failed logins</span>
<span class="op">|</span> <span class="kw">join</span> <span class="kw">kind</span>=inner (
    <span class="var">SecurityEvent</span>
    <span class="op">|</span> <span class="kw">where</span> <span class="prop">EventID</span> == <span class="num">4624</span>  <span class="cmt">// Successful logins</span>
) <span class="kw">on</span> <span class="prop">Account</span>, <span class="prop">IpAddress</span>

<span class="cmt">// Left outer join - all rows from left, matching from right</span>
<span class="var">Users</span>
<span class="op">|</span> <span class="kw">join</span> <span class="kw">kind</span>=leftouter <span class="var">SignInLogs</span> <span class="kw">on</span> <span class="prop">$left.UserPrincipalName</span> == <span class="prop">$right.UserPrincipalName</span>

<span class="cmt">// Join types:</span>
<span class="cmt">// inner      - Only matching rows (default)</span>
<span class="cmt">// leftouter  - All left rows, matching right</span>
<span class="cmt">// rightouter - All right rows, matching left</span>
<span class="cmt">// fullouter  - All rows from both</span>
<span class="cmt">// leftanti   - Left rows with NO match in right</span>
<span class="cmt">// rightanti  - Right rows with NO match in left</span></pre>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL</span>
                    <span class="code-title">union - Stack Tables</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre><span class="cmt">// Combine data from multiple tables</span>
<span class="kw">union</span> <span class="var">SecurityEvent</span>, <span class="var">WindowsEvent</span>, <span class="var">Syslog</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">TimeGenerated</span> > <span class="fn">ago</span>(<span class="num">1h</span>)
<span class="op">|</span> <span class="kw">summarize</span> <span class="fn">count</span>() <span class="kw">by</span> <span class="prop">Type</span>

<span class="cmt">// union with wildcard (all tables matching pattern)</span>
<span class="kw">union</span> <span class="var">Security*</span>
<span class="op">|</span> <span class="kw">take</span> <span class="num">100</span></pre>
            </div>

            <h2 id="kql-parsing">Parsing Functions</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL</span>
                    <span class="code-title">Parsing Techniques</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre><span class="cmt">// Parse structured text</span>
<span class="var">Syslog</span>
<span class="op">|</span> <span class="kw">parse</span> <span class="prop">SyslogMessage</span> <span class="kw">with</span> 
    * <span class="str">"user="</span> <span class="prop">Username</span>:<span class="kw">string</span> <span class="str">" "</span>
    * <span class="str">"src="</span> <span class="prop">SourceIP</span>:<span class="kw">string</span> <span class="str">" "</span>
    *

<span class="cmt">// Extract with regex</span>
<span class="var">SecurityEvent</span>
<span class="op">|</span> <span class="kw">extend</span> <span class="prop">Domain</span> = <span class="fn">extract</span>(<span class="str">@"@(.+)$"</span>, <span class="num">1</span>, <span class="prop">Account</span>)

<span class="cmt">// Parse JSON</span>
<span class="var">AzureActivity</span>
<span class="op">|</span> <span class="kw">extend</span> <span class="prop">Properties</span> = <span class="fn">parse_json</span>(<span class="prop">Properties</span>)
<span class="op">|</span> <span class="kw">extend</span> <span class="prop">StatusCode</span> = <span class="prop">Properties</span>.<span class="prop">statusCode</span>

<span class="cmt">// Parse CEF format</span>
<span class="var">CommonSecurityLog</span>
<span class="op">|</span> <span class="kw">extend</span> <span class="prop">CEF</span> = <span class="fn">parse_cef</span>(<span class="prop">Message</span>)

<span class="cmt">// Split strings</span>
<span class="var">SecurityEvent</span>
<span class="op">|</span> <span class="kw">extend</span> <span class="prop">PathParts</span> = <span class="fn">split</span>(<span class="prop">CommandLine</span>, <span class="str">"\\"</span>)
<span class="op">|</span> <span class="kw">extend</span> <span class="prop">FileName</span> = <span class="prop">PathParts</span>[-<span class="num">1</span>]</pre>
            </div>

            <h2 id="kql-advanced">Advanced Detection Patterns</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL</span>
                    <span class="code-title">Pattern: Threshold-Based Detection</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre><span class="cmt">// Detect brute force: 10+ failed logins in 5 minutes</span>
<span class="var">SecurityEvent</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">TimeGenerated</span> > <span class="fn">ago</span>(<span class="num">1h</span>)
<span class="op">|</span> <span class="kw">where</span> <span class="prop">EventID</span> == <span class="num">4625</span>
<span class="op">|</span> <span class="kw">summarize</span> 
    <span class="prop">FailCount</span> = <span class="fn">count</span>(),
    <span class="prop">StartTime</span> = <span class="fn">min</span>(<span class="prop">TimeGenerated</span>),
    <span class="prop">EndTime</span> = <span class="fn">max</span>(<span class="prop">TimeGenerated</span>)
    <span class="kw">by</span> <span class="prop">Account</span>, <span class="prop">IpAddress</span>, <span class="fn">bin</span>(<span class="prop">TimeGenerated</span>, <span class="num">5m</span>)
<span class="op">|</span> <span class="kw">where</span> <span class="prop">FailCount</span> >= <span class="num">10</span></pre>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL</span>
                    <span class="code-title">Pattern: Baseline Anomaly</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre><span class="cmt">// Detect users logging in from new countries</span>
<span class="kw">let</span> <span class="var">BaselinePeriod</span> = <span class="num">30d</span>;
<span class="kw">let</span> <span class="var">DetectionPeriod</span> = <span class="num">1d</span>;

<span class="cmt">// Build baseline of known countries per user</span>
<span class="kw">let</span> <span class="var">Baseline</span> = 
    <span class="var">SigninLogs</span>
    <span class="op">|</span> <span class="kw">where</span> <span class="prop">TimeGenerated</span> <span class="kw">between</span> (<span class="fn">ago</span>(<span class="var">BaselinePeriod</span>) .. <span class="fn">ago</span>(<span class="var">DetectionPeriod</span>))
    <span class="op">|</span> <span class="kw">summarize</span> <span class="prop">KnownCountries</span> = <span class="fn">make_set</span>(<span class="prop">LocationDetails</span>.<span class="prop">countryOrRegion</span>) <span class="kw">by</span> <span class="prop">UserPrincipalName</span>;

<span class="cmt">// Find logins from new countries</span>
<span class="var">SigninLogs</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">TimeGenerated</span> > <span class="fn">ago</span>(<span class="var">DetectionPeriod</span>)
<span class="op">|</span> <span class="kw">join</span> <span class="kw">kind</span>=leftouter <span class="var">Baseline</span> <span class="kw">on</span> <span class="prop">UserPrincipalName</span>
<span class="op">|</span> <span class="kw">extend</span> <span class="prop">CurrentCountry</span> = <span class="fn">tostring</span>(<span class="prop">LocationDetails</span>.<span class="prop">countryOrRegion</span>)
<span class="op">|</span> <span class="kw">where</span> <span class="prop">CurrentCountry</span> !<span class="kw">in</span> (<span class="prop">KnownCountries</span>)
<span class="op">|</span> <span class="kw">project</span> <span class="prop">TimeGenerated</span>, <span class="prop">UserPrincipalName</span>, <span class="prop">CurrentCountry</span>, <span class="prop">KnownCountries</span>, <span class="prop">IPAddress</span></pre>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL</span>
                    <span class="code-title">Pattern: Event Sequence (Correlation)</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre><span class="cmt">// Detect: Failed logins ‚Üí Success ‚Üí Sensitive file access</span>
<span class="kw">let</span> <span class="var">TimeWindow</span> = <span class="num">30m</span>;

<span class="kw">let</span> <span class="var">FailedLogins</span> = 
    <span class="var">SecurityEvent</span>
    <span class="op">|</span> <span class="kw">where</span> <span class="prop">EventID</span> == <span class="num">4625</span>
    <span class="op">|</span> <span class="kw">summarize</span> <span class="prop">FailCount</span> = <span class="fn">count</span>(), <span class="prop">FailTime</span> = <span class="fn">max</span>(<span class="prop">TimeGenerated</span>) <span class="kw">by</span> <span class="prop">Account</span>, <span class="prop">Computer</span>;

<span class="kw">let</span> <span class="var">SuccessLogins</span> = 
    <span class="var">SecurityEvent</span>
    <span class="op">|</span> <span class="kw">where</span> <span class="prop">EventID</span> == <span class="num">4624</span>
    <span class="op">|</span> <span class="kw">project</span> <span class="prop">Account</span>, <span class="prop">Computer</span>, <span class="prop">SuccessTime</span> = <span class="prop">TimeGenerated</span>;

<span class="kw">let</span> <span class="var">FileAccess</span> = 
    <span class="var">SecurityEvent</span>
    <span class="op">|</span> <span class="kw">where</span> <span class="prop">EventID</span> == <span class="num">4663</span>  <span class="cmt">// File access</span>
    <span class="op">|</span> <span class="kw">where</span> <span class="prop">ObjectName</span> <span class="kw">contains</span> <span class="str">"sensitive"</span>
    <span class="op">|</span> <span class="kw">project</span> <span class="prop">Account</span>, <span class="prop">Computer</span>, <span class="prop">AccessTime</span> = <span class="prop">TimeGenerated</span>, <span class="prop">ObjectName</span>;

<span class="var">FailedLogins</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">FailCount</span> >= <span class="num">3</span>
<span class="op">|</span> <span class="kw">join</span> <span class="kw">kind</span>=inner <span class="var">SuccessLogins</span> <span class="kw">on</span> <span class="prop">Account</span>, <span class="prop">Computer</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">SuccessTime</span> > <span class="prop">FailTime</span> <span class="kw">and</span> <span class="prop">SuccessTime</span> - <span class="prop">FailTime</span> < <span class="var">TimeWindow</span>
<span class="op">|</span> <span class="kw">join</span> <span class="kw">kind</span>=inner <span class="var">FileAccess</span> <span class="kw">on</span> <span class="prop">Account</span>, <span class="prop">Computer</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">AccessTime</span> > <span class="prop">SuccessTime</span> <span class="kw">and</span> <span class="prop">AccessTime</span> - <span class="prop">SuccessTime</span> < <span class="var">TimeWindow</span></pre>
            </div>
        </div>

        <!-- ============================================== -->
        <!-- QUICK REFERENCE -->
        <!-- ============================================== -->
        <div class="module" id="ref-kql">
            <div class="module-header">
                <span class="module-number">QUICK REFERENCE</span>
                <h1>Cheat Sheets & Quick Reference</h1>
                <p class="lead">Essential reference material for daily use.</p>
            </div>

            <h2>KQL Quick Reference</h2>

            <div class="grid-2">
                <div class="card">
                    <h4>Time Filters</h4>
                    <div class="code-block" style="margin: 10px 0;">
                        <pre style="padding: 10px; font-size: 0.8rem;"><span class="kw">where</span> TimeGenerated > <span class="fn">ago</span>(<span class="num">1h</span>)
<span class="kw">where</span> TimeGenerated > <span class="fn">ago</span>(<span class="num">7d</span>)
<span class="kw">where</span> TimeGenerated <span class="kw">between</span> (<span class="fn">ago</span>(<span class="num">7d</span>) .. <span class="fn">ago</span>(<span class="num">1d</span>))
<span class="kw">where</span> TimeGenerated >= <span class="fn">datetime</span>(<span class="num">2024-01-01</span>)</pre>
                    </div>
                </div>
                <div class="card">
                    <h4>String Operators</h4>
                    <div class="code-block" style="margin: 10px 0;">
                        <pre style="padding: 10px; font-size: 0.8rem;">== <span class="cmt">// Exact match (case-sensitive)</span>
=~ <span class="cmt">// Exact match (case-insensitive)</span>
<span class="kw">contains</span> <span class="cmt">// Substring (case-insensitive)</span>
<span class="kw">has</span> <span class="cmt">// Word boundary match</span>
<span class="kw">startswith</span> <span class="cmt">// Prefix match</span>
<span class="kw">endswith</span> <span class="cmt">// Suffix match</span>
<span class="kw">matches regex</span> <span class="cmt">// Regular expression</span></pre>
                    </div>
                </div>
                <div class="card">
                    <h4>Aggregation Functions</h4>
                    <div class="code-block" style="margin: 10px 0;">
                        <pre style="padding: 10px; font-size: 0.8rem;"><span class="fn">count</span>()        <span class="cmt">// Count rows</span>
<span class="fn">dcount</span>(col)    <span class="cmt">// Count distinct values</span>
<span class="fn">sum</span>(col)       <span class="cmt">// Sum values</span>
<span class="fn">avg</span>(col)       <span class="cmt">// Average</span>
<span class="fn">min</span>(col)       <span class="cmt">// Minimum</span>
<span class="fn">max</span>(col)       <span class="cmt">// Maximum</span>
<span class="fn">make_set</span>(col)  <span class="cmt">// Unique values as array</span>
<span class="fn">make_list</span>(col) <span class="cmt">// All values as array</span></pre>
                    </div>
                </div>
                <div class="card">
                    <h4>Useful Functions</h4>
                    <div class="code-block" style="margin: 10px 0;">
                        <pre style="padding: 10px; font-size: 0.8rem;"><span class="fn">tostring</span>(col)    <span class="cmt">// Convert to string</span>
<span class="fn">toint</span>(col)       <span class="cmt">// Convert to integer</span>
<span class="fn">parse_json</span>(col)  <span class="cmt">// Parse JSON</span>
<span class="fn">split</span>(col, ",")  <span class="cmt">// Split string</span>
<span class="fn">strcat</span>(a, b)     <span class="cmt">// Concatenate strings</span>
<span class="fn">iff</span>(cond, t, f)  <span class="cmt">// If-then-else</span>
<span class="fn">case</span>(...)        <span class="cmt">// Switch statement</span>
<span class="fn">isempty</span>(col)     <span class="cmt">// Check if null/empty</span></pre>
                    </div>
                </div>
            </div>

            <h2 id="ref-eventids">Windows Event IDs Reference</h2>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Event ID</th>
                            <th>Description</th>
                            <th>Detection Use</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td><span class="badge badge-cyan">4624</span></td><td>Successful logon</td><td>Track access, lateral movement</td></tr>
                        <tr><td><span class="badge badge-orange">4625</span></td><td>Failed logon</td><td>Brute force detection</td></tr>
                        <tr><td><span class="badge badge-magenta">4648</span></td><td>Explicit credentials</td><td>Credential theft, RunAs</td></tr>
                        <tr><td><span class="badge badge-purple">4672</span></td><td>Special privileges</td><td>Admin logon tracking</td></tr>
                        <tr><td><span class="badge badge-red">4688</span></td><td>Process created</td><td>Command execution, malware</td></tr>
                        <tr><td><span class="badge badge-yellow">4698</span></td><td>Scheduled task created</td><td>Persistence</td></tr>
                        <tr><td><span class="badge badge-green">4720</span></td><td>User created</td><td>Backdoor accounts</td></tr>
                        <tr><td><span class="badge badge-blue">4732</span></td><td>Member added to local group</td><td>Privilege escalation</td></tr>
                        <tr><td><span class="badge badge-cyan">4768</span></td><td>Kerberos TGT requested</td><td>Initial authentication</td></tr>
                        <tr><td><span class="badge badge-orange">4769</span></td><td>Kerberos service ticket</td><td>Kerberoasting detection</td></tr>
                        <tr><td><span class="badge badge-red">7045</span></td><td>Service installed</td><td>Persistence, malware</td></tr>
                    </tbody>
                </table>
            </div>

            <h2 id="ref-regex">Common Regex Patterns</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Regex</span>
                    <span class="code-title">Security-Related Regex Patterns</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre><span class="cmt">// IP Address (IPv4)</span>
<span class="str">\b(?:\d{1,3}\.){3}\d{1,3}\b</span>

<span class="cmt">// Email Address</span>
<span class="str">[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}</span>

<span class="cmt">// URL</span>
<span class="str">https?:\/\/[^\s]+</span>

<span class="cmt">// Domain Name</span>
<span class="str">(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\.)+[a-z]{2,}</span>

<span class="cmt">// MD5 Hash</span>
<span class="str">\b[a-fA-F0-9]{32}\b</span>

<span class="cmt">// SHA256 Hash</span>
<span class="str">\b[a-fA-F0-9]{64}\b</span>

<span class="cmt">// Base64 Encoded String (potential obfuscation)</span>
<span class="str">[A-Za-z0-9+/]{20,}={0,2}</span>

<span class="cmt">// Windows Path</span>
<span class="str">[a-zA-Z]:\\(?:[^\\/:*?"<>|\r\n]+\\)*[^\\/:*?"<>|\r\n]*</span>

<span class="cmt">// CVE ID</span>
<span class="str">CVE-\d{4}-\d{4,}</span></pre>
            </div>

            <h2 id="ref-ports">Common Ports Reference</h2>

            <div class="grid-2">
                <div class="card">
                    <h4>Standard Services</h4>
                    <div class="table-wrapper" style="margin: 10px 0;">
                        <table style="font-size: 0.85rem;">
                            <tr><td>21</td><td>FTP</td></tr>
                            <tr><td>22</td><td>SSH</td></tr>
                            <tr><td>23</td><td>Telnet ‚ö†Ô∏è</td></tr>
                            <tr><td>25</td><td>SMTP</td></tr>
                            <tr><td>53</td><td>DNS</td></tr>
                            <tr><td>80</td><td>HTTP</td></tr>
                            <tr><td>443</td><td>HTTPS</td></tr>
                            <tr><td>3389</td><td>RDP</td></tr>
                        </table>
                    </div>
                </div>
                <div class="card">
                    <h4>Windows/AD Services</h4>
                    <div class="table-wrapper" style="margin: 10px 0;">
                        <table style="font-size: 0.85rem;">
                            <tr><td>88</td><td>Kerberos</td></tr>
                            <tr><td>135</td><td>RPC</td></tr>
                            <tr><td>139</td><td>NetBIOS</td></tr>
                            <tr><td>389</td><td>LDAP</td></tr>
                            <tr><td>445</td><td>SMB</td></tr>
                            <tr><td>636</td><td>LDAPS</td></tr>
                            <tr><td>5985</td><td>WinRM HTTP</td></tr>
                            <tr><td>5986</td><td>WinRM HTTPS</td></tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================== -->
        <!-- INTERVIEW PREP -->
        <!-- ============================================== -->
        <div class="module" id="interview-technical">
            <div class="module-header">
                <span class="module-number">INTERVIEW PREP</span>
                <h1>Interview Questions & Answers</h1>
                <p class="lead">Prepare for Detection Engineering and Security Engineer interviews.</p>
            </div>

            <h2>Technical Questions</h2>

            <div class="card">
                <h4>Q: What's the difference between signature-based and behavioral detection?</h4>
                <p><strong>Answer:</strong> Signature-based detection looks for exact matches (specific hashes, IPs, domains) - very precise but easily evaded. Behavioral detection looks for patterns of activity (what an attacker DOES) - catches novel attacks but requires more tuning.</p>
                <p><strong>Example:</strong> Blocking a malware hash is signature-based. Detecting "process accessing LSASS memory" is behavioral - works even if the attacker uses a new tool.</p>
            </div>

            <div class="card">
                <h4>Q: Explain the Pyramid of Pain and why it matters</h4>
                <p><strong>Answer:</strong> The Pyramid of Pain shows how different indicators affect attackers. At the bottom (hashes, IPs) are easy to change. At the top (TTPs - tactics, techniques, procedures) are hard to change because they represent how attackers operate. Detection at higher levels forces attackers to completely retool.</p>
            </div>

            <div class="card">
                <h4>Q: How would you reduce false positives in a detection rule?</h4>
                <p><strong>Answer:</strong></p>
                <ol>
                    <li><strong>Analyze samples:</strong> Review 50-100 alerts to identify patterns</li>
                    <li><strong>Add context:</strong> Exclude known-good processes, users, or systems</li>
                    <li><strong>Increase specificity:</strong> Add more conditions (time-based, correlation)</li>
                    <li><strong>Allowlist carefully:</strong> Document every exclusion with justification</li>
                    <li><strong>Test changes:</strong> Verify exclusions don't create detection gaps</li>
                </ol>
            </div>

            <div class="card">
                <h4>Q: How would you detect Kerberoasting?</h4>
                <p><strong>Answer:</strong> Look for Event ID 4769 (Kerberos service ticket request) where:</p>
                <ul>
                    <li>Encryption type is RC4 (0x17) instead of AES</li>
                    <li>Service is not krbtgt</li>
                    <li>Multiple service tickets requested in short time</li>
                </ul>
                <div class="code-block" style="margin: 10px 0;">
                    <pre style="padding: 10px; font-size: 0.8rem;"><span class="var">SecurityEvent</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">EventID</span> == <span class="num">4769</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">TicketEncryptionType</span> == <span class="str">"0x17"</span>
<span class="op">|</span> <span class="kw">where</span> <span class="prop">ServiceName</span> !<span class="kw">contains</span> <span class="str">"krbtgt"</span></pre>
                </div>
            </div>

            <h2 id="interview-scenarios">Scenario Questions</h2>

            <div class="card">
                <h4>Q: You see a PowerShell command with Base64 encoded content. Walk me through your investigation.</h4>
                <p><strong>Answer (STAR Method):</strong></p>
                <ol>
                    <li><strong>Decode the Base64</strong> - Understand what it's doing</li>
                    <li><strong>Check process tree</strong> - What launched PowerShell?</li>
                    <li><strong>Review network connections</strong> - Any C2 communication?</li>
                    <li><strong>Check for persistence</strong> - Scheduled tasks, registry, services?</li>
                    <li><strong>Identify user context</strong> - Compromised account?</li>
                    <li><strong>Scope the impact</strong> - Other affected systems?</li>
                    <li><strong>Determine if malicious</strong> - Compare against known TTPs</li>
                </ol>
            </div>

            <div class="card">
                <h4>Q: A detection rule is generating 100+ alerts per day. How do you handle it?</h4>
                <p><strong>Answer:</strong></p>
                <ol>
                    <li><strong>Don't disable immediately</strong> - Understand why it's firing</li>
                    <li><strong>Sample alerts</strong> - Review 20-50 to identify patterns</li>
                    <li><strong>Categorize</strong> - What % are true positives vs false positives?</li>
                    <li><strong>Root cause FPs</strong> - Is it a specific user, system, or application?</li>
                    <li><strong>Add targeted exclusions</strong> - Don't broadly suppress</li>
                    <li><strong>Document changes</strong> - Track what was excluded and why</li>
                    <li><strong>Monitor impact</strong> - Verify alert volume decreased without losing visibility</li>
                </ol>
            </div>

            <h2 id="interview-behavioral">Behavioral Questions (STAR Method)</h2>

            <div class="card">
                <h4>Q: Tell me about a time you improved a detection process</h4>
                <p><strong>Example Answer:</strong></p>
                <ul>
                    <li><strong>Situation:</strong> Phishing detection rule had 70% false positive rate, taking 4 hours daily to triage</li>
                    <li><strong>Task:</strong> Reduce false positives while maintaining detection capability</li>
                    <li><strong>Action:</strong> Analyzed 200 alerts, identified that internal newsletter was triggering 60% of FPs. Added allowlist for internal mail sources, added URL reputation check, increased threshold from 3 to 5 indicators</li>
                    <li><strong>Result:</strong> Reduced FP rate to 20%, saved 3 hours daily, maintained 100% detection of real phishing</li>
                </ul>
            </div>
        </div>


        <!-- Footer -->
        <div style="text-align: center; padding: 50px 0; border-top: 1px solid var(--border-color); margin-top: 50px;">
            <p style="color: var(--text-muted);">Detection Engineering Mastery Guide | Zero to Hero Complete Edition</p>
            <p style="color: var(--text-muted); font-size: 0.9rem;">Built for Security Engineers, by Security Engineers</p>
            <p style="color: var(--accent-cyan); font-size: 0.85rem; margin-top: 20px;">Contains: Complete Custom Log Workflow ‚Ä¢ Detection Fundamentals ‚Ä¢ Log Analysis ‚Ä¢ KQL Deep Dive ‚Ä¢ Microsoft Sentinel ‚Ä¢ SAP Security ‚Ä¢ Quick Reference ‚Ä¢ Interview Prep</p>
        </div>
    </main>

    <script>
        // Sidebar toggle
        document.querySelectorAll(".sidebar-section-header").forEach(header => {
            header.addEventListener("click", () => {
                const section = header.parentElement;
                section.classList.toggle("active");
            });
        });

        // Mobile sidebar
        document.getElementById("sidebarToggle").addEventListener("click", () => {
            document.getElementById("sidebar").classList.toggle("open");
        });

        // Progress bar
        window.addEventListener("scroll", () => {
            const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
            const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = (winScroll / height) * 100;
            document.getElementById("progressFill").style.width = scrolled + "%";
        });

        // Copy code
        function copyCode(btn) {
            const pre = btn.closest(".code-block").querySelector("pre");
            navigator.clipboard.writeText(pre.textContent).then(() => {
                btn.textContent = "Copied!";
                setTimeout(() => btn.textContent = "Copy", 2000);
            });
        }

        // Tabs
        document.querySelectorAll(".tab-btn").forEach(btn => {
            btn.addEventListener("click", () => {
                const tabGroup = btn.closest(".tabs");
                tabGroup.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
                tabGroup.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));
                btn.classList.add("active");
                const targetId = btn.getAttribute("data-tab");
                if (targetId) {
                    document.getElementById(targetId).classList.add("active");
                }
            });
        });

        // Search
        document.getElementById("searchInput").addEventListener("input", function(e) {
            const term = e.target.value.toLowerCase();
            if (term.length < 2) {
                document.querySelectorAll(".module").forEach(m => m.style.display = "block");
                return;
            }
            document.querySelectorAll(".module").forEach(module => {
                const text = module.textContent.toLowerCase();
                module.style.display = text.includes(term) ? "block" : "none";
            });
        });

        // Smooth scroll
        document.querySelectorAll("a[href^=\"#\"]").forEach(anchor => {
            anchor.addEventListener("click", function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute("href"));
                if (target) {
                    target.scrollIntoView({ behavior: "smooth", block: "start" });
                    document.getElementById("sidebar").classList.remove("open");
                }
            });
        });
    </script>
</body>
</html>

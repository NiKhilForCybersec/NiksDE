<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows Event IDs | Detection Engineering Mastery</title>
    <link rel="stylesheet" href="../../css/main.css">
</head>
<body>
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>Detection Engineering</h2>
            <span class="sidebar-subtitle">Mastery Guide</span>
        </div>
        <div class="sidebar-search">
            <input type="text" id="sidebar-search" placeholder="Search topics...">
        </div>
        <nav class="sidebar-nav">
            <div class="nav-section">
                <div class="nav-section-title" data-section="detection">
                    <span>Detection Engineering</span>
                    <span class="nav-toggle">‚ñº</span>
                </div>
                <ul class="nav-items" id="detection-items">
                    <li><a href="../detection-engineering/fundamentals.html">Detection Fundamentals</a></li>
                    <li><a href="../detection-engineering/sentinel-deep-dive.html">Microsoft Sentinel Deep Dive</a></li>
                    <li><a href="../detection-engineering/splunk-comparison.html">Splunk Comparison</a></li>
                    <li><a href="../detection-engineering/detection-logic.html">Detection Logic Design</a></li>
                    <li><a href="../detection-engineering/mitre-mapping.html">MITRE ATT&CK Mapping</a></li>
                    <li><a href="../detection-engineering/use-case-framework.html">Use Case Framework</a></li>
                    <li><a href="../detection-engineering/metrics-optimization.html">Metrics & Optimization</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <div class="nav-section-title" data-section="log-analysis">
                    <span>Log Analysis</span>
                    <span class="nav-toggle">‚ñº</span>
                </div>
                <ul class="nav-items" id="log-analysis-items">
                    <li><a href="../log-analysis/fundamentals.html">Log Analysis Fundamentals</a></li>
                    <li><a href="../log-analysis/network-logs.html">Network Logs</a></li>
                    <li><a href="../log-analysis/endpoint-logs.html">Endpoint Logs</a></li>
                    <li><a href="../log-analysis/cloud-logs.html">Cloud Platform Logs</a></li>
                    <li><a href="../log-analysis/regex-mastery.html">Regex Mastery</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <div class="nav-section-title" data-section="threat-intel">
                    <span>Threat Intelligence</span>
                    <span class="nav-toggle">‚ñº</span>
                </div>
                <ul class="nav-items" id="threat-intel-items">
                    <li><a href="../threat-intel/ti-fundamentals.html">TI Fundamentals</a></li>
                    <li><a href="../threat-intel/ti-sources.html">Intelligence Sources</a></li>
                    <li><a href="../threat-intel/ioc-management.html">IOC Management</a></li>
                    <li><a href="../threat-intel/hunting-methodology.html">Hunting Methodology</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <div class="nav-section-title" data-section="sap">
                    <span>SAP Security</span>
                    <span class="nav-toggle">‚ñº</span>
                </div>
                <ul class="nav-items" id="sap-items">
                    <li><a href="../sap-security/sap-overview.html">SAP Overview</a></li>
                    <li><a href="../sap-security/sap-architecture.html">SAP Architecture</a></li>
                    <li><a href="../sap-security/sap-modules.html">Modules & Services</a></li>
                    <li><a href="../sap-security/security-fundamentals.html">Security Fundamentals</a></li>
                    <li><a href="../sap-security/log-types.html">SAP Log Types</a></li>
                    <li><a href="../sap-security/siem-integration.html">SIEM Integration</a></li>
                    <li><a href="../sap-security/threat-detection.html">Threat Detection</a></li>
                    <li><a href="../sap-security/compliance.html">Compliance & Audit</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <div class="nav-section-title" data-section="vuln">
                    <span>Vulnerability Management</span>
                    <span class="nav-toggle">‚ñº</span>
                </div>
                <ul class="nav-items" id="vuln-items">
                    <li><a href="../vulnerability-mgmt/fundamentals.html">VM Fundamentals</a></li>
                    <li><a href="../vulnerability-mgmt/qualys-deep-dive.html">Qualys Deep Dive</a></li>
                    <li><a href="../vulnerability-mgmt/tenable-nessus.html">Tenable & Nessus</a></li>
                    <li><a href="../vulnerability-mgmt/risk-prioritization.html">Risk Prioritization</a></li>
                    <li><a href="../vulnerability-mgmt/remediation.html">Remediation Workflows</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <div class="nav-section-title" data-section="cloud">
                    <span>Cloud Security</span>
                    <span class="nav-toggle">‚ñº</span>
                </div>
                <ul class="nav-items" id="cloud-items">
                    <li><a href="../cloud-security/aws-security.html">AWS Security</a></li>
                    <li><a href="../cloud-security/azure-security.html">Azure Security</a></li>
                    <li><a href="../cloud-security/gcp-security.html">GCP Security</a></li>
                    <li><a href="../cloud-security/multi-cloud.html">Multi-Cloud Strategy</a></li>
                    <li><a href="../cloud-security/cspm-cwpp.html">CSPM & CWPP</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <div class="nav-section-title" data-section="automation">
                    <span>Automation & Scripting</span>
                    <span class="nav-toggle">‚ñº</span>
                </div>
                <ul class="nav-items" id="automation-items">
                    <li><a href="../automation/python-security.html">Python for Security</a></li>
                    <li><a href="../automation/powershell-security.html">PowerShell for Security</a></li>
                    <li><a href="../automation/bash-security.html">Bash for Security</a></li>
                    <li><a href="../automation/soar-platforms.html">SOAR Platforms</a></li>
                    <li><a href="../automation/api-integration.html">API Integration</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <div class="nav-section-title" data-section="compliance">
                    <span>Compliance & Frameworks</span>
                    <span class="nav-toggle">‚ñº</span>
                </div>
                <ul class="nav-items" id="compliance-items">
                    <li><a href="../compliance/framework-overview.html">Framework Overview</a></li>
                    <li><a href="../compliance/iso-27001.html">ISO 27001</a></li>
                    <li><a href="../compliance/nist-csf.html">NIST CSF & 800-53</a></li>
                    <li><a href="../compliance/gdpr.html">GDPR</a></li>
                    <li><a href="../compliance/documentation.html">Documentation Standards</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <div class="nav-section-title" data-section="incident">
                    <span>Incident Response</span>
                    <span class="nav-toggle">‚ñº</span>
                </div>
                <ul class="nav-items" id="incident-items">
                    <li><a href="../incident-response/soc-collaboration.html">SOC Collaboration</a></li>
                    <li><a href="../incident-response/ir-support.html">IR Support Role</a></li>
                    <li><a href="../incident-response/forensic-requirements.html">Forensic Requirements</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <div class="nav-section-title" data-section="references">
                    <span>References & Cheat Sheets</span>
                    <span class="nav-toggle">‚ñº</span>
                </div>
                <ul class="nav-items" id="references-items">
                    <li><a href="kql-cheatsheet.html">KQL Cheat Sheet</a></li>
                    <li><a href="spl-cheatsheet.html">SPL Cheat Sheet</a></li>
                    <li><a href="regex-cheatsheet.html">Regex Cheat Sheet</a></li>
                    <li><a href="windows-events.html" class="active">Windows Event IDs</a></li>
                    <li><a href="mitre-reference.html">MITRE ATT&CK Reference</a></li>
                    <li><a href="interview-prep.html">Interview Preparation</a></li>
                    <li><a href="interview-answers.html">My Interview Answers</a></li>
                </ul>
            </div>
        </nav>
    </aside>

    <main class="main-content">
        <button class="sidebar-toggle" id="sidebar-toggle">‚ò∞</button>
        
        <nav class="breadcrumb">
            <a href="../../index.html">Home</a> &gt;
            <a href="kql-cheatsheet.html">References</a> &gt;
            <span>Windows Event IDs</span>
        </nav>

        <header class="page-header">
            <h1>Windows Event IDs Reference</h1>
            <p class="page-subtitle">Critical security events for detection and monitoring</p>
        </header>

        <section class="content-section">
            <h2>Authentication Events</h2>
            <p>Authentication events are foundational for detecting unauthorized access, credential attacks, and lateral movement.</p>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Event ID</th>
                        <th>Event Name</th>
                        <th>Detection Use Cases</th>
                        <th>MITRE Technique</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>4624</strong></td>
                        <td>Successful Logon</td>
                        <td>Track logon patterns, detect anomalies</td>
                        <td>T1078 Valid Accounts</td>
                    </tr>
                    <tr>
                        <td><strong>4625</strong></td>
                        <td>Failed Logon</td>
                        <td>Brute force, password spray detection</td>
                        <td>T1110 Brute Force</td>
                    </tr>
                    <tr>
                        <td><strong>4634/4647</strong></td>
                        <td>Logoff</td>
                        <td>Session duration analysis</td>
                        <td>‚Äî</td>
                    </tr>
                    <tr>
                        <td><strong>4648</strong></td>
                        <td>Explicit Credentials Logon</td>
                        <td>RunAs, credential theft detection</td>
                        <td>T1078 Valid Accounts</td>
                    </tr>
                    <tr>
                        <td><strong>4672</strong></td>
                        <td>Special Privileges Assigned</td>
                        <td>Admin logon tracking</td>
                        <td>T1078 Valid Accounts</td>
                    </tr>
                    <tr>
                        <td><strong>4768</strong></td>
                        <td>Kerberos TGT Request</td>
                        <td>AS-REP roasting detection</td>
                        <td>T1558.004 AS-REP Roasting</td>
                    </tr>
                    <tr>
                        <td><strong>4769</strong></td>
                        <td>Kerberos Service Ticket</td>
                        <td>Kerberoasting detection</td>
                        <td>T1558.003 Kerberoasting</td>
                    </tr>
                    <tr>
                        <td><strong>4771</strong></td>
                        <td>Kerberos Pre-Auth Failed</td>
                        <td>Password attacks</td>
                        <td>T1110 Brute Force</td>
                    </tr>
                    <tr>
                        <td><strong>4776</strong></td>
                        <td>NTLM Authentication</td>
                        <td>Pass-the-Hash, NTLM relay</td>
                        <td>T1550.002 Pass-the-Hash</td>
                    </tr>
                </tbody>
            </table>

            <h3>Logon Type Reference</h3>
            <div class="info-box info">
                <div class="info-box-header">
                    <span class="info-icon">‚ÑπÔ∏è</span>
                    <span>Event 4624 Logon Types</span>
                </div>
                <div class="info-box-content">
                    <p><strong>Type 2:</strong> Interactive (console logon)</p>
                    <p><strong>Type 3:</strong> Network (SMB, mapped drives)</p>
                    <p><strong>Type 4:</strong> Batch (scheduled tasks)</p>
                    <p><strong>Type 5:</strong> Service (service startup)</p>
                    <p><strong>Type 7:</strong> Unlock (workstation unlock)</p>
                    <p><strong>Type 8:</strong> NetworkCleartext (IIS basic auth)</p>
                    <p><strong>Type 9:</strong> NewCredentials (RunAs /netonly)</p>
                    <p><strong>Type 10:</strong> RemoteInteractive (RDP)</p>
                    <p><strong>Type 11:</strong> CachedInteractive (cached credentials)</p>
                </div>
            </div>

            <div class="code-block" data-language="kql">
                <div class="code-header">
                    <span class="code-lang">KQL</span>
                    <span class="code-title">Authentication Analysis Query</span>
                    <button class="copy-btn">Copy</button>
                </div>
                <pre><code>// Analyze authentication patterns
SecurityEvent
| where TimeGenerated > ago(24h)
| where EventID in (4624, 4625)
| extend 
    LogonType = tostring(LogonType),
    LogonTypeName = case(
        LogonType == "2", "Interactive",
        LogonType == "3", "Network",
        LogonType == "4", "Batch",
        LogonType == "5", "Service",
        LogonType == "7", "Unlock",
        LogonType == "8", "NetworkCleartext",
        LogonType == "9", "NewCredentials",
        LogonType == "10", "RemoteInteractive",
        LogonType == "11", "CachedInteractive",
        "Unknown"
    ),
    Status = iff(EventID == 4624, "Success", "Failure")
| summarize 
    SuccessCount = countif(Status == "Success"),
    FailureCount = countif(Status == "Failure"),
    UniqueUsers = dcount(TargetUserName),
    UniqueHosts = dcount(Computer)
    by LogonTypeName, bin(TimeGenerated, 1h)
| order by TimeGenerated desc</code></pre>
            </div>
        </section>

        <section class="content-section">
            <h2>Process Events</h2>
            <p>Process creation events are essential for detecting malicious execution, living-off-the-land techniques, and suspicious behaviors.</p>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Event ID</th>
                        <th>Event Name</th>
                        <th>Detection Use Cases</th>
                        <th>MITRE Technique</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>4688</strong></td>
                        <td>Process Creation</td>
                        <td>All execution monitoring (requires cmd line logging)</td>
                        <td>T1059 Command & Scripting</td>
                    </tr>
                    <tr>
                        <td><strong>4689</strong></td>
                        <td>Process Termination</td>
                        <td>Process lifetime analysis</td>
                        <td>‚Äî</td>
                    </tr>
                    <tr>
                        <td><strong>1 (Sysmon)</strong></td>
                        <td>Process Create</td>
                        <td>Enhanced process details with hashes</td>
                        <td>T1059 Command & Scripting</td>
                    </tr>
                    <tr>
                        <td><strong>5 (Sysmon)</strong></td>
                        <td>Process Terminated</td>
                        <td>Process lifecycle tracking</td>
                        <td>‚Äî</td>
                    </tr>
                    <tr>
                        <td><strong>10 (Sysmon)</strong></td>
                        <td>Process Access</td>
                        <td>LSASS access, process injection</td>
                        <td>T1003.001 LSASS Memory</td>
                    </tr>
                </tbody>
            </table>

            <div class="info-box warning">
                <div class="info-box-header">
                    <span class="info-icon">‚ö†Ô∏è</span>
                    <span>Enable Command Line Logging</span>
                </div>
                <div class="info-box-content">
                    <p>Event 4688 doesn't include command line by default. Enable via:</p>
                    <p><code>Computer Configuration ‚Üí Administrative Templates ‚Üí System ‚Üí Audit Process Creation ‚Üí Include command line in process creation events</code></p>
                </div>
            </div>

            <div class="code-block" data-language="kql">
                <div class="code-header">
                    <span class="code-lang">KQL</span>
                    <span class="code-title">Suspicious Process Execution Detection</span>
                    <button class="copy-btn">Copy</button>
                </div>
                <pre><code>// Detect suspicious process execution patterns
SecurityEvent
| where EventID == 4688
| where TimeGenerated > ago(1h)
| extend 
    ProcessName = tostring(split(NewProcessName, "\\")[-1]),
    ParentProcess = tostring(split(ParentProcessName, "\\")[-1])
| where ProcessName in~ (
    "powershell.exe", "pwsh.exe", "cmd.exe",
    "wscript.exe", "cscript.exe", "mshta.exe",
    "certutil.exe", "bitsadmin.exe", "regsvr32.exe"
)
| extend 
    SuspiciousIndicators = strcat(
        iff(CommandLine has_any ("-enc", "-encoded"), "Encoded ", ""),
        iff(CommandLine has_any ("http://", "https://"), "Network ", ""),
        iff(CommandLine has "hidden", "Hidden ", ""),
        iff(ParentProcess in~ ("winword.exe", "excel.exe", "outlook.exe"), "OfficeChild ", "")
    )
| where isnotempty(SuspiciousIndicators)
| project 
    TimeGenerated,
    Computer,
    Account,
    ProcessName,
    CommandLine,
    ParentProcess,
    SuspiciousIndicators</code></pre>
            </div>
        </section>

        <section class="content-section">
            <h2>Account Management Events</h2>
            <p>Track account creation, modification, and privilege changes to detect persistence and privilege escalation.</p>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Event ID</th>
                        <th>Event Name</th>
                        <th>Detection Use Cases</th>
                        <th>MITRE Technique</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>4720</strong></td>
                        <td>User Account Created</td>
                        <td>Unauthorized account creation</td>
                        <td>T1136 Create Account</td>
                    </tr>
                    <tr>
                        <td><strong>4722</strong></td>
                        <td>User Account Enabled</td>
                        <td>Dormant account reactivation</td>
                        <td>T1078 Valid Accounts</td>
                    </tr>
                    <tr>
                        <td><strong>4723</strong></td>
                        <td>Password Change Attempt</td>
                        <td>Self-service password changes</td>
                        <td>‚Äî</td>
                    </tr>
                    <tr>
                        <td><strong>4724</strong></td>
                        <td>Password Reset Attempt</td>
                        <td>Admin password resets</td>
                        <td>T1098 Account Manipulation</td>
                    </tr>
                    <tr>
                        <td><strong>4725</strong></td>
                        <td>User Account Disabled</td>
                        <td>Account lifecycle management</td>
                        <td>‚Äî</td>
                    </tr>
                    <tr>
                        <td><strong>4726</strong></td>
                        <td>User Account Deleted</td>
                        <td>Anti-forensics, cleanup</td>
                        <td>T1070 Indicator Removal</td>
                    </tr>
                    <tr>
                        <td><strong>4728</strong></td>
                        <td>Member Added to Security Group</td>
                        <td>Privilege escalation</td>
                        <td>T1098 Account Manipulation</td>
                    </tr>
                    <tr>
                        <td><strong>4732</strong></td>
                        <td>Member Added to Local Group</td>
                        <td>Local admin addition</td>
                        <td>T1098 Account Manipulation</td>
                    </tr>
                    <tr>
                        <td><strong>4756</strong></td>
                        <td>Member Added to Universal Group</td>
                        <td>Enterprise admin changes</td>
                        <td>T1098 Account Manipulation</td>
                    </tr>
                </tbody>
            </table>

            <div class="code-block" data-language="kql">
                <div class="code-header">
                    <span class="code-lang">KQL</span>
                    <span class="code-title">Privileged Group Membership Changes</span>
                    <button class="copy-btn">Copy</button>
                </div>
                <pre><code>// Monitor additions to privileged groups
let PrivilegedGroups = dynamic([
    "Domain Admins",
    "Enterprise Admins",
    "Schema Admins",
    "Administrators",
    "Backup Operators",
    "Account Operators",
    "Server Operators",
    "Print Operators",
    "DnsAdmins"
]);
SecurityEvent
| where EventID in (4728, 4732, 4756)
| where TargetUserName has_any (PrivilegedGroups)
| project 
    TimeGenerated,
    Computer,
    Action = case(
        EventID == 4728, "Added to Global Security Group",
        EventID == 4732, "Added to Local Security Group",
        EventID == 4756, "Added to Universal Security Group",
        "Unknown"
    ),
    GroupName = TargetUserName,
    MemberAdded = MemberName,
    AddedBy = SubjectUserName,
    AddedByDomain = SubjectDomainName
| extend AlertSeverity = "High"</code></pre>
            </div>
        </section>

        <section class="content-section">
            <h2>Object Access & File Events</h2>
            <p>Monitor file system and object access for data exfiltration, tampering, and persistence mechanisms.</p>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Event ID</th>
                        <th>Event Name</th>
                        <th>Detection Use Cases</th>
                        <th>MITRE Technique</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>4656</strong></td>
                        <td>Handle to Object Requested</td>
                        <td>Sensitive file access attempts</td>
                        <td>T1005 Data from Local System</td>
                    </tr>
                    <tr>
                        <td><strong>4663</strong></td>
                        <td>Object Access Attempt</td>
                        <td>File read/write/delete operations</td>
                        <td>T1005 Data from Local System</td>
                    </tr>
                    <tr>
                        <td><strong>4670</strong></td>
                        <td>Permissions on Object Changed</td>
                        <td>ACL modification</td>
                        <td>T1222 File Permissions Modification</td>
                    </tr>
                    <tr>
                        <td><strong>4697</strong></td>
                        <td>Service Installed</td>
                        <td>Service persistence</td>
                        <td>T1543.003 Windows Service</td>
                    </tr>
                    <tr>
                        <td><strong>11 (Sysmon)</strong></td>
                        <td>File Created</td>
                        <td>Malware drops, data staging</td>
                        <td>T1074 Data Staged</td>
                    </tr>
                    <tr>
                        <td><strong>23 (Sysmon)</strong></td>
                        <td>File Delete</td>
                        <td>Anti-forensics, cleanup</td>
                        <td>T1070.004 File Deletion</td>
                    </tr>
                </tbody>
            </table>

            <div class="code-block" data-language="kql">
                <div class="code-header">
                    <span class="code-lang">KQL</span>
                    <span class="code-title">Sensitive File Access Detection</span>
                    <button class="copy-btn">Copy</button>
                </div>
                <pre><code>// Monitor access to sensitive files
let SensitivePaths = dynamic([
    "\\SAM",
    "\\SYSTEM",
    "\\SECURITY",
    "\\ntds.dit",
    "\\config\\SAM",
    "\\Windows\\System32\\config",
    "password",
    "credentials",
    "secret"
]);
SecurityEvent
| where EventID == 4663
| where ObjectName has_any (SensitivePaths)
| where AccessMask has_any ("0x1", "0x20", "0x80", "0x100")  // Read, Execute, ReadAttributes
| project 
    TimeGenerated,
    Computer,
    Account = SubjectUserName,
    ObjectName,
    AccessType = case(
        AccessMask has "0x1", "Read",
        AccessMask has "0x2", "Write",
        AccessMask has "0x20", "Execute",
        AccessMask has "0x10000", "Delete",
        "Other"
    ),
    ProcessName</code></pre>
            </div>
        </section>

        <section class="content-section">
            <h2>Network Events</h2>
            <p>Network connection events help detect lateral movement, command & control, and data exfiltration.</p>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Event ID</th>
                        <th>Event Name</th>
                        <th>Detection Use Cases</th>
                        <th>MITRE Technique</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>5156</strong></td>
                        <td>WFP Connection Permitted</td>
                        <td>Allowed network connections</td>
                        <td>T1071 Application Layer Protocol</td>
                    </tr>
                    <tr>
                        <td><strong>5157</strong></td>
                        <td>WFP Connection Blocked</td>
                        <td>Blocked connection attempts</td>
                        <td>‚Äî</td>
                    </tr>
                    <tr>
                        <td><strong>5140</strong></td>
                        <td>Network Share Accessed</td>
                        <td>SMB share enumeration, lateral movement</td>
                        <td>T1021.002 SMB/Windows Admin Shares</td>
                    </tr>
                    <tr>
                        <td><strong>5145</strong></td>
                        <td>Network Share Object Checked</td>
                        <td>Detailed share access</td>
                        <td>T1021.002 SMB/Windows Admin Shares</td>
                    </tr>
                    <tr>
                        <td><strong>3 (Sysmon)</strong></td>
                        <td>Network Connection</td>
                        <td>Process network activity</td>
                        <td>T1071 Application Layer Protocol</td>
                    </tr>
                    <tr>
                        <td><strong>22 (Sysmon)</strong></td>
                        <td>DNS Query</td>
                        <td>DNS tunneling, C2 detection</td>
                        <td>T1071.004 DNS</td>
                    </tr>
                </tbody>
            </table>

            <div class="code-block" data-language="kql">
                <div class="code-header">
                    <span class="code-lang">KQL</span>
                    <span class="code-title">Admin Share Access Detection</span>
                    <button class="copy-btn">Copy</button>
                </div>
                <pre><code>// Detect access to administrative shares
SecurityEvent
| where EventID == 5140
| where ShareName in~ ("\\\\*\\C$", "\\\\*\\ADMIN$", "\\\\*\\IPC$")
| where SubjectUserName !endswith "$"  // Exclude machine accounts
| summarize 
    AccessCount = count(),
    UniqueShares = dcount(ShareName),
    ShareList = make_set(ShareName, 10),
    FirstAccess = min(TimeGenerated),
    LastAccess = max(TimeGenerated)
    by Computer, SubjectUserName, IpAddress, bin(TimeGenerated, 1h)
| where AccessCount > 5 or UniqueShares > 2
| extend 
    SuspicionLevel = case(
        UniqueShares > 5 and AccessCount > 20, "High - Possible enumeration",
        ShareName has "C$", "Medium - Admin share access",
        "Low"
    )</code></pre>
            </div>
        </section>

        <section class="content-section">
            <h2>Policy & System Events</h2>
            <p>System and policy events reveal configuration changes, security bypasses, and defense evasion attempts.</p>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Event ID</th>
                        <th>Event Name</th>
                        <th>Detection Use Cases</th>
                        <th>MITRE Technique</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>1102</strong></td>
                        <td>Security Log Cleared</td>
                        <td>Anti-forensics, log tampering</td>
                        <td>T1070.001 Clear Windows Event Logs</td>
                    </tr>
                    <tr>
                        <td><strong>4616</strong></td>
                        <td>System Time Changed</td>
                        <td>Timestomping, anti-forensics</td>
                        <td>T1070.006 Timestomp</td>
                    </tr>
                    <tr>
                        <td><strong>4657</strong></td>
                        <td>Registry Value Modified</td>
                        <td>Persistence, config changes</td>
                        <td>T1112 Modify Registry</td>
                    </tr>
                    <tr>
                        <td><strong>4698</strong></td>
                        <td>Scheduled Task Created</td>
                        <td>Persistence mechanism</td>
                        <td>T1053.005 Scheduled Task</td>
                    </tr>
                    <tr>
                        <td><strong>4699</strong></td>
                        <td>Scheduled Task Deleted</td>
                        <td>Anti-forensics, cleanup</td>
                        <td>T1070 Indicator Removal</td>
                    </tr>
                    <tr>
                        <td><strong>4700/4701</strong></td>
                        <td>Scheduled Task Enabled/Disabled</td>
                        <td>Task manipulation</td>
                        <td>T1053.005 Scheduled Task</td>
                    </tr>
                    <tr>
                        <td><strong>4719</strong></td>
                        <td>Audit Policy Changed</td>
                        <td>Defense evasion</td>
                        <td>T1562.002 Disable Windows Event Logging</td>
                    </tr>
                    <tr>
                        <td><strong>7045</strong></td>
                        <td>Service Installed (System)</td>
                        <td>Service persistence</td>
                        <td>T1543.003 Windows Service</td>
                    </tr>
                </tbody>
            </table>

            <div class="code-block" data-language="kql">
                <div class="code-header">
                    <span class="code-lang">KQL</span>
                    <span class="code-title">Security Log Clearing Detection</span>
                    <button class="copy-btn">Copy</button>
                </div>
                <pre><code>// Detect security log clearing - high severity event
SecurityEvent
| where EventID == 1102
| project 
    TimeGenerated,
    Computer,
    ClearedBy = SubjectUserName,
    ClearedByDomain = SubjectDomainName,
    LogonId = SubjectLogonId
| join kind=leftouter (
    SecurityEvent
    | where EventID == 4624
    | project LogonId = TargetLogonId, LogonTime = TimeGenerated, 
        LogonIP = IpAddress, LogonType
) on LogonId
| project
    TimeGenerated,
    Computer,
    ClearedBy,
    ClearedByDomain,
    SourceIP = LogonIP,
    LogonType,
    AlertSeverity = "Critical",
    MITRETechnique = "T1070.001 - Clear Windows Event Logs"</code></pre>
            </div>
        </section>

        <section class="content-section">
            <h2>PowerShell Events</h2>
            <p>PowerShell logging provides visibility into script execution, a common attack vector.</p>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Event ID</th>
                        <th>Log</th>
                        <th>Description</th>
                        <th>Detection Use Cases</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>4103</strong></td>
                        <td>PowerShell/Operational</td>
                        <td>Module Logging</td>
                        <td>Cmdlet execution tracking</td>
                    </tr>
                    <tr>
                        <td><strong>4104</strong></td>
                        <td>PowerShell/Operational</td>
                        <td>Script Block Logging</td>
                        <td>Full script content capture (decoded)</td>
                    </tr>
                    <tr>
                        <td><strong>4105/4106</strong></td>
                        <td>PowerShell/Operational</td>
                        <td>Script Block Start/Stop</td>
                        <td>Script execution boundaries</td>
                    </tr>
                    <tr>
                        <td><strong>400/403</strong></td>
                        <td>Windows PowerShell</td>
                        <td>Engine Start/Stop</td>
                        <td>PowerShell session tracking</td>
                    </tr>
                    <tr>
                        <td><strong>800</strong></td>
                        <td>Windows PowerShell</td>
                        <td>Pipeline Execution Details</td>
                        <td>Command execution details</td>
                    </tr>
                </tbody>
            </table>

            <div class="info-box tip">
                <div class="info-box-header">
                    <span class="info-icon">üí°</span>
                    <span>Enable Script Block Logging</span>
                </div>
                <div class="info-box-content">
                    <p>Script Block Logging (4104) captures the full, decoded script content even when obfuscated. Enable via:</p>
                    <p><code>Computer Configuration ‚Üí Administrative Templates ‚Üí Windows Components ‚Üí Windows PowerShell ‚Üí Turn on PowerShell Script Block Logging</code></p>
                </div>
            </div>

            <div class="code-block" data-language="kql">
                <div class="code-header">
                    <span class="code-lang">KQL</span>
                    <span class="code-title">Suspicious PowerShell Script Block Detection</span>
                    <button class="copy-btn">Copy</button>
                </div>
                <pre><code>// Analyze PowerShell script blocks for malicious patterns
Event
| where Source == "Microsoft-Windows-PowerShell"
| where EventID == 4104
| extend ScriptBlock = tostring(EventData)
| where ScriptBlock has_any (
    // Credential access
    "mimikatz", "sekurlsa", "kerberos::list",
    "Get-Credential", "ConvertTo-SecureString",
    // Download/execution
    "DownloadString", "DownloadFile", "Invoke-WebRequest",
    "IEX", "Invoke-Expression", "Start-BitsTransfer",
    // Recon
    "Get-ADUser", "Get-ADComputer", "Get-ADGroup",
    "Get-NetUser", "Get-NetComputer", "Get-NetGroup",
    // Evasion
    "Bypass", "Hidden", "NoProfile",
    "AMSI", "Reflection.Assembly",
    // Persistence
    "New-ScheduledTask", "Register-ScheduledJob",
    "New-Service", "Set-ItemProperty"
)
| extend 
    Category = case(
        ScriptBlock has_any ("mimikatz", "sekurlsa", "kerberos"), "Credential Theft",
        ScriptBlock has_any ("Download", "IEX", "WebRequest"), "Download & Execute",
        ScriptBlock has_any ("Get-AD", "Get-Net"), "Reconnaissance",
        ScriptBlock has_any ("AMSI", "Bypass"), "Defense Evasion",
        ScriptBlock has_any ("ScheduledTask", "Service"), "Persistence",
        "Other"
    )
| project 
    TimeGenerated,
    Computer,
    Category,
    ScriptBlockPreview = substring(ScriptBlock, 0, 500)</code></pre>
            </div>
        </section>

        <section class="content-section">
            <h2>Quick Reference Table</h2>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Must-Monitor Events</th>
                        <th>Primary Detection Use</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Authentication</strong></td>
                        <td>4624, 4625, 4648, 4768, 4769, 4776</td>
                        <td>Brute force, Pass-the-Hash, Kerberoasting</td>
                    </tr>
                    <tr>
                        <td><strong>Process</strong></td>
                        <td>4688, Sysmon 1, 10</td>
                        <td>Malicious execution, credential dumping</td>
                    </tr>
                    <tr>
                        <td><strong>Account Mgmt</strong></td>
                        <td>4720, 4728, 4732, 4756</td>
                        <td>Privilege escalation, persistence</td>
                    </tr>
                    <tr>
                        <td><strong>Network</strong></td>
                        <td>5140, 5156, Sysmon 3, 22</td>
                        <td>Lateral movement, C2 communication</td>
                    </tr>
                    <tr>
                        <td><strong>Defense Evasion</strong></td>
                        <td>1102, 4698, 4719, 7045</td>
                        <td>Log clearing, persistence, policy changes</td>
                    </tr>
                    <tr>
                        <td><strong>PowerShell</strong></td>
                        <td>4103, 4104</td>
                        <td>Script-based attacks, obfuscation</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <div class="page-navigation">
            <a href="regex-cheatsheet.html" class="nav-prev">‚Üê Regex Cheat Sheet</a>
            <a href="mitre-reference.html" class="nav-next">MITRE ATT&CK Reference ‚Üí</a>
        </div>
    </main>

    <script src="../../js/sidebar.js"></script>
</body>
</html>
